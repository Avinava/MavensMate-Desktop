!function(e){function t(o){if(n[o])return n[o].exports;var r=n[o]={exports:{},id:o,loaded:!1};return e[o].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="./app",t(0)}([function(e,t,n){(function(e){"use strict";var t=n(14),o=t.app;n(136)&&o.quit();var r=(t.Tray,n(1)),i=n(6),a=t.Menu,c=t.BrowserWindow,s=t.shell,u=n(106),l=t.ipcMain,d=n(102),p=n(134),m=null,f=null,h=null,g=null,y=null,v=null,b=function(){return"darwin"===process.platform?i.join(o.getAppPath(),"..","..",".."):"win32"===process.platform?o.getAppPath():o.getAppPath()},x=(new p({name:"MavensMate",isHidden:!0,path:b()}),function(){if(!a.getApplicationMenu()){var e;e="darwin"==process.platform?[{label:"MavensMate",submenu:[{label:"MavensMate v"+o.getVersion()},{type:"separator"},{label:"Services",submenu:[]},{type:"separator"},{label:"Hide MavensMate",accelerator:"Command+H",selector:"hide:"},{label:"Hide Others",accelerator:"Command+Shift+H",selector:"hideOtherApplications:"},{label:"Show All",selector:"unhideAllApplications:"},{type:"separator"},{label:"Quit",accelerator:"Command+Q",click:function(){o.quit()}}]},{label:"Edit",submenu:[{label:"Undo",accelerator:"Command+Z",selector:"undo:"},{label:"Redo",accelerator:"Shift+Command+Z",selector:"redo:"},{type:"separator"},{label:"Cut",accelerator:"Command+X",selector:"cut:"},{label:"Copy",accelerator:"Command+C",selector:"copy:"},{label:"Paste",accelerator:"Command+V",selector:"paste:"},{label:"Select All",accelerator:"Command+A",selector:"selectAll:"}]},{label:"Window",submenu:[{label:"New Window",accelerator:"Command+N",click:function(){m||j(!1,"http://localhost:56248/app/home")}},{label:"Minimize",accelerator:"Command+M",selector:"performMiniaturize:"},{label:"Close",accelerator:"Command+W",selector:"performClose:"},{type:"separator"},{label:"Bring All to Front",selector:"arrangeInFront:"}]},{label:"Advanced",submenu:[{label:"Toggle MavensMate Server Developer Tools",accelerator:function(){return"darwin"===process.platform?"Alt+Command+K":"Ctrl+Shift+K"}(),click:function(e,t){t&&t.webContents.send("toggle-server-developer-tools")}},{label:"Toggle MavensMate Desktop Developer Tools",accelerator:function(){return"darwin"===process.platform?"Alt+Command+I":"Ctrl+Shift+I"}(),click:function(e,t){t&&t.webContents.send("toggle-desktop-developer-tools")}}]},{label:"Help",submenu:[{label:"MavensMate v"+o.getVersion()},{label:"Check for Updates",click:function(){n(14).shell.openExternal("https://github.com/joeferraro/MavensMate-Desktop/releases")}},{label:"Learn More",click:function(){n(14).shell.openExternal("http://mavensmate.com")}},{label:"Submit a GitHub Issue",click:function(){n(14).shell.openExternal("https://github.com/joeferraro/MavensMate/issues")}}]}]:[{label:"&File",submenu:[{label:"&Close",accelerator:"Ctrl+W",click:function(){var e=c.getFocusedWindow();e&&e.close()}},{label:"Quit",accelerator:"Ctrl+Q",click:function(){o.quit()}}]},{label:"Advanced",submenu:[{label:"Toggle MavensMate Server Developer Tools",accelerator:function(){return"darwin"===process.platform?"Alt+Command+K":"Ctrl+Shift+K"}(),click:function(e,t){t&&t.webContents.send("toggle-server-developer-tools")}},{label:"Toggle MavensMate Desktop Developer Tools",accelerator:function(){return"darwin"===process.platform?"Alt+Command+I":"Ctrl+Shift+I"}(),click:function(e,t){t&&t.webContents.send("toggle-desktop-developer-tools")}}]},{label:"Help",submenu:[{label:"MavensMate v"+o.getVersion()},{label:"Check for Updates",click:function(){n(14).shell.openExternal("https://github.com/joeferraro/MavensMate-Desktop/releases")}},{label:"Submit a GitHub Issue",click:function(){n(14).shell.openExternal("https://github.com/joeferraro/MavensMate/issues")}},{label:"Learn More",click:function(){n(14).shell.openExternal("http://mavensmate.com")}}]}];var t=a.buildFromTemplate(e);a.setApplicationMenu(t)}}),w=function(){m=null},j=function C(t,o){return new r(function(o,a){try{console.log("attaching main application window"),v=function(e){console.log("openUrlInNewTab",e);var t=m?r.resolve():C();t.then(function(){e.indexOf("localhost")>=0?(m.webContents.send("new-web-view",e),m.show()):s.openExternal(e)})["catch"](function(e){console.error("COuld not open url in new view ...",e)})},m=new c({width:1e3,height:750,minWidth:850,minHeight:670,icon:i.join(e,"resources","icon.png")}),m.loadURL("file://"+e+"/index.html"),m.on("closed",w),m.webContents.on("did-finish-load",function(){u.stop&&t&&(h.stop(),h=null,f=null,g=null,y=null),u.startServer({name:"mavensmate-desktop",port:56248,openWindowFn:v,mode:"desktop",ipc:n(14).ipcRenderer}).then(function(e){f=e.app,h=e.server,g=e.config,y=e.logger,m.webContents.send("new-web-view","http://localhost:56248/app/home"),new d(m,g),o()})["catch"](function(e){m.webContents.send("new-web-view","http://localhost:56248/app/home"),o()})}),m.on("closed",function(){m=null})}catch(l){a(l)}})};l.on("show-view-manager",function(){console.log("showing view manager!"),m.webContents.send("show-view-manager")}),l.on("error:continue",function(){m.loadURL("file://"+e+"/index.html"),m.webContents.on("did-finish-load",function(){m.webContents.send("new-web-view","http://localhost:56248/app/home")})}),o.on("activate-with-no-open-windows",function(){m||(m=j())}),o.on("ready",function(){x(),j()["catch"](function(t){console.error("Error starting MavensMate: ",t),m.loadURL("file://"+e+"/error.html"),m.webContents.on("did-finish-load",function(){t.message.indexOf("56248")>=0?m.webContents.send("error-msg","Another MavensMate Desktop instance running. Quit any other running instances of MavensMate Desktop to continue."):m.webContents.send("error-msg",t.message)})})})}).call(t,"/")},function(e,t){e.exports=require("bluebird")},function(e,t){e.exports=require("inherits")},function(e,t,n){(function(e){"use strict";var o=n(97).spawn,r=n(26),i=n(6),a=n(1),c=n(7),s=n(27),u=n(146),l=n(137),d=n(133),p=n(4),m=n(101),f=n(96),h={darwin:"osx",linux:"linux",win32:"windows"};t.platformConfigKey=h[s.platform()],t.getAppRoot=function(){return i.resolve(i.join(e,"..",".."))},t.isCredentialsError=function(e){return e.message.indexOf("expired access/refresh token")>=0||e.message.indexOf("Could not retrieve credentials")>=0||e.message.indexOf("INVALID_SESSION_ID")>=0},t.getProjectById=function(e,t){var n=e.get("projects");return t?c.find(n,function(e){return e.settings.id===t}):null},t.getDefaultWorkspaceSetting=function(){return this.isMac()?i.join(process.env.HOME,"Documents"):this.isWindows()?i.join(process.env["win32"===process.platform?"USERPROFILE":"HOME"],"Documents"):this.isLinux()?process.env.HOME:void 0},t.endsWith=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),e.indexOf(t,e.length-t.length)!==-1},t.startsWith=function(e,t){return e=e.toLowerCase(),t=t.toLowerCase(),t.length>0&&e.substring(0,t.length)===t},t.isWindows=function(){return"win32"===s.platform()},t.getWindowsAppDataPath=function(){return process.env.APPDATA},t.isLinux=function(){return"linux"===s.platform()},t.isMac=function(){return"darwin"===s.platform()},t.isValidProjectPath=function(e){return r.existsSync(i.join(e,"config",".settings"))},t.getHomeDirectory=function(){return this.isMac()?process.env.HOME:this.isWindows()?process.env["win32"===process.platform?"USERPROFILE":"HOME"]:this.isLinux()?process.env.HOME:void 0},t.removeEmptyDirectoriesRecursiveSync=function(e){p.silly("----------> removing empty directories from",e);var t=function(n){var o=r.readdirSync(n);if(p.silly("files in directory",n,o),0===o.length&&n!==e)r.removeSync(n);else{for(var a=0;a<o.length;a++){var c=i.join(n,o[a]);p.silly(c);var s=r.statSync(c);s.isDirectory()&&(p.silly("---> directory",c),t(c))}o=r.readdirSync(n),0===o.length&&n!==e&&r.removeSync(n)}};t(e)},t.emptyDirectoryRecursiveSync=function(e){var t=function(e){p.silly("----------> emptying directory",e);var n=r.readdirSync(e);if(p.silly("files",n),n.length>0)for(var o=0;o<n.length;o++){var a=n[o],c=i.join(e,n[o]);p.silly(c);var s=r.statSync(c);s.isFile()?(p.silly("---> file, unlinking",c),r.unlinkSync(c)):s.isDirectory()&&".svn"!==a&&".git"!==a&&(p.silly("---> directory",c),t(c))}};t(e)},t.getAbsolutePaths=function(e){var t=[];return c.each(e,function(e){i.resolve(e)!==i.normalize(e).replace(new RegExp(i.sep+"$"),"")?t.push(i.resolve(e)):t.push(e)}),t},t.isDirectoryEmptySync=function(e){var t;try{t=r.statSync(e)}catch(n){return!0}if(t.isDirectory()){var o=r.readdirSync(e),i=[];return c.each(o,function(e){"."!==e[0]&&i.push(e)}),0===i.length}},t.walkSync=function(e){var t=function(e){var t;return(t=function(e){var n,o,a,c,s;for(o=r.readdirSync(e),s=[],a=0,c=o.length;a<c;a++)n=o[a],n=e+i.sep+n,r.statSync(n).isDirectory()?s.push(t(n)):s.push(n);return s})(e)};return c.flatten(t(e))},t.listDirectories=function(e){var t=r.readdirSync(e),n=[];return c.each(t,function(t){r.statSync(i.join(e,t)).isDirectory()&&n.push(i.join(e,t))}),n},t.readStdin=function(){return new a(function(e,t){var n="";process.stdin.setEncoding("utf8"),process.stdin.on("readable",function(){var e=process.stdin.read();null!==e&&(n+=e)}),process.stdin.on("end",function(){var t=JSON.parse(n);c.forOwn(t,function(e,n){n.indexOf("_")>=0&&(t[f(n)]=t[n],delete t[n])}),e(t)})})},t.getPayload=function(){var e=this;return new a(function(t,n){e.readStdin().then(function(e){t(e)})["catch"](function(e){n(new Error("Could not read STDIN: "+e.message))})})},t.applyProperties=function(e,t){c.forOwn(t,function(t,n){n.indexOf("_")>=0?e[f(n)]=t:e[n]=t})},t.getFileBody=function(e,t){var n=r.readFileSync(e,"utf8");return t?(n=u(n),JSON.parse(n)):n},t.joinForQuery=function(e){return"'"+e.join("','")+"'"},t.zipDirectory=function(e,t,n,o,c){return new a(function(a,s){if(!e)return s(new Error("Missing directory to zip"));void 0===n&&(n="unpackaged"),void 0===o&&(o="zip"),c=c||n;var u=process.cwd();process.chdir(i.join(e));var l=r.createWriteStream(i.join(t,c+"."+o)),m=d("zip");l.on("close",function(){process.chdir(u),a()}),m.on("error",function(e){p.error("error creating zip file"),p.error(e),process.chdir(u),s(new Error("unable to create zip file"))}),m.pipe(l),m.bulk([{src:["**"],dest:n}]),m.finalize()})},t.writeStream=function(t,n){var c=this;return new a(function(a,u){var d=i.join(n,"tmp.zip");try{p.debug("writing stream"),t.pipe(l.Writer(d)).on("error",function(e){r.existsSync(d)&&r.removeAsync(d).then(function(){u(e)})["catch"](function(e){u(e)})}).on("close",function(){p.debug("closed write stream, unzipping now");var t;if(c.isMac()||c.isLinux())t=o("unzip",[d,"-d",n],{stdio:["ignore","ignore","pipe"]});else if(c.isWindows()){var l="cscript";try{m.sync("cscript")}catch(f){p.debug("Could not find cscript..."),l="ia32"===s.arch()?"c:\\windows\\system32\\cscript.exe":"c:\\windows\\SysWOW64\\cscript.exe"}p.debug("cscriptExe is: ",l),t=o(l,[i.join(e,"..","..","bin","unzip.vbs"),d,n],{stdio:["ignore","ignore","pipe"]})}t.on("error",function(e){return p.debug("error spawning unzip process",e),u(e.message.indexOf("ENOENT")!==-1?new Error("Could not unzip response from Salesforce. It is likely unzip (OSX/Linux) or cscript (Windows) is not available on your system PATH. Check your local machine settings."):e)}),t.stderr.on("data",function(e){p.error("ERR unzipping:"),p.error(e),r.existsSync(d)&&r.removeAsync(d).then(function(){return u(new Error("Could not extract and write stream to file system."))})["catch"](function(e){return u(e)})}),t.on("close",function(e){r.existsSync(d)&&r.removeAsync(d).then(function(){return 0!==e?u(new Error("Could not extract and write stream to file system. [Exit Code "+e+"]")):a(n)})["catch"](function(e){u(e)})})})}catch(f){r.existsSync(d)&&r.removeAsync(d).then(function(){u(f)})["catch"](function(e){u(e)})}})},t.chunkArray=function(e,t){return[].concat.apply([],e.map(function(n,o){return o%t?[]:[e.slice(o,o+t)]}))},t.generateRandomString=function(e){var t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghiklmnopqrstuvwxyz";e=e?e:32;for(var n="",o=0;o<e;o++){var r=Math.floor(Math.random()*t.length);n+=t.substring(r,r+1)}return n}}).call(t,"/")},function(e,t){e.exports=require("winston")},function(e,t,n){"use strict";var o=(n(7),n(4),n(15).MetadataHelper),r=function(e){this.setProject(e[0]),this.payload=e[1],this.editorService=e[2],this.metadataHelper=new o};r.prototype.setId=function(e){this._id=e},r.prototype.getId=function(){return this._id},r.prototype.setProject=function(e){this._project=e},r.prototype.getProject=function(){return this._project},r.prototype.isUICommand=function(){return!(!this.payload||!this.payload.args)&&this.payload.args.ui},e.exports=r},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("lodash")},function(e,t,n){"use strict";function o(e){a.unwatchFile(e),a.watchFile(e,function(){r()})}function r(){c.remove("user-client"),c.remove("default-client"),c.remove("global"),i()}function i(){c.env().argv().defaults({});var e;u.isMac()?e=l.join(u.getHomeDirectory(),".mavensmate-config.json"):u.isWindows()?e=l.join(u.getWindowsAppDataPath(),"MavensMate","mavensmate-config.json"):u.isLinux()&&(e=l.join(u.getHomeDirectory(),".config",".mavensmate-config.json"));var t={};d.each(s,function(e,n){t[n]=e["default"]}),a.existsSync(e)||a.outputJsonSync(e,t,{spaces:2});try{u.getFileBody(e,!0)}catch(n){logger.error("could not parse user JSON configuration, reverting to default"),a.outputJsonSync(e,t,{spaces:2})}c.file("user",e),o(e),c.add("global",{type:"literal",store:t});var r=c.get("mm_api_version");u.endsWith(r,".0")||(r+=".0",c.set("mm_api_version",r)),c.get("mm_http_proxy")&&(process.env.http_proxy=c.get("mm_http_proxy")),c.get("mm_https_proxy")&&(process.env.https_proxy=c.get("mm_https_proxy"))}var a=n(10),c=n(140),s=n(36),u=n(3),l=n(6),d=n(7);i(),e.exports=c},function(e,t,n){"use strict";var o=n(1),r=(n(7),n(101)),i=n(97).spawn,a=n(4),c=n(3),s=n(8),u=(n(6),n(27)),l=n(10),d=n(142),p=n(22),m=function(e,t){if(this.editor=e,this.openWindowFn=t,this.supportedEditors=this._getSupportedEditors(),this.editor&&!this._isSupportedEditor(this.editor))throw new Error(this.editor+" was not found in list of supported editors. Please check your global settings to ensure the self.editor path for "+this.editor+" is configured correctly.")};m.prototype._isSupportedEditor=function(e){return!!this.supportedEditors[this.editor]||(a.error("Unsupported editor. Supported editors: ",this.supportedEditors),!1)},m.prototype._getSupportedEditors=function(){var e,t,n,o={},i=s.get("mm_atom_exec_path")[c.platformConfigKey]||s.get("mm_atom_exec_path"),a=s.get("mm_vscode_exec_path")[c.platformConfigKey]||s.get("mm_vscode_exec_path");try{n=r.sync("code")}catch(u){}try{e=r.sync("atom")}catch(u){}var d=s.get("mm_subl_location")[c.platformConfigKey]||s.get("mm_subl_location");try{t=r.sync("subl")}catch(u){}var p=l.existsSync(i)?i:e,m=l.existsSync(d)?d:t,f=l.existsSync(a)?a:n;return p&&(o.atom=p),m&&(o.sublime=m),f&&(o.vscode=f),o},m.prototype.launchUI=function(e,t){var n=this;return new o(function(o,r){var i=process.env.MAVENSMATE_SERVER_PORT;if(!i)return r(new Error("Could not detect local MavensMate server port. Set MAVENSMATE_SERVER_PORT environment variable."));var c="http://localhost:"+i+"/app/"+e;n.editor&&t?t.editor=n.editor:n.editor&&(t={},t.editor=n.editor),t&&(c+="?"+p.stringify(t)),a.debug("opening url --->"),a.debug(c),n.openWindowFn?(n.openWindowFn(c),o()):d(c,function(){"cli"===process.env.MAVENSMATE_CONTEXT?(o(),process.exit(0)):o()})})},m.prototype.openUrl=function(e){var t=this;return new o(function(n,o){try{if(t.openWindowFn)t.openWindowFn(e),n();else if("darwin"===u.platform()){var r=i("open",[e],{detached:!0});r.on("close",function(e){0===e&&n()})}else d(e,function(){n()})}catch(a){o(a)}})},m.prototype.runCommand=function(e){var t=this;return new o(function(n,o){if("sublime"===t.editor){var r=i(t.supportedEditors[t.editor],["--command",e]);r.stdout.on("data",function(e){a.debug("editor command STDOUT:"),a.debug(e)}),r.stderr.on("data",function(e){return a.error("ERROR: Result of run command in editor: "),a.error(e),n()}),r.on("close",function(e){a.debug("editorExe close: "),a.debug(e),0!==e?(a.error("Could not run command in "+t.editor),n()):n()}),r.on("error",function(e){a.error(e),n()})}else n()})},m.prototype.open=function(e){var t=this;return new o(function(n,o){var r=i(t.supportedEditors[t.editor],[e]);r.stdout.on("data",function(e){a.debug("editorExe STDOUT:"),a.debug(e)}),r.stderr.on("data",function(e){return a.error("Result of path open in self.editor: "),a.error(e),o(new Error("Could not open in editor"))}),r.on("close",function(e){a.debug("editorExe close: "),a.debug(e),0!==e?o(new Error("Could not open path in "+t.editor+". Check your MavensMate global settings to ensure self.editor paths are configured properly for "+t.editor)):n()}),r.on("error",function(e){return o(e)})})},e.exports=m},function(e,t){e.exports=require("fs-extra")},function(e,t,n){(function(t){"use strict";var o=n(1),r=n(7),i=n(10),a=n(6),c=n(15).MetadataHelper,s=n(3),u=n(8),l=(n(100),n(28)),d=n(4),p=n(95),m={TOP_LEVEL_METADATA_DIRECTORY:"TOP_LEVEL_METADATA_DIRECTORY",TOP_LEVEL_METADATA_FILE:"TOP_LEVEL_METADATA_FILE",METADATA_FOLDER:"METADATA_FOLDER",METADATA_FOLDER_ITEM:"METADATA_FOLDER_ITEM",LIGHTNING_BUNDLE:"LIGHTNING_BUNDLE",LIGHTNING_BUNDLE_ITEM:"LIGHTNING_BUNDLE_ITEM"};Object.freeze(m);var f={STYLE:"STYLE",APPLICATION:"APPLICATION",DOCUMENTATION:"DOCUMENTATION",COMPONENT:"COMPONENT",EVENT:"EVENT",INTERFACE:"INTERFACE",CONTROLLER:"CONTROLLER",HELPER:"HELPER",RENDERER:"RENDERER"};Object.freeze(f);var h=function(e){e=e||{},this.path=e.path,this.project=e.project,this.metadataHelper=this.project?new c({sfdcClient:this.project.sfdcClient}):new c,this.path&&(this.path=a.normalize(this.path),this.type=this.metadataHelper.getTypeByPath(this.path),this.basename=a.basename(this.path),this.extension=a.extname(this.path).replace(/./,""),this.basename.match(/./g)||1===[].length?this.name=this.basename.split(".")[0]:this.name=a.basename(this.basename,"."+this.extension),this.folderName=a.basename(a.dirname(this.path)))};h.prototype._template=null,h.prototype._basename=null,h.prototype._name=null,h.prototype._folderName=null,h.prototype._extension=null,h.prototype._apexTriggerObjectName=null,Object.defineProperty(h.prototype,"isDirectory",{get:function(){return"Document"===this.type.xmlName?""===a.extname(this.path):""===a.extname(this.path)}}),Object.defineProperty(h.prototype,"basename",{get:function(){return this._basename},set:function(e){this._basename=e}}),Object.defineProperty(h.prototype,"apexTriggerObjectName",{get:function(){return this._apexTriggerObjectName},set:function(e){this._apexTriggerObjectName=e}}),Object.defineProperty(h.prototype,"name",{get:function(){return this._name},set:function(e){this._name=e}}),Object.defineProperty(h.prototype,"folderName",{get:function(){return this._folderName},set:function(e){this._folderName=e}}),Object.defineProperty(h.prototype,"extension",{get:function(){return this._extension},set:function(e){this._extension=e}}),Object.defineProperty(h.prototype,"packageName",{get:function(){return this.classification===m.METADATA_FOLDER_ITEM?this.folderName+"/"+this.name:this.name}}),Object.defineProperty(h.prototype,"isToolingType",{get:function(){var e=["cls","trigger","page","component"];return e.indexOf(this.extension)>=0}}),Object.defineProperty(h.prototype,"isLightningType",{get:function(){return"AuraDefinitionBundle"===this.type.xmlName}}),Object.defineProperty(h.prototype,"lightningBaseName",{get:function(){var e=this.name;return s.endsWith(e,"Controller")?e=e.replace(/Controller/,""):s.endsWith(e,"Helper")&&(e=e.replace(/Helper/,"")),s.endsWith(e,"Renderer")&&(e=e.replace(/Renderer/,"")),e}}),Object.defineProperty(h.prototype,"lightningType",{get:function(){if("css"===this.extension)return"STYLE";if("app"===this.extension)return"APPLICATION";if("auradoc"===this.extension)return"DOCUMENTATION";if("cmp"===this.extension)return"COMPONENT";if("evt"===this.extension)return"EVENT";if("intf"===this.extension)return"INTERFACE";if("js"===this.extension){if(s.endsWith(this.name,"Controller"))return"CONTROLLER";if(s.endsWith(this.name,"Helper"))return"HELPER";if(s.endsWith(this.name,"Renderer"))return"RENDERER"}}}),Object.defineProperty(h.prototype,"classification",{get:function(){if(this.type.inFolder){var e=this.metadataHelper.inFolderDirectoryNames;return this.isDirectory?e.indexOf(a.basename(a.dirname(this.path)))>=0?m.TOP_LEVEL_METADATA_DIRECTORY:m.METADATA_FOLDER:m.METADATA_FOLDER_ITEM}return"AuraDefinitionBundle"===this.type.xmlName?this.isDirectory?m.LIGHTNING_BUNDLE:m.LIGHTNING_BUNDLE_ITEM:this.isDirectory?m.TOP_LEVEL_METADATA_DIRECTORY:m.TOP_LEVEL_METADATA_FILE}}),Object.defineProperty(h.prototype,"body",{get:function(){if(this.isDirectory)throw new Error("Can not get body of directory");return s.getFileBody(this.path)}}),Object.defineProperty(h.prototype,"hasMetaFile",{get:function(){return this.type.metaFile===!0}}),Object.defineProperty(h.prototype,"existsOnFileSystem",{get:function(){return!!this.path&&i.existsSync(this.path)}}),Object.defineProperty(h.prototype,"isMetaFile",{get:function(){return s.endsWith(this.path,"-meta.xml")}}),Object.defineProperty(h.prototype,"id",{get:function(){try{if(this.isDirectory)throw new Error("Cannot get server id for directory.");if(this.isLightningType&&this.project){var e=this.project.getLightningIndexSync();return r.find(e,{AuraDefinitionBundle:{DeveloperName:this.lightningBaseName},DefType:this.lightningType}).Id}if(this.project)return this.project.getLocalStore()[this.basename].id}catch(t){d.debug("Could not determine metadata id: "+t.message)}}}),Object.defineProperty(h.prototype,"localStoreEntry",{get:function(){try{if(this.isDirectory||this.isLightningType)throw new Error("Cannot get local store entry for directories or lightning types currently.");return this.project.getLocalStore()[this.basename]}catch(e){d.debug("Could not determine local store entry: "+e.message)}}}),Object.defineProperty(h.prototype,"serverCopy",{get:function(){var e=this;return new o(function(t,n){try{if(e.isDirectory||e.isLightningType)throw new Error("Cannot get server contents for directories or lightning types currently.");if(!e.project)throw new Error("Cannot get server contents without a valid project instance.");var o=["ApexClass","ApexPage","ApexComponent","ApexTrigger"];if(o.indexOf(e.type.xmlName)===-1)throw new Error("serverContents only supports Apex types.");var r="ApexPage"===e.type.xmlName||"ApexComponent"===e.type.xmlName?"Markup":"Body",i="Select LastModifiedById, LastModifiedDate, LastModifiedBy.Name, "+r+" From "+e.type.xmlName+" Where Name = '"+e.name+"'";e.project.sfdcClient.conn.query(i,function(e,o){if(e)return d.debug("could not get server contents: "+e.message),n(e);if(0==o.records.length){var e=new Error("Server copy query returned no results: "+i);return d.debug(e.message),n(e)}o.records[0].Body=o.records[0][r],t(o.records[0])})}catch(a){d.debug("Could not determine local store entry: "+a.message),n(a)}})}}),Object.defineProperty(h.prototype,"localMembers",{get:function(){if(!this.isDirectory)throw new Error("localMembers property is only supported for directory types");var e=this,t=[],n=i.readdirSync(e.path);return r.each(n,function(n){if(t.push(new h({path:a.join(e.path,n),project:e.project})),!a.extname(n)){var o=i.readdirSync(a.join(e.path,n));r.each(o,function(o){t.push(new h({path:a.join(e.path,n,o),project:e.project}))})}}),t}}),Object.defineProperty(h.prototype,"folderBaseName",{get:function(){var e=a.dirname(this.path);return a.basename(e)}}),Object.defineProperty(h.prototype,"template",{get:function(){return this._template},set:function(e){this._template=e}}),Object.defineProperty(h.prototype,"subscriptionName",{get:function(){return this.type.inFolder?"Document"===this.type.xmlName?this.folderBaseName+"/"+this.name+"."+this.extension:this.folderBaseName+"/"+this.name:this.name}}),h.prototype.setTypeByXmlName=function(e){this.type=this.metadataHelper.getTypeByXmlName(e)},h.prototype.setAbstractPath=function(){this.path=this.type.directoryName+"/"+this.name+"."+this.type.suffix,this.extension=this.type.suffix,this.basename=a.basename(this.path),this.name=this.basename.split(".")[0],this.folderName=a.basename(a.dirname(this.path))},h.prototype._getTemplateBody=function(){var e=this;return new o(function(t,n){try{var o=new p;t(o.getTemplateBody(e.type.xmlName,e.template.file_name))}catch(r){d.error("Could not get template body",r),n(r)}})},h.prototype.mergeTemplate=function(){var e=this;return new o(function(t,n){e.name;e._getTemplateBody().then(function(n){t(l.render(n,{locals:e.templateValues}))})["catch"](function(e){n(e)}).done()})},h.prototype.renderAndWriteToDisk=function(e){var n=this;return new o(function(o,r){var c=n.name;n._getTemplateBody().then(function(r){var s=a.join(e,n.type.directoryName,[c,n.type.suffix].join(".")),d=l.render(r,{locals:n.templateValues});if(i.outputFileSync(s,d),n.hasMetaFile){var p=a.join(e,n.type.directoryName,[c,n.type.suffix+"-meta.xml"].join(".")),m=l.renderFile(a.join(t,"templates","meta.xml"),{metadata:n,apiVersion:u.get("mm_api_version")});i.outputFileSync(p,m)}o()})["catch"](function(e){r(new Error("Could not write metadata file based on template: "+e))}).done()})},h.prototype.writeToDiskSync=function(e){e=e||"",this.isDirectory&&this.path?i.ensureDirSync(this.path):!this.isDirectory&&this.path&&i.outputFileSync(this.path,e)},h.prototype.deleteLocally=function(){this.hasMetaFile&&i.existsSync(this.path+"-meta.xml")&&i.removeSync(this.path+"-meta.xml"),this.existsOnFileSystem&&i.removeSync(this.path)},e.exports.createFileInstances=function(e,t){var n=[];return r.each(e,function(e){n.push(new h({path:e,project:t}))}),n},e.exports.getLightningBundleItemFiles=function(e){return r.filter(e,function(e){return e.classification===m.LIGHTNING_BUNDLE_ITEM})},e.exports.getToolingFiles=function(e,t){return r.filter(e,function(e){return!t&&e.isToolingType})},e.exports.getMetadataApiFiles=function(e,t){return r.filter(e,function(e){return!!e.isMetaFile||e.classification!==m.LIGHTNING_BUNDLE_ITEM&&(!t||!e.isToolingType)})},e.exports.createPackageSubscription=function(e,t,n){var o={},i={};return t&&(i=t.subscription),r.each(e,function(e){e.isToolingType&&n||(e.classification===m.TOP_LEVEL_METADATA_DIRECTORY&&i?o[e.type.xmlName]=i[e.type.xmlName]:e.classification===m.TOP_LEVEL_METADATA_FILE?o[e.type.xmlName]?"*"!==o[e.type.xmlName]&&o[e.type.xmlName].push(e.packageName):o[e.type.xmlName]=[e.packageName]:e.classification===m.METADATA_FOLDER||e.classification===m.METADATA_FOLDER_ITEM?o[e.type.xmlName]?o[e.type.xmlName].push(e.packageName):o[e.type.xmlName]=[e.packageName]:e.classification===m.LIGHTNING_BUNDLE&&(o[e.type.xmlName]?o[e.type.xmlName].push(e.packageName):o[e.type.xmlName]=[e.packageName]))}),o},e.exports.types=m,e.exports.MavensMateFile=h}).call(t,"/")},function(e,t){e.exports=require("express")},function(e,t,n){"use strict";var o=n(7),r=n(35),i=n(25),a=n(4),c=n(2),s=function(){};c(s,i.EventEmitter),s.prototype.requests={},s.prototype.add=function(e){var t,n,o=this;return n=r.v1(),t={id:n,complete:!1,thenable:e},e.then(function(e){o._finish(n,null,e)})["catch"](function(e){o._finish(n,e,null)}),this.requests[n]=t,this.emit("new-request",n),n},s.prototype.isRequestComplete=function(e){return this.requests[e].complete},s.prototype.getResultForId=function(e){var t=o.clone(this.requests[e]);return delete t.thenable,delete this.requests[e],t},s.prototype._finish=function(e,t,n){if(a.debug("finishing requestId: "+e),t?a.error(t):n&&a.silly(n),t&&t instanceof Error)this.requests[e].error=t.message,this.requests[e].stack=t.stack;else{if(!n)throw a.error("Could not set request",e,"as finished",t,n),new Error("Could not finish request "+e);this.requests[e].result=n}this.emit("finish-request",e),this.requests[e].complete=!0},e.exports=new s},function(e,t){e.exports=require("electron")},function(e,t,n){"use strict";var o,r,i=n(7),a=(n(10),n(6)),c=n(3),s=n(4);o=function(e,t){this.project=t,this.path=e},Object.defineProperty(o.prototype,"serverContents",{get:function(){}}),r=function(e){c.applyProperties(this,e),this.sfdcClient&&this.sfdcClient.describeCache&&this.sfdcClient.describeCache.metadataObjects?this.describe=this.sfdcClient.describeCache:(this.describe={},this.describe.metadataObjects=this.parentTypes)},r.prototype.getTypeByPath=function(e){var t=a.dirname(e),n=a.dirname(a.dirname(e));if(!a.extname(e)&&"aura"===a.basename(t))return this.getTypeByDirectoryName("aura");if("aura"===a.basename(n))return this.getTypeByDirectoryName("aura");var o=i.where(this.parentTypes,{inFolder:!0});if(!a.extname(e)){var r=i.find(this.parentTypes,{directoryName:a.basename(e)});if(r)return this.getTypeByDirectoryName(a.basename(e));var s=i.find(o,{directoryName:a.basename(t)});if(s)return this.getTypeByDirectoryName(a.basename(t))}var u;u=c.endsWith(e,"-meta.xml")?e.replace("-meta.xml","").split(".").pop():e.split(".").pop();var l=this.getTypeBySuffix(u);if(l)return l;var d=i.find(o,{directoryName:a.basename(n)});return d?this.getTypeByDirectoryName(a.basename(n)):c.endsWith(e,"-meta.xml")?this.getTypeByDirectoryName(a.basename(t)):void 0},r.prototype.getTypeByXmlName=function(e){var t,n=this;return t=i.find(n.describe.metadataObjects,function(t){return t.xmlName===e}),t||(t=i.find(n.childTypes,function(t){return t.xmlName===e})),t||(t=i.find(n.parentTypes,function(t){return t.xmlName===e})),s.silly("getting metadata type by name: "+e),s.silly(t),t},r.prototype.getTypeBySuffix=function(e){var t,n=this;return e.indexOf(".")>=0&&(e=e.replace(/\./g,"")),i.each(n.describe.metadataObjects,function(n){if(n.suffix===e)return t=n,!1}),t},r.prototype.getTypeByDirectoryName=function(e){var t,n=this;return i.each(n.describe.metadataObjects,function(n){if(n.directoryName===e)return t=n,!1}),void 0===t&&i.each(n.parentTypes,function(n){if(n.directoryName===e)return t=n,!1}),t},r.prototype.childTypes=[{xmlName:"ActionOverride",tagName:"actionOverrides",parentXmlName:"CustomObject"},{xmlName:"CustomField",tagName:"fields",parentXmlName:"CustomObject"},{xmlName:"BusinessProcess",tagName:"businessProcesses",parentXmlName:"CustomObject"},{xmlName:"RecordType",tagName:"recordTypes",parentXmlName:"CustomObject"},{xmlName:"WebLink",tagName:"webLinks",parentXmlName:"CustomObject"},{xmlName:"ValidationRule",tagName:"validationRules",parentXmlName:"CustomObject"},{xmlName:"NamedFilter",tagName:"namedFilters",parentXmlName:"CustomObject"},{xmlName:"SharingReason",tagName:"sharingReasons",parentXmlName:"CustomObject"},{xmlName:"ListView",tagName:"listViews",parentXmlName:"CustomObject"},{xmlName:"FieldSet",tagName:"fieldSets",parentXmlName:"CustomObject"},{xmlName:"SharingRecalculation",tagName:"sharingRecalculations",parentXmlName:"CustomObject"},{xmlName:"CompactLayout",tagName:"compactLayouts",parentXmlName:"CustomObject"},{xmlName:"CustomLabel",tagName:"customLabels",parentXmlName:"CustomLabels"},{xmlName:"SharingCriteriaRule",tagName:"sharingCriteriaRules",parentXmlName:"SharingRules"},{xmlName:"SharingOwnerRule",tagName:"sharingOwnerRules",parentXmlName:"SharingRules"},{xmlName:"SharingTerritoryRule",tagName:"sharingTerritoryRules",parentXmlName:"SharingRules"},{xmlName:"WorkflowAlert",tagName:"alerts",parentXmlName:"Workflow"},{xmlName:"WorkflowTask",tagName:"tasks",parentXmlName:"Workflow"},{xmlName:"WorkflowOutboundMessage",tagName:"outboundMessages",parentXmlName:"Workflow"},{xmlName:"WorkflowFieldUpdate",tagName:"fieldUpdates",parentXmlName:"Workflow"},{xmlName:"WorkflowRule",tagName:"rules",parentXmlName:"Workflow"},{xmlName:"WorkflowEmailRecipient",tagName:"emailRecipients",parentXmlName:"Workflow"},{xmlName:"WorkflowTimeTrigger",tagName:"timeTriggers",parentXmlName:"Workflow"},{xmlName:"WorkflowActionReference",tagName:"actionReferences",parentXmlName:"Workflow"}],r.prototype.parentTypes=[{directoryName:"customMetadata",inFolder:!1,metaFile:!1,suffix:"md",xmlName:"CustomMetadata"},{directoryName:"installedPackages",inFolder:!1,metaFile:!1,
suffix:"installedPackage",xmlName:"InstalledPackage"},{childXmlNames:"CustomLabel",directoryName:"labels",inFolder:!1,metaFile:!1,suffix:"labels",xmlName:"CustomLabels"},{directoryName:"staticresources",inFolder:!1,metaFile:!0,suffix:"resource",xmlName:"StaticResource"},{directoryName:"scontrols",inFolder:!1,metaFile:!0,suffix:"scf",xmlName:"Scontrol"},{directoryName:"components",inFolder:!1,metaFile:!0,suffix:"component",xmlName:"ApexComponent"},{directoryName:"pages",inFolder:!1,metaFile:!0,suffix:"page",xmlName:"ApexPage"},{directoryName:"queues",inFolder:!1,metaFile:!1,suffix:"queue",xmlName:"Queue"},{childXmlNames:["CustomField","BusinessProcess","CompactLayout","RecordType","WebLink","ValidationRule","NamedFilter","SharingReason","ListView","FieldSet","ApexTriggerCoupling"],directoryName:"objects",inFolder:!1,metaFile:!1,suffix:"object",xmlName:"CustomObject"},{directoryName:"reportTypes",inFolder:!1,metaFile:!1,suffix:"reportType",xmlName:"ReportType"},{directoryName:"reports",inFolder:!0,metaFile:!1,suffix:"report",xmlName:"Report"},{directoryName:"dashboards",inFolder:!0,metaFile:!1,suffix:"dashboard",xmlName:"Dashboard"},{directoryName:"analyticSnapshots",inFolder:!1,metaFile:!1,suffix:"snapshot",xmlName:"AnalyticSnapshot"},{directoryName:"layouts",inFolder:!1,metaFile:!1,suffix:"layout",xmlName:"Layout"},{directoryName:"portals",inFolder:!1,metaFile:!1,suffix:"portal",xmlName:"Portal"},{directoryName:"documents",inFolder:!0,metaFile:!0,xmlName:"Document"},{directoryName:"weblinks",inFolder:!1,metaFile:!1,suffix:"weblink",xmlName:"CustomPageWebLink"},{directoryName:"quickActions",inFolder:!1,metaFile:!1,suffix:"quickAction",xmlName:"QuickAction"},{childXmlNames:{"@xsi:nil":"true"},directoryName:"flexipages",inFolder:!1,metaFile:!1,suffix:"flexipage",xmlName:"FlexiPage"},{directoryName:"tabs",inFolder:!1,metaFile:!1,suffix:"tab",xmlName:"CustomTab"},{directoryName:"customApplicationComponents",inFolder:!1,metaFile:!1,suffix:"customApplicationComponent",xmlName:"CustomApplicationComponent"},{directoryName:"applications",inFolder:!1,metaFile:!1,suffix:"app",xmlName:"CustomApplication"},{directoryName:"letterhead",inFolder:!1,metaFile:!1,suffix:"letter",xmlName:"Letterhead"},{directoryName:"email",inFolder:!0,metaFile:!0,suffix:"email",xmlName:"EmailTemplate"},{childXmlNames:["WorkflowFieldUpdate","WorkflowKnowledgePublish","WorkflowQuickCreate","WorkflowTask","WorkflowChatterPost","WorkflowAlert","WorkflowSend","WorkflowOutboundMessage","WorkflowActionFlow","WorkflowApex","WorkflowRule"],directoryName:"workflows",inFolder:!1,metaFile:!1,suffix:"workflow",xmlName:"Workflow"},{childXmlNames:"AssignmentRule",directoryName:"assignmentRules",inFolder:!1,metaFile:!1,suffix:"assignmentRules",xmlName:"AssignmentRules"},{childXmlNames:"AutoResponseRule",directoryName:"autoResponseRules",inFolder:!1,metaFile:!1,suffix:"autoResponseRules",xmlName:"AutoResponseRules"},{childXmlNames:"EscalationRule",directoryName:"escalationRules",inFolder:!1,metaFile:!1,suffix:"escalationRules",xmlName:"EscalationRules"},{directoryName:"roles",inFolder:!1,metaFile:!1,suffix:"role",xmlName:"Role"},{directoryName:"groups",inFolder:!1,metaFile:!1,suffix:"group",xmlName:"Group"},{directoryName:"postTemplates",inFolder:!1,metaFile:!1,suffix:"postTemplate",xmlName:"PostTemplate"},{directoryName:"approvalProcesses",inFolder:!1,metaFile:!1,suffix:"approvalProcess",xmlName:"ApprovalProcess"},{directoryName:"homePageComponents",inFolder:!1,metaFile:!1,suffix:"homePageComponent",xmlName:"HomePageComponent"},{directoryName:"homePageLayouts",inFolder:!1,metaFile:!1,suffix:"homePageLayout",xmlName:"HomePageLayout"},{directoryName:"objectTranslations",inFolder:!1,metaFile:!1,suffix:"objectTranslation",xmlName:"CustomObjectTranslation"},{directoryName:"flows",inFolder:!1,metaFile:!1,suffix:"flow",xmlName:"Flow"},{directoryName:"classes",inFolder:!1,metaFile:!0,suffix:"cls",xmlName:"ApexClass"},{directoryName:"triggers",inFolder:!1,metaFile:!0,suffix:"trigger",xmlName:"ApexTrigger"},{directoryName:"profiles",inFolder:!1,metaFile:!1,suffix:"profile",xmlName:"Profile"},{directoryName:"permissionsets",inFolder:!1,metaFile:!1,suffix:"permissionset",xmlName:"PermissionSet"},{directoryName:"datacategorygroups",inFolder:!1,metaFile:!1,suffix:"datacategorygroup",xmlName:"DataCategoryGroup"},{directoryName:"remoteSiteSettings",inFolder:!1,metaFile:!1,suffix:"remoteSite",xmlName:"RemoteSiteSetting"},{directoryName:"authproviders",inFolder:!1,metaFile:!1,suffix:"authprovider",xmlName:"AuthProvider"},{childXmlNames:["LeadOwnerSharingRule","LeadCriteriaBasedSharingRule"],directoryName:"leadSharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"LeadSharingRules"},{childXmlNames:["CampaignOwnerSharingRule","CampaignCriteriaBasedSharingRule"],directoryName:"campaignSharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"CampaignSharingRules"},{childXmlNames:["CaseOwnerSharingRule","CaseCriteriaBasedSharingRule"],directoryName:"caseSharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"CaseSharingRules"},{childXmlNames:["ContactOwnerSharingRule","ContactCriteriaBasedSharingRule"],directoryName:"contactSharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"ContactSharingRules"},{childXmlNames:["OpportunityOwnerSharingRule","OpportunityCriteriaBasedSharingRule"],directoryName:"opportunitySharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"OpportunitySharingRules"},{childXmlNames:["AccountOwnerSharingRule","AccountCriteriaBasedSharingRule"],directoryName:"accountSharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"AccountSharingRules"},{childXmlNames:["CustomObjectOwnerSharingRule","CustomObjectCriteriaBasedSharingRule"],directoryName:"customObjectSharingRules",inFolder:!1,metaFile:!1,suffix:"sharingRules",xmlName:"CustomObjectSharingRules"},{directoryName:"communities",inFolder:!1,metaFile:!1,suffix:"community",xmlName:"Community"},{directoryName:"callCenters",inFolder:!1,metaFile:!1,suffix:"callCenter",xmlName:"CallCenter"},{directoryName:"connectedApps",inFolder:!1,metaFile:!1,suffix:"connectedApp",xmlName:"ConnectedApp"},{directoryName:"samlssoconfigs",inFolder:!1,metaFile:!1,suffix:"samlssoconfig",xmlName:"SamlSsoConfig"},{directoryName:"synonymDictionaries",inFolder:!1,metaFile:!1,suffix:"synonymDictionary",xmlName:"SynonymDictionary"},{directoryName:"settings",inFolder:!1,metaFile:!1,suffix:"settings",xmlName:"Settings"},{directoryName:"aura",inFolder:!1,metaFile:!1,xmlName:"AuraDefinitionBundle"}],r.prototype.inFolderDirectoryNames=function(){var e=[],t=this,n=t.describe.metadataObjects&&t.describe.metadataObjects.length>0?t.describe.metadataObjects:t.parentTypes;return i.each(n,function(t){t.inFolder&&e.push(t.directoryName)}),e},e.exports.LightningBundle=o,e.exports.MetadataHelper=r},function(e,t,n){"use strict";var o=n(1),r=n(7),i=n(6),a=n(4),c=n(3),s=function(e){this.project=e};s.prototype.getAll=function(){var e=this;return new o(function(t,n){e.project.sfdcClient.conn.tooling.query("Select Id, AuraDefinitionBundleId,AuraDefinitionBundle.DeveloperName,DefType,Format FROM AuraDefinition",function(e,o){e?n(e):t(o.records)})})},s.prototype.createBundle=function(e,t){var n=this;return a.debug("Creating lightning bundle: "+e),new o(function(o,r){n.project.sfdcClient.conn.tooling.sobject("AuraDefinitionBundle").create({Description:t,DeveloperName:e,MasterLabel:e,ApiVersion:n.project.sfdcClient.apiVersion||"32.0"},function(e,t){e?r(e):(a.debug("Lightning bundle creation result: "),a.debug(t),o(t))})})},s.prototype.deleteBundle=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinitionBundle")["delete"](e,function(e,t){e?o(new Error("Could not delete AuraBundle: "+e.message)):n(t)})})},s.prototype.deleteBundleItems=function(e){var t=this;return new o(function(n,o){return 0===e.length?n():void t.project.getLightningIndex().then(function(i){a.debug(i);var c=[];r.each(e,function(e){var t=e.folderName,n=e.lightningType;a.debug("deleting lightning type: "+n),a.debug("deleting lightningBundleName: "+t),c.push(r.find(i,{AuraDefinitionBundle:{DeveloperName:t},DefType:n}).Id)}),a.debug("deleting lightning components!!"),a.debug(e),a.debug(c),t.project.sfdcClient.conn.tooling.sobject("AuraDefinition")["delete"](c,function(e,t){e?o(new Error("Could not delete AuraBundle item: "+e.message)):n(t)})})["catch"](function(e){o(new Error("Could not get delete bundle items: "+e.message))})})},s.prototype.getBundle=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.query("Select Id, AuraDefinitionBundleId,AuraDefinitionBundle.DeveloperName,DefType,Format FROM AuraDefinition WHERE AuraDefinitionBundleId = '"+e+"'",function(e,t){e?o(e):n(t)})})},s.prototype.getBundleItems=function(e){var t=this;return new o(function(n,o){return 0===e.length?n():(a.debug("attempting to get index"),void t.project.getLightningIndex().then(function(i){a.debug("got lightning index"),a.debug(i);var s=[];r.each(e,function(e){var t=e.folderName,n=e.lightningType;a.debug("getting lightning type: "+n),a.debug("getting lightningBundleName: "+t),s.push(r.find(i,{AuraDefinitionBundle:{DeveloperName:t},DefType:n}).Id)}),a.debug("getting lightning components!!"),a.debug(s),t.project.sfdcClient.conn.tooling.query("Select Id,AuraDefinitionBundleId,AuraDefinitionBundle.DeveloperName,DefType,Format,Source FROM AuraDefinition WHERE Id IN ("+c.joinForQuery(s)+")",function(e,t){e?o(e):n(t)})})["catch"](function(e){o(new Error("Could not get bundle items: "+e.message))}))})},s.prototype.update=function(e){var t=this;return new o(function(n,o){0===e.length?n():t.project.getLightningIndex().then(function(c){a.debug(c);var s=[];r.each(e,function(e){var t=i.basename(i.dirname(e.path)),n=e.lightningType;a.debug("lightning type: "+n),a.debug("lightningBundleName: "+t);var o={Source:e.body,Id:r.find(c,{AuraDefinitionBundle:{DeveloperName:t},DefType:n}).Id};s.push(o)}),a.debug("updating lightning components!!"),a.debug(s),t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").update(s,function(e,t){e?o(e):n(t)})})["catch"](function(e){o(new Error("Could not update lightning components: "+e.message))})})},s.prototype.updateComponent=function(e,t){var n=this;return new o(function(o,r){n.project.sfdcClient.conn.tooling.sobject("AuraDefinition").update({Id:e,Source:t},function(e,t){e?r(e):o(t)})})},s.prototype.createComponent=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"COMPONENT",Format:"XML",Source:"<aura:component></aura:component>"},function(e,t){e?o(e):n(t)})})},s.prototype.createApplication=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"APPLICATION",Format:"XML",Source:"<aura:application></aura:application>"},function(e,t){e?o(e):n(t)})})},s.prototype.createInterface=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"INTERFACE",Format:"XML",Source:'<aura:interface description="Interface template">\n\t<aura:attribute name="example" type="String" default="" description="An example attribute."/>\n</aura:interface>'},function(e,t){e?o(e):n(t)})})},s.prototype.createDocumentation=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"DOCUMENTATION",Format:"XML",Source:'<aura:documentation>\n\t<aura:description>Documentation</aura:description>\n\t<aura:example name="ExampleName" ref="exampleComponentName" label="Label">\n\t\tExample Description\n\t</aura:example>\n</aura:documentation>'},function(e,t){e?o(e):n(t)})})},s.prototype.createController=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"CONTROLLER",Format:"JS",Source:"({\n\tmyAction : function(component, event, helper) {\n\t}\n})"},function(e,t){e?o(e):n(t)})})},s.prototype.createRenderer=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"RENDERER",Format:"JS",Source:"({\n\t// Your renderer method overrides go here\n})"},function(e,t){e?o(e):n(t)})})},s.prototype.createHelper=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"HELPER",Format:"JS",Source:"({\n\thelperMethod : function() {\n\t}\n})"},function(e,t){e?o(e):n(t)})})},s.prototype.createStyle=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"STYLE",Format:"CSS",Source:".THIS {\n}"},function(e,t){e?o(e):n(t)})})},s.prototype.createEvent=function(e){var t=this;return new o(function(n,o){t.project.sfdcClient.conn.tooling.sobject("AuraDefinition").create({AuraDefinitionBundleId:e,DefType:"EVENT",Format:"XML",Source:'<aura:event type="APPLICATION" description="Event template" />'},function(e,t){e?o(e):n(t)})})},e.exports=s},function(e,t,n){"use strict";function o(e){u.applyProperties(this,e),this.apiVersion=h.get("mm_api_version")||"36.0",this.clientId=process.env.SFDC_OAUTH_CLIENT_ID||"3MVG9uudbyLbNPZP7kLgoRiWVRqiN8gFcKwdAlztVnjgbj9shSk1vMXJNmV7W0ciFbeYiaP9D4tLfBBD06l_7",this.callbackUrl=process.env.SFDC_OAUTH_CALLBACK_URL||"https://localhost:56248/sfdc/auth/callback",f.debug("initiating SalesforceClient: ")}var r=n(138),i=n(1),a=n(31),c=n(7),s=n(99),u=n(3),l=n(25),d=n(2),p=n(145),m=p.Stream,f=n(4),h=n(8);d(o,l.EventEmitter),o.prototype._refreshFn=function(e,t){f.debug("jsforce calling MavensMate _refreshFn delegate",e),f.debug("manually refreshing access token..."),e.oauth2._postParams({grant_type:"refresh_token",refresh_token:e.refreshToken,client_id:e.oauth2.clientId},function(e,n){e?(f.error("_refreshFn error",e),t(e)):(f.debug("_refreshFn result",n),t(null,n.access_token,n))})},o.prototype._initWebServerRefreshHandler=function(){var e=this;e.conn.on("refresh",function(t,n){f.debug("connection refresh event...",t,n,e),e.accessToken=t,e.instanceUrl=n.instance_url,e.conn.identity(function(t,n){if(t)f.error("could not retrieve sfdc connection identity after token refresh");else try{e.conn.userInfo=s(e.conn.userInfo,n),e.startSystemStreamingListener().then(function(){f.debug("restarted streaming listener for sfdc client")})["catch"](function(e){f.error("Could not start streaming listener after sfdc client refresh",e)})}catch(o){f.error("could not merge user info after conn refresh")}e.emit("token-refresh",e)})})},o.prototype._initUsernamePasswordRefreshHandler=function(){var e=this;e.conn.on("refresh",function(t,n){e.accessToken=t,e.conn.identity(function(t,n){if(t)f.error("could not retrieve sfdc connection identity");else try{e.conn.userInfo=s(e.conn.userInfo,n),e.startSystemStreamingListener().then(function(){f.debug("restarted streaming listener for sfdc client")})["catch"](function(e){f.error("Could not start streaming listener after sfdc client refresh",e)})}catch(o){f.error("could not merge user info after conn refresh")}e.emit("token-refresh",e)})})},o.prototype.initialize=function(){var e=this;return new i(function(t,n){return e.initialized?t():(f.debug("initializing connection to salesforce ...",e),void(e.accessToken&&e.instanceUrl&&e["transient"]?(e.conn=new r.Connection({logLevel:h.get("mm_sfdc_api_log_level")||"FATAL",version:e.apiVersion,instanceUrl:e.instanceUrl||"https://na1.salesforce.com",accessToken:e.accessToken}),e._configureJsForce(),e.describe().then(function(){e.initialized=!0,t()})["catch"](function(e){n(e)}).done()):e.accessToken&&e.refreshToken?(e.conn=new r.Connection({oauth2:{clientId:e.clientId,redirectUri:e.callbackUrl},refreshFn:e._refreshFn,instanceUrl:e.instanceUrl||"https://na1.salesforce.com",accessToken:e.accessToken,refreshToken:e.refreshToken,logLevel:h.get("mm_sfdc_api_log_level")||"FATAL",version:e.apiVersion}),e._initWebServerRefreshHandler(),f.silly("initialized connection",e.conn),e.conn.identity().then(function(t){return e.conn.userInfo=s(e.conn.userInfo,t),e._configureJsForce(),e.describe()}).then(function(n){e.initialized=!0,t(e.conn)})["catch"](function(e){f.error(e),n(e)})):e.username&&e.password?(f.debug("logging in to salesforce via username/password flow: "+e.getLoginUrl()),e.conn=new r.Connection({oauth2:{clientId:e.clientId,redirectUri:e.callbackUrl},logLevel:h.get("mm_sfdc_api_log_level")||"FATAL",version:e.apiVersion,loginUrl:e.getLoginUrl()}),e._initUsernamePasswordRefreshHandler(),e.conn.login(e.username,e.password).then(function(t){return e.conn.identity()}).then(function(t){return e.conn.userInfo=s(e.conn.userInfo,t),e._configureJsForce(),e.describe()}).then(function(n){e.initialized=!0,t(e.conn)})["catch"](function(e){f.error(e),n(e)})):n(new Error("username/password or accesstoken/refreshtoken required"))))})},o.prototype._login=function(){return new i(function(e,t){})},o.prototype.getOrgType=function(){var e=["production","developer","sandbox","prerelease","custom"];return this.orgType&&e.indexOf(this.orgType.toLowerCase())===-1?e[1]:this.orgType?this.orgType.toLowerCase():e[1]},o.prototype.getUserId=function(){if(this.conn&&this.conn.userInfo)return this.conn.userInfo.user_id},o.prototype.getUsername=function(){return this.conn&&this.conn.userInfo?this.conn.userInfo.username:this.username},o.prototype.getNamespace=function(){return this.describeCache.organizationNamespace},o.prototype.getLoginUrl=function(){return this.loginUrl?this.loginUrl:"sandbox"===this.getOrgType()?"https://test.salesforce.com/":"https://login.salesforce.com/"},o.prototype.getAccessToken=function(){return this.conn&&this.conn.accessToken?this.conn.accessToken:this.accessToken?this.accessToken:void 0},o.prototype.getInstanceUrl=function(){return this.instanceUrl||this.conn.instanceUrl||void 0},o.prototype._configureJsForce=function(){f.debug("configuring jsforce ..."),this.conn.metadata.pollTimeout=1e3*parseInt(h.get("mm_timeout"))||2e4,this.conn.bulk.pollTimeout=1e3*parseInt(h.get("mm_timeout"))||2e4},o.prototype.setPollingTimeout=function(e){this.conn.metadata.pollTimeout=e||2e4,this.conn.bulk.pollTimeout=e||2e4},o.prototype.createApexMetadata=function(e){f.info("createApexMetadata"),f.info(e.type);var t=this;return new i(function(n,o){e.mergeTemplate().then(function(r){f.info(r);var i={};"ApexPage"===e.type.xmlName||"ApexComponent"===e.type.xmlName?i.markup=r:i.body=r,"ApexTrigger"===e.type.xmlName?i.TableEnumOrId=e.apexTriggerObjectName:"ApexClass"!==e.type.xmlName&&(i.name=e.name,i.MasterLabel=e.name),t.conn.tooling.sobject(e.type.xmlName).create(i,function(e,t){e&&e.message.indexOf("duplicates value on record with id")===-1?o(e):n(t)})})["catch"](function(e){o(e)})})},o.prototype.compileWithToolingApi=function(e){var t=this;return new i(function(n,o){if(c.filter(e,function(e){return!e.isToolingType}).length>0)return o("Invalid extension for tooling API compilation");var r;t._createContainer().then(function(n){r=n.id,f.debug("new container id is: "+r);var o=[];return c.each(e,function(e){o.push(t._createMember(e,r))}),i.all(o)}).then(function(e){var n=0===c.where(e,{success:!1}).length;return n?t._createContainerAsyncRequest(r):o("Could not create tooling members: "+JSON.stringify(e))}).then(function(e){t._pollAsyncContainer(r,e.id,n,o)})["catch"](function(e){o(e)}).done()})},o.prototype._asyncContainerRequestCompleteHandler=function(e,t,n,o){f.debug("asyncContainerRequestCompleteHandler"),f.debug("deleting container id:"),f.debug(e),f.silly(t);try{this._deleteContainer(e).then(function(){n(t)})}catch(r){o(r)}},o.prototype._asyncContainerRequestErrorHandler=function(e,t,n,o){f.debug("asyncContainerRequestErrorHandler"),f.debug("deleting container id:"),f.debug(e);try{this._deleteContainer(e).then(function(){o(t)})}catch(r){o(r)}},o.prototype._deleteContainer=function(e){var t=this;return new i(function(n,o){t.conn.tooling.sobject("MetadataContainer")["delete"](e,function(e,t){e?o(e):n(t)})})},o.prototype._createContainerAsyncRequest=function(e){var t=this;return new i(function(n,o){t.conn.tooling.sobject("ContainerAsyncRequest").create({IsCheckOnly:!1,MetadataContainerId:e,IsRunTests:!1},function(e,t){e?o(e):n(t)})})},o.prototype._pollAsyncContainer=function(e,t,n,o,r,i){f.debug("_pollAsyncContainer for requestId: "+t);var a=this,c=(new Date).getTime(),s=function(){var u=(new Date).getTime();return c+i<u?void a.emit("error",new Error("MavensMate timed out while polling Salesforce.com servers. To increase polling timeout, set mm_timeout to number of seconds.")):void a._getAsyncRequest(t).then(function(t){var i="Queued"!==t[0].State;i?a._asyncContainerRequestCompleteHandler(e,t,n,o):setTimeout(s,r)},function(t){a._asyncContainerRequestErrorHandler(e,t,n,o)})};setTimeout(s,r)},o.prototype._getAsyncRequest=function(e){var t=this;return new i(function(n,o){var r;r=parseInt(t.apiVersion)>=31?["Id","MetadataContainerId","MetadataContainerMemberId","State","IsCheckOnly","DeployDetails","ErrorMsg"]:["Id","MetadataContainerId","MetadataContainerMemberId","State","IsCheckOnly","CompilerErrors","ErrorMsg"],t.conn.tooling.sobject("ContainerAsyncRequest").find({Id:e},r).execute(function(e,t){e?o(e):n(t)})})},o.prototype._createContainer=function(){var e=this;return new i(function(t,n){e.conn.tooling.sobject("MetadataContainer").create({name:u.generateRandomString(32)},function(e,o){e?n("Could not create container: "+JSON.stringify(o)):t(o)})})},o.prototype._createMember=function(e,t){var n=this;return new i(function(o,r){var i=e.type.xmlName+"Member";f.debug("Creating tooling member:"),f.silly(e.body),f.debug(t),f.debug(e.id),n.conn.tooling.sobject(i).create({Body:e.body,MetadataContainerId:t,ContentEntityId:e.id},function(e,t){e?r(e):o(t)})})},o.prototype._checkTest=function(e){var t=this;return new i(function(n,o){t.conn.tooling.query("Select ApexClassId, ApexClass.Name, Status, ExtendedStatus From ApexTestQueueItem Where ParentJobId = '"+e+"' AND Status IN ('Aborted','Completed','Failed')",function(e,t){e?o(e):n(t)})})},o.prototype._getTestResults=function(e){var t=this;return new i(function(n,o){f.debug("getting test results for job id:",e),t.conn.tooling.query("SELECT Outcome, ApexClassId, ApexClass.Name, MethodName, Message, StackTrace, ApexLogId FROM ApexTestResult WHERE AsyncApexJobId = '"+e+"'",function(e,t){e?o(e):(f.silly("test results",t),n(t))})})},o.prototype.runTests=function(e){var t=this;return new i(function(n,o){var r,i=e.length,a=i>10?5e3:1e3;r=c.isString(e[0])?{classids:e.join(",")}:{tests:e},f.debug("submitting tests to be run via runTestsAsynchronous:",r),t.conn.request({method:"POST",url:"/services/data/v"+t.apiVersion+"/tooling/runTestsAsynchronous",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)},function(e,r){if(e)f.error("Error submitting to runTestsAsynchronous",e),o(e);else{f.info("result from runTestsAsynchronous POST",r);var c=r,s=(new Date).getTime(),u=function(){var e=(new Date).getTime();return s+t.conn.metadata.pollTimeout<e?void o(new Error("Apex test request timed out. Timeout can be configured via mm_timeout setting.")):void t._checkTest(c).then(function(e){f.debug("test status: "),f.debug(e),e.size===i?t._getTestResults(c).then(function(t){n({classResults:e,methodResults:t})})["catch"](function(e){o(new Error("Retrieving test results failed: "+e.message))}).done():setTimeout(u,a)})["catch"](function(e){o(new Error("Retrieving test results failed: "+e.message))}).done()};setTimeout(u,a)}})})},o.prototype.executeApex=function(e){var t=this;return new i(function(n,o){t.conn.tooling.executeAnonymous(e.body,function(e,t){e?o("Could not execute anonymous apex: "+e.message):n(t)})})},o.prototype.deploy=function(e,t){var n=this;return new i(function(o,r){n.conn.metadata.deploy(e,t).complete(!0,function(e,t){e?r(e):o(t)})})},o.prototype.retrievePackages=function(e){var t=this;return new i(function(n,o){var r=t.conn.metadata.retrieve({packageNames:e,apiVersion:t.apiVersion}).stream().pipe(a.createWriteStream("mavensmate.zip"));r.on("close",function(){f.debug("ended!"),n()})})},o.prototype.retrieveUnpackaged=function(e,t,n){var o=this;return new i(function(r,i){var a=[];f.debug("retrieving unpackaged: "),f.debug(e),c.isArray(e)?c.each(e,function(e){a.push({members:"*",name:e})}):c.forOwn(e,function(e,t){a.push({members:e,name:t})});var s=o.conn.metadata.retrieve({unpackaged:{types:a},apiVersion:o.apiVersion}),l=new m;l.readable=!0,s.complete(function(e,o){if(e)f.error("unpackaged retrieveRequest error: "+e.message),i(e.message.indexOf("polling time out")>=0?new Error("Request timed out. Timeout can be configured via mm_timeout setting."):e);else if(t){var a=u.writeStream(l,n);l.emit("data",new Buffer(o.zipFile,"base64")),l.emit("end"),a.then(function(e){return r({zipStream:l,fileProperties:o.fileProperties})})["catch"](function(e){return f.error("error retrieving and writing to disk"),f.error(e.message),i(e)})}else r(o)})})},o.prototype.describeGlobal=function(){var e=this;return new i(function(t,n){e.conn.describeGlobal(function(e,o){e?n(e):t(o)})})},o.prototype.describe=function(){var e=this;return new i(function(t,n){e.conn.metadata.describe(e.apiVersion,function(o,r){o?n(o):(e.describeCache=r,t(r))})})},o.prototype.listFolder=function(e,t){var n=this;return new i(function(o,r){var i={};n.conn.metadata.list([{type:e,folder:t}],function(e,n){e?r(e):(n?c.isArray(n)||(n=[n]):n=[],h.get("mm_ignore_managed_metadata")?i[t]=c.filter(n,function(e){return"unmanaged"===e.manageableState||void 0===e.manageableState}):i[t]=n,o(i))})})},o.prototype.list=function(e){var t=this;return new i(function(n,o){var r={};t.conn.metadata.list([{type:e}],function(t,i){t?o(t):(i?c.isArray(i)||(i=[i]):i=[],h.get("mm_ignore_managed_metadata")?r[e]=c.filter(i,function(e){return"unmanaged"===e.manageableState||void 0===e.manageableState}):r[e]=i,n(r))})})},o.prototype.startSystemStreamingListener=function(){var e=this;return new i(function(t,n){f.debug("starting system streaming listener");try{e.conn.streaming.channel("/systemTopic/Logging").subscribe(function(t){f.debug("New Log",t),f.debug("Event Type : "+t.event.type),f.debug("Event Created : "+t.event.createdDate),f.debug("Object Id : "+t.sobject.Id),e.emit("sfdcclient-new-log",t)}),f.debug("streaming listener successfully configured"),t()}catch(o){f.error("Could not start system streaming listener",o),h.get("mm_http_proxy")||h.get("mm_https_proxy")?(f.debug("user has proxy configured but streaming listener not functional."),t()):n(new Error("Could not start system streaming listener: "+o.message))}})},o.prototype.startLogging=function(e,t){var n=this,o=e.users,r=e.levels||{},a=e.debugLevelName||"MAVENSMATE";return f.debug("attempting to start logging for: "),f.debug(o),f.debug("expiring: "+t),new i(function(i,s){n.conn.tooling.query("SELECT Id FROM DebugLevel WHERE DeveloperName = '"+a+"' AND CreatedById = '"+n.conn.userInfo.user_id+"'",function(u,l){if(u)s(new Error("Could not retrieve DebugLevel: "+u.message));else{var d=[];c.each(l.records,function(e){d.push(e.Id)}),f.debug("attempting to delete debuglevels: "),f.debug(d),n.conn.tooling.sobject("DebugLevel").destroy(d).then(function(e){f.debug("deleted debug level"),f.debug(e),f.debug("creating debug level");var t=[],o={DeveloperName:a,MasterLabel:a,Workflow:r.Workflow||"DEBUG",Callout:r.Callout||"DEBUG",System:r.System||"DEBUG",Database:r.Database||"DEBUG",ApexCode:r.ApexCode||"DEBUG",ApexProfiling:r.ApexProfiling||"DEBUG",Validation:r.Validation||"DEBUG",Visualforce:r.Visualforce||"DEBUG"};return t.push(o),f.debug("attempting to create debug level"),n.conn.tooling.sobject("DebugLevel").create(t)}).then(function(r){f.debug("debugLevelCreateResult",r);var i=[];return c.each(o,function(n){var o={ExpirationDate:t,TracedEntityId:n,LogType:e.logType||"USER_DEBUG",DebugLevelId:r[0].id};i.push(o)}),f.debug("attempting to create trace flags"),n.conn.tooling.sobject("TraceFlag").create(i)}).then(function(e){f.debug("Created trace flag(s) for users: "),f.debug(e),i()})["catch"](function(e){s(new Error("Could not create Trace Flags: "+e.message))}).done()}})})},o.prototype.executeSoql=function(e){var t=this;return new i(function(n,o){t.conn.query(e,function(e,t){e?o(e):n(t)})})},o.prototype.stopLogging=function(e){var t=this;return new i(function(n,o){t.conn.tooling.query("SELECT Id FROM TraceFlag WHERE TracedEntityId IN ("+u.joinForQuery(e)+") AND CreatedById = '"+t.conn.userInfo.user_id+"'",function(e,r){if(e)o(new Error("Could not retrieve TraceFlags for debug users: "+e.message));else{var i=[];c.each(r.records,function(e){i.push(e.Id)}),t.conn.tooling.sobject("TraceFlag").destroy(i).then(function(e){f.debug("deleted trace flags"),f.debug(e),n()})["catch"](function(e){o(new Error("Could not delete Trace Flags: "+e.message))}).done()}})})},o.prototype.getServerProperties=function(e){var t=this;return new i(function(n,o){f.debug("getting server properties ..."),f.silly(e);var r="Select Id, Name, CreatedDate, CreatedById, NamespacePrefix, CreatedBy.Name, LastModifiedById, LastModifiedDate, LastModifiedBy.Name From ",a=" WHERE ID IN (",s=[],l=[],d=[],p=[],m=[],h=[],g=[],y=[];c.each(e,function(e){"ApexPage"===e.type.xmlName?(h.push(e.id),m.push(e)):"ApexTrigger"===e.type.xmlName?(p.push(e.id),d.push(e)):"ApexClass"===e.type.xmlName?(l.push(e.id),s.push(e)):"ApexComponent"===e.type.xmlName&&(y.push(e.id),g.push(e))});var v=[];s.length>0&&v.push(t.conn.query(r+"ApexClass"+a+u.joinForQuery(l)+")")),g.length>0&&v.push(t.conn.query(r+"ApexComponent"+a+u.joinForQuery(y)+")")),d.length>0&&v.push(t.conn.query(r+"ApexTrigger"+a+u.joinForQuery(p)+")")),m.length>0&&v.push(t.conn.query(r+"ApexPage"+a+u.joinForQuery(h)+")")),i.all(v).then(function(e){var t=[];c.each(e,function(e){e.records&&e.records.length>0&&Array.prototype.push.apply(t,e.records)}),n(t)})["catch"](function(e){f.error("could not get server properties for Apex/VF metadata",e),o(e)})})},e.exports=o},function(e,t,n){"use strict";function o(e){l.applyProperties(this,e),this.sfdcClient=this.project?this.project.sfdcClient:this.sfdcClient,this.metadataHelper=new g({sfdcClient:this.sfdcClient})}var r=n(1),i=n(7),a=n(19),c=n(28),s=n(10),u=n(6),l=n(3),d=n(25),p=n(2),m=n(17),f=n(24),h=n(20).Package,g=n(15).MetadataHelper,y=n(4),v=n(8),b=n(11);p(o,d.EventEmitter),o.prototype.getResultHtml=function(e,t,n){var o=c.renderFile("views/deploy/result.html",{results:n,targets:e,deployOptions:t,project:this.project});return{html:o,object:n}},o.prototype.getNamedDeployments=function(){var e=this;if(!e.project)throw new Error("No project found");var t=[];return t.push({name:"Project package.xml",path:u.join(e.project.path,"src","package.xml")}),s.existsSync(u.join(this.project.path,"deploy"))?(i.each(l.listDirectories(u.join(this.project.path,"deploy")),function(e){t.push({name:u.basename(e),path:u.join(e,"unpackaged","package.xml")})}),t):t},o.prototype.compileWithMetadataApi=function(e,t){var n=this;return new r(function(o,i){y.debug("compiling metadata via metadata api: ");var a;n.stage(e,t).then(function(e){return n.project.sfdcClient.deploy(e,{rollbackOnError:!0,performRetrieve:!0})}).then(function(e){return y.debug("Compile result: "),y.debug(e),a=e,a.details.retrieveResult?n.project.updateLocalStore(a.details.retrieveResult.fileProperties):new r(function(e){e()})}).then(function(){o(a)})["catch"](function(e){i(e)}).done()})},o.prototype.executeRemote=function(e){var t=this;return t.orgConnectionService=new f(t.project),y.debug("deploying to remote"),new r(function(n,o){if(!t.targets||0===t.targets.length)return o(new Error("Please specify at least one deployment target"));var c=[];e=e||{rollbackOnError:!0,performRetrieve:!0};var l=a.mkdirSync({
prefix:"mm_"});t.project.sfdcClient.retrieveUnpackaged(t["package"],!0,l).then(function(n){return y.debug("retrieved deployment payload from remote, preparing to deploy to targets"),y.debug(t.targets),v.get("mm_archive_deployments")===!0,t.deploymentName&&(s.existsSync(u.join(t.project.path,"deploy",t.deploymentName))?(s.removeSync(u.join(t.project.path,"deploy",t.deploymentName)),s.copySync(u.join(l,"unpackaged"),u.join(t.project.path,"deploy",t.deploymentName,"unpackaged"))):(s.ensureDirSync(u.join(t.project.path,"deploy",t.deploymentName,"unpackaged")),s.copySync(u.join(l,"unpackaged"),u.join(t.project.path,"deploy",t.deploymentName,"unpackaged")))),i.each(t.targets,function(n){var o=i.isString(n)?n:n.id;y.debug("adding deploy target id: ",o),y.debug("deploy options",e);var r=t.orgConnectionService.getById(o);y.debug("targetConnection",r),c.push(t._deployToTarget(r,l,e))}),r.all(c)}).then(function(e){var t={};i.each(e,function(e){var n=Object.keys(e)[0];t[n]=e[n],t[n].details.componentFailures&&(i.isArray(t[n].details.componentFailures)||(t[n].details.componentFailures=[t[n].details.componentFailures])),t[n].details.componentSuccesses&&(i.isArray(t[n].details.componentSuccesses)||(t[n].details.componentSuccesses=[t[n].details.componentSuccesses])),t[n].details.runTestResult&&t[n].details.runTestResult.codeCoverageWarnings&&(i.isArray(t[n].details.runTestResult.codeCoverageWarnings)||(t[n].details.runTestResult.codeCoverageWarnings=[t[n].details.runTestResult.codeCoverageWarnings]))}),n(t)})["catch"](function(e){y.error("Could not complete deployment: "+e.message),o(e)}).done()})},o.prototype.stage=function(e,t){var n=this;return new r(function(o,r){var c=a.mkdirSync({prefix:"mm_"});s.mkdirpSync(u.join(c,"unpackaged"));var d=new h({subscription:t});d.init().then(function(){return d.path=u.join(c,"unpackaged","package.xml"),d.writeFileSync(),i.each(e,function(e){y.debug("STAGING: "+e.path);var t=e.path,o=u.basename(t);y.debug("fileBasename: "+o);var r=u.dirname(t);y.debug("directory: "+r);var i=u.join(n.project.workspace,n.project.name,"src"),a=r.replace(i,u.join(c,"unpackaged"));y.debug("destinationDirectory: "+a),s.existsSync(a)||s.mkdirpSync(a),s.copySync(t,u.join(a,o)),e.hasMetaFile&&(e.isMetaFile?s.copySync(t.replace("-meta.xml",""),u.join(a,o.replace("-meta.xml",""))):s.copySync(t+"-meta.xml",u.join(a,o+"-meta.xml")))}),l.zipDirectory(u.join(c,"unpackaged"),c)}).then(function(){var e=s.createReadStream(u.join(c,"unpackaged.zip"));o(e)})["catch"](function(e){y.debug("Could not prepare metadata for deployment: "+e.message),r(e)}).done()})},o.prototype.executeStream=function(e,t){var n=this,o=t||{};return o.rollbackOnError=!0,new r(function(t,r){n.project.sfdcClient.deploy(e,o).then(function(e){t(e)})["catch"](function(e){r(e)}).done()})},o.prototype.execute=function(e,t){var n=this;return new r(function(o,r){t||(t={rollbackOnError:!0});var i=a.mkdirSync({prefix:"mm_"});y.debug("deploying file: ");var c=new h({subscription:b.createPackageSubscription([e])});c.init().then(function(){return c.path=u.join(i,"unpackaged","package.xml"),c.writeFileSync(),e.renderAndWriteToDisk(u.join(i,"unpackaged"))}).then(function(){return l.zipDirectory(u.join(i,"unpackaged"),i)}).then(function(){var e=s.createReadStream(u.join(i,"unpackaged.zip"));return n.project.sfdcClient.deploy(e,t)}).then(function(t){if(y.debug("Creation result: "),y.debug(t),t.success){var r=u.join(i,"unpackaged",e.type.directoryName,e.name+"."+e.type.suffix),a=u.basename(r),c=u.dirname(r),l=u.join(n.project.workspace,n.project.name,"src"),d=c.replace(u.join(i,"unpackaged"),l);s.existsSync(d)||s.mkdirpSync(d),s.copySync(r,u.join(d,a)),e.hasMetaFile&&s.copySync(r+"-meta.xml",u.join(d,a+"-meta.xml"))}o(t)})["catch"](function(e){y.debug("Error deploying new file to server"),y.debug(e),y.debug(e.stack),r(e.message.indexOf("polling time out")>=0?new Error("MavensMate timed out while polling Salesforce.com servers. To increase polling timeout, set mm_timeout to number of seconds."):e)}).done()})},o.prototype._deployToTarget=function(e,t,n){var o=this;return new r(function(r,i){y.debug("deploying to target: "),y.debug(e),e.username&&!e.password?e.password=o.project.keychainService.getPassword(e.id,"password"):e.password||e.accessToken||e.refreshToken||(e.accessToken=o.project.keychainService.getPassword(e.id,"accessToken"),e.refreshToken=o.project.keychainService.getPassword(e.id,"refreshToken"));var a,c;y.debug("READY TO DEPLOY: "),y.debug(e.name),e.password?y.silly(e.password):(y.silly(e.accessToken),y.silly(e.refreshToken)),y.debug(e.instanceUrl),y.debug("deploy options:"),y.debug(n),l.zipDirectory(u.join(t,"unpackaged"),t).then(function(){return a=new m(e.username&&e.password?{username:e.username,password:e.password,orgType:e.orgType,loginUrl:e.loginUrl}:{accessToken:e.accessToken,refreshToken:e.refreshToken,instanceUrl:e.instanceUrl}),a.initialize()}).then(function(){return a.setPollingTimeout(3e5),c=s.createReadStream(u.join(t,"unpackaged.zip")),a.deploy(c,n)}).then(function(t){var n={};n[e.id]=t,r(n)})["catch"](function(t){y.error("_deployToTarget failed",e.name,e.id,t.message),y.error(t),i(t)}).done()})},o.prototype.stageDelete=function(e){return new r(function(t,n){var o=a.mkdirSync({prefix:"mm_"});s.mkdirpSync(u.join(o,"unpackaged"));var r=new h({subscription:e}),i=new h({subscription:{}});r.init().then(function(){return r.path=u.join(o,"unpackaged","destructiveChanges.xml"),r.writeFileSync(),i=new h({subscription:{}}),i.init()}).then(function(){return i.path=u.join(o,"unpackaged","package.xml"),i.writeFileSync(),l.zipDirectory(u.join(o,"unpackaged"),o)}).then(function(){var e=s.createReadStream(u.join(o,"unpackaged.zip"));t(e)})["catch"](function(e){y.debug("Could not prepare metadata for deletion: "+e),n(e)}).done()})},e.exports=o},function(e,t){e.exports=require("temp")},function(e,t,n){(function(t){"use strict";function o(e){this.path=e.path,this.files=e.files,this.metadataTypeXmlNames=e.metadataTypeXmlNames,this.subscription=e.subscription,this.project=e.project}function r(e){this.sfdcClient=e}function i(e){this.sfdcClient=e}function a(e){r.call(this,e)}function c(e){i.call(this,e)}function s(e){i.call(this,e)}var u=n(1),l=n(7),d=n(28),p=n(10),m=n(6),f=n(4),h=n(8),g=n(148),y=n(143);o.prototype._path=null,o.prototype._files=null,o.prototype._subscription=null,o.prototype.init=function(){var e=this;return new u(function(t,n){e.subscription?(f.debug("initing package instance with subscription: "),f.debug(e.subscription),e._ensureCustomObjectSubscriptionIsValid().then(function(){t()})["catch"](function(e){n(e)})):(f.debug("initing package instance"),e.files?e._getSubscriptionFromFiles().then(function(n){f.debug("setting package subscription: "),f.debug(n),e.subscription=n,t()})["catch"](function(e){n(new Error("Could not initiate Package instance by metadata list: "+e.message))}):e.metadataTypeXmlNames?e._getSubscriptionFromMetadataTypeXmlNames().then(function(n){f.debug("setting package subscription: "),f.debug(n),e.subscription=n,t()})["catch"](function(e){n(new Error("Could not initiate Package instance by metadata list: "+e.message))}):e.path&&e._deserialize().then(function(o){f.debug("setting package subscription: "),f.debug(o),e.subscription=o,e._ensureCustomObjectSubscriptionIsValid().then(function(){t()})["catch"](function(e){n(e)})})["catch"](function(e){n(new Error("Could not initiate Package instance by path: "+e.message))}))})},Object.defineProperty(o.prototype,"files",{get:function(){return this._files},set:function(e){this._files=e}}),Object.defineProperty(o.prototype,"subscription",{get:function(){return this._subscription},set:function(e){this._subscription=e}}),Object.defineProperty(o.prototype,"path",{get:function(){return this._path},set:function(e){this._path=e}}),o.prototype._ensureCustomObjectSubscriptionIsValid=function(){var e=this;return new u(function(t,n){try{if(f.debug("_ensureCustomObjectSubscriptionIsValid"),e.project&&e.subscription.CustomObject&&"*"===e.subscription.CustomObject){var o=[];e.project.getOrgMetadataIndex().then(function(n){var r=l.find(n,function(e){return"CustomObject"===e.id});l.each(r.children,function(e){o.push(e.fullName)}),e.subscription.CustomObject=o,t()})["catch"](function(e){f.error("could not subscribe to all custom objects",e),t()})}else t()}catch(r){f.error("could not subscribe to all custom objects",r),t()}})},o.prototype._getSubscriptionFromMetadataTypeXmlNames=function(){var e=this;return new u(function(t,n){try{var o={};l.each(e.metadataTypeXmlNames,function(e){o[e]="*"}),t(o)}catch(r){n(new Error("Could not get package dictionary: "+r.message))}})},o.prototype._getSubscriptionFromFiles=function(){var e=this;return new u(function(t,n){try{var o={};return l.each(e.files,function(e){var t=e.type.xmlName;if(l.has(o,t)){var n=o[t];n.push(e.name)}else o[t]=[e.name]}),t(o)}catch(r){n(new Error("Could not get package dictionary: "+r.message))}})},o.prototype.writeFile=function(){var e=this;return new u(function(t,n){if(!e.path)return n(new Error("Could not write to disk. Please specify package path"));f.debug("writing package to path: "+e.path);var o=e._serialize();p.outputFile(e.path,o,function(e){e?n(new Error("Could not write package to disk: "+e.message)):t()})})},o.prototype.writeFileSync=function(){var e=this._serialize();f.debug("writing package to path: "+this.path),f.debug(e),p.outputFileSync(this.path,e)},o.prototype.subscribe=function(e){var t=this;l.isArray(e)||(e=[e]),l.each(e,function(e){var n=e.type.xmlName;if(l.has(t.subscription,n)){if("*"===t.subscription[n])return!1;t.subscription[n].indexOf(e.subscriptionName)===-1&&t.subscription[n].push(e.subscriptionName)}else t.subscription[n]=[e.subscriptionName]})},o.prototype.unsubscribe=function(e){var t=this;l.isArray(e)||(e=[e]),l.each(e,function(e){f.debug("unsubscribing: "+e.name),f.debug("type: "+e.type);var n=e.type.xmlName;if(l.has(t.subscription,n)){if("*"===t.subscription[n])return!1;var o=t.subscription[n],r=[];l.each(o,function(t){t!==e.subscriptionName&&r.push(t)}),t.subscription[n]=r}else t.subscription[n]=e.subscriptionName})},o.prototype._serialize=function(){var e=this;f.debug("serializing package:"),f.debug(e.subscription);var n=d.renderFile(m.join(t,"templates","package.xml"),{obj:e.subscription,apiVersion:h.get("mm_api_version")});return n},o.prototype._deserialize=function(){var e=this;return new u(function(t,n){var o={};f.debug("deserializing: "+e.path),e.path?p.readFile(e.path,function(e,r){if(e)n(e);else try{var i=y.parser(!0),a=!0;i.onerror=function(e){f.debug("Parse error: package.xml --> "+e),a=!1,i.resume()},i.onend=function(){if(a){var e=new g.XmlDocument(r);l.each(e.children,function(e){var t,n=[];"types"===e.name&&(l.each(e.children,function(e){if("name"===e.name&&void 0!==e.val)return t=e.val,!1}),l.each(e.children,function(e){if("members"===e.name){if("*"===e.val)return n="*",!1;n.push(e.val)}}),o[t]=n)}),f.debug("parsed package.xml to -->"+JSON.stringify(o)),t(o)}else n(new Error("Could not parse package.xml, invalid XML"))},i.write(r.toString().trim()).close()}catch(c){n("Could not deserialize package: "+c.message)}}):n(new Error("Please set package.xml path"))})},r.prototype={getMembers:function(){}},i.prototype={getList:function(){}},a.prototype=Object.create(r.prototype,{getMembers:{value:function(){var e=this;return new u(function(t,n){e.sfdcClient.list("CustomObject").then(function(e){var n=[];l.each(e.CustomObject,function(e){n.push(e.fullName)}),t(n)})["catch"](function(e){n(e)})})}}}),a.prototype.constructor=a,c.prototype=Object.create(i.prototype,{getList:{value:function(){var e=this;return new u(function(t,n){var o=new a(e.sfdcClient);o.getMembers().then(function(t){return e.sfdcClient.retrieveUnpackaged({SharingRules:t})}).then(function(e){var n={};n.SharingRules=l.filter(e.fileProperties,function(e){return"SharingRules"===e.type}),t(n)})["catch"](function(e){n(e)})})}}}),c.prototype.constructor=c,s.prototype=Object.create(i.prototype,{getList:{value:function(){var e=this;return new u(function(t,n){u.all([e.sfdcClient.retrieveUnpackaged({Workflow:["CaseComment"]}),e.sfdcClient.list("Workflow")]).then(function(e){var n=e[0],o=e[1],r=o,i=l.filter(n.fileProperties,function(e){return"Workflow"===e.type});r.Workflow=r.Workflow.concat(i),t(r)})["catch"](n).done()})}}}),s.prototype.constructor=s,e.exports.Package=o,e.exports.MemberProvider=r,e.exports.ListProvider=i,e.exports.SharingRulesMemberProvider=a,e.exports.SharingRulesListProvider=c,e.exports.WorkflowListProvider=s}).call(t,"/")},function(e,t){e.exports=require("moment")},function(e,t){e.exports=require("querystring")},function(e,t,n){"use strict";var o=(n(26),n(6)),r=n(1),i=n(4),a=n(15).MetadataHelper,c=n(16),s=n(20).Package,u=(n(3),n(19)),l=n(11),d=function(e,t){if(!e||!t)throw new Error("RefreshDelegate requires a valid project instance and an array of paths to refresh.");this.project=e,this.paths=t,this.metadataHelper=new a({sfdcClient:this.project.sfdcClient})};d.prototype.execute=function(){var e=this;return new r(function(t,n){e._refreshLocalPaths().then(function(e){t(e)})["catch"](function(e){i.debug("Could not complete refresh request: "+e.message),n(e)})})},d.prototype._refreshLocalPaths=function(){var e=this;return new r(function(t,n){if(0===e.paths.length)return t();var r,a=l.createFileInstances(e.paths),c=(l.getLightningBundleItemFiles(a),l.createPackageSubscription(a,e.project.packageXml)),d=u.mkdirSync({prefix:"mm_"}),p=o.join(d,"unpackaged"),m=new s({subscription:c});m.init().then(function(){return i.debug("submitting retrieve request for pkg metadata"),i.debug(m.subscription),e.project.sfdcClient.retrieveUnpackaged(m.subscription,!0,d)}).then(function(t){return r=t.fileProperties,e.project.updateLocalStore(r)}).then(function(){return e.project.replaceLocalFiles(p)}).then(function(e){t(e)})["catch"](function(e){i.debug("Could not refresh metadata: "+e.message),n(e)}).done()})},d.prototype._retrieveAndOverwriteLightningMetadata=function(e){var t=this;return new r(function(n,o){if(0===e.length)return n();i.debug("refreshing lightning components"),i.debug(e[0].path);var r=new c(t.project);r.getBundleItems(e).then(function(e){n(e)})["catch"](function(e){o(e)}).done()})},e.exports=d},function(e,t,n){"use strict";function o(e){this.project=e,this.keychainService=new l}var r=n(1),i=n(7),a=n(10),c=n(6),s=n(35),u=n(17),l=n(92),d=n(4);o.prototype.listAll=function(){var e=this;return new r(function(t,n){a.readJson(c.join(e.project.path,"config",".org_connections"),function(o,r){o?o.message.indexOf("ENOENT")>=0?t([]):n(new Error("Could not load org connections: "+o.message)):(i.each(r,function(t){e.keychainService.useSystemKeychain()&&(t.accessToken=e.keychainService.getPassword(t.id,"accessToken",!0),t.refreshToken=e.keychainService.getPassword(t.id,"refreshToken",!0),t.password=e.keychainService.getPassword(t.id,"password",!0))}),d.debug("returning all org connections",r),t(r))})})},o.prototype.getById=function(e){try{var t=a.readJsonSync(c.join(this.project.path,"config",".org_connections"));return i.find(t,function(t){return t.id===e})}catch(n){if(n.message.indexOf("ENOENT")>=0)return null;throw n}},o.prototype.add=function(e){var t=this;return new r(function(n,o){var r=s.v1();if(e.username&&e.password)var i={name:e.name,id:r,username:e.username,orgType:e.orgType,loginUrl:e.loginUrl};else var i={name:e.name,id:r,instanceUrl:e.instanceUrl};if(e.username&&e.password?t.keychainService.useSystemKeychain()?t.keychainService.storePassword(r,e.password,"password"):i.password=e.password:t.keychainService.useSystemKeychain()?(t.keychainService.storePassword(r,e.accessToken,"accessToken"),t.keychainService.storePassword(r,e.refreshToken,"refreshToken")):(i.accessToken=e.accessToken,i.refreshToken=e.refreshToken),e.username&&e.password)var l=new u({username:e.username,password:e.password,instanceUrl:e.instanceUrl,loginUrl:e.loginUrl,orgType:e.orgType});else var l=new u({accessToken:e.accessToken,refreshToken:e.refreshToken,instanceUrl:e.instanceUrl});l.initialize().then(function(){a.existsSync(c.join(t.project.path,"config",".org_connections"))?a.readJson(c.join(t.project.path,"config",".org_connections"),function(e,r){e?o(e):(r.push(i),a.outputFile(c.join(t.project.path,"config",".org_connections"),JSON.stringify(r,null,4),function(e){e?o(e):n()}))}):a.outputFile(c.join(t.project.path,"config",".org_connections"),JSON.stringify([i],null,4),function(e){e?o(e):n()})})["catch"](function(e){d.error("could not initialize sfdc client for org connection: "+e.message),o(e)}).done()})},o.prototype.update=function(e){var t=this;return new r(function(n,o){a.existsSync(c.join(t.project.path,"config",".org_connections"))||a.writeSync(c.join(t.project.path,"config",".org_connections"),[]),a.readJson(c.join(t.project.path,"config",".org_connections"),function(r,s){r?o(new Error("Could not load org connections: "+r.message)):(i.each(s,function(n){if(n.id===e.id)return e.username&&e.password?(n.name=e.name,n.username=e.username,n.orgType=e.orgType.toLowerCase(),n.loginUrl=e.loginUrl,t.keychainService.useSystemKeychain()?t.keychainService.replacePassword(n.id,e.password,"password"):n.password=e.password):(n.name=e.name,n.instanceUrl=e.instanceUrl,t.keychainService.useSystemKeychain()?(t.keychainService.replacePassword(n.id,e.accessToken,"accessToken"),t.keychainService.replacePassword(n.id,e.refreshToken,"refreshToken")):(n.accessToken=e.accessToken,n.refreshToken=e.refreshToken)),!1}),a.outputFile(c.join(t.project.path,"config",".org_connections"),JSON.stringify(s,null,4),function(e){e?o(new Error("Could not update org connections: "+e.message)):n()}))})})},o.prototype.remove=function(e){var t=this;return new r(function(n,o){a.readJson(c.join(t.project.path,"config",".org_connections"),function(r,s){if(r)o(new Error("Could not load org connections: "+r.message));else{var u=[];i.each(s,function(t){t.id!==e&&u.push(t)}),a.outputFile(c.join(t.project.path,"config",".org_connections"),JSON.stringify(u,null,4),function(e){e?o(new Error("Could not write org connections: "+e.message)):n()})}})})},e.exports=o},function(e,t){e.exports=require("events")},function(e,t){e.exports=require("fs-extra-promise")},function(e,t){e.exports=require("os")},function(e,t){e.exports=require("swig")},function(e,t,n){(function(t){function o(e){if(a.info("handling command result"),e.result?a.debug(e.result):e.error&&a.error(e.error),e.error)"cli"!==process.env.MAVENSMATE_CONTEXT?e.reject(e.error):(console.error(JSON.stringify({error:e.error.message})),process.exit(1));else if(c.isString(e.result)){var t={message:e.result};"cli"!==process.env.MAVENSMATE_CONTEXT?e.resolve(t):(console.log(JSON.stringify(t)),process.exit(0))}else"cli"!==process.env.MAVENSMATE_CONTEXT?e.resolve(e.result):(console.log(JSON.stringify(e.result)),process.exit(0))}var r=n(6),i=n(3),a=n(4),c=n(7),s=n(111),u=n(96),l=n(9),d={},p=r.join(t),m=i.walkSync(p);c.each(m,function(e){d[s(u(r.basename(e).split(".")[0])+"Command")]=n(132)(e).command}),e.exports=function(e){return e=e||{},{execute:function(t){return new Promise(function(n,r){try{a.info("\n\n==================> executing command");var i,c,p,m,f,h;i=t.name,c=t.body,p=t.editor||process.env.MAVENSMATE_EDITOR,m=t.project||e.project,f=t.openWindowFn||e.openWindowFn,"cli"===process.env.MAVENSMATE_CONTEXT&&m&&m.requiresAuthentication&&(i="oauth-project"),h=s(u(i))+"Command";var g=new l(p,f),y=new d[h](m,c,g);if(a.info("name: ",i),a.info("project: ",m&&m.name?m.name:"none"),a.info("body: ",JSON.stringify(c)),a.info("editor: ",p||"none"),a.debug("mavensmate command class name: "+h),a.silly("mavensmate command instance: ",y),!d[h])return void o({error:new Error("Command not supported: "+i),resolve:n,reject:r});y.execute().then(function(e){o({result:e,resolve:n,reject:r})})["catch"](function(e){o({error:e,resolve:n,reject:r})})}catch(v){a.error(v),o(v)}})}}}}).call(t,"/")},function(e,t,n){"use strict";var o=n(1),r=n(19),i=n(7),a=n(26),c=n(6),s=n(98),u=n(3),l=n(35),d=n(2),p=n(25),m=n(17),f=n(15).MetadataHelper,h=n(8),g=n(4),y=n(112),v=n(33),b=n(20).Package,x=n(109),w=n(93),j=n(16),C=n(92),S=function(e){this.name=e.name,this.path=e.path,this.workspace=e.workspace,this.subscription=e.subscription,this.origin=e.origin,this.username=e.username,this.password=e.password,this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.instanceUrl=e.instanceUrl,this["package"]=e["package"],this.orgType=e.orgType,this.sfdcClient=e.sfdcClient,this.requiresAuthentication=!0,this.settings={},this.packageXml=null,this.orgMetadata=null,this.lightningIndex=null,this.metadataHelper=null,this.keychainService=new C,this.logService=new w(this),this.symbolService=new x(this),this.lightningService=new j(this)};d(S,p.EventEmitter),S.prototype.initialize=function(e,t){var n=this;return new o(function(o,r){if(e=e||!1){if(e){var i=t?n._initNewProjectFromExistingDirectory():n._initNew();i.then(function(){o(n)})["catch"](function(e){g.error("Could not initiate new Project instance: "+e.message),r(e)}).done()}}else n._initExisting().then(function(){o(n)})["catch"](function(e){g.error("Could not initiate existing Project instance: "+e.message),r(e)}).done()})},S.prototype._initNewProjectFromExistingDirectory=function(){var e=this;return new o(function(t,n){var o,r;if(!e.workspace)throw new Error("Please select a workspace for this project");if(!e.origin)throw new Error("Please select an origin for this project");if(!a.existsSync(c.join(e.origin,"src")))return n(new Error("Project must have a top-level src directory"));if(!a.existsSync(c.join(e.origin,"src","package.xml")))return n(new Error("Project must have a valid package.xml file located in the src directory"));if(e.name=c.basename(e.origin),e.workspace!==c.dirname(e.origin)){if(a.existsSync(c.join(e.workspace,e.name)))return n(new Error("Project with this name already exists in the selected workspace"));a.ensureDirSync(c.join(e.workspace,e.name)),a.copySync(e.origin,c.join(e.workspace,e.name))}e.path=c.join(e.workspace,e.name),a.ensureDirSync(c.join(e.path,"config")),e.sfdcClient.describe().then(function(t){return e.metadataHelper=new f({sfdcClient:e.sfdcClient}),e.setDescribe(t)}).then(function(){return o=new b({project:e,path:c.join(e.path,"src","package.xml")}),o.init()}).then(function(){return e.sfdcClient.retrieveUnpackaged(o.subscription,!0,e.path)}).then(function(t){return g.debug("retrieve result: "),g.debug(t),r=t.fileProperties,a.existsSync(c.join(e.path,"unpackaged"))&&a.removeSync(c.join(e.path,"unpackaged")),e.id=l.v1(),e._initConfig()}).then(function(){return g.debug("initiating local store"),g.silly(r),e._writeLocalStore(r)}).then(function(){t()})["catch"](function(t){g.error("Could not retrieve and write project to file system: "+t.message),g.error(t.stack),e.origin!==c.join(e.workspace,e.name)&&a.existsSync(c.join(e.workspace,e.name))&&a.removeSync(c.join(e.workspace,e.name)),n(t)}).done()})},S.prototype._initExisting=function(){g.debug("itializing existing project on the disk...");var e=this;return new o(function(t,n){if(!e._hasValidStructure())return n(new Error("This does not seem to be a valid MavensMate project directory."));if(e.path?(e.workspace=c.dirname(e.path),e.name=c.basename(e.path)):e.workspace&&e.name?e.path=c.join(e.workspace,e.name):(e.path=process.cwd(),e.workspace=c.dirname(e.path),e.name=c.basename(e.path)),!a.existsSync(e.path))return n(new Error("Project path does not exist."));g.debug("project name",e.name),g.debug("project path",e.path),e.settings=e._readSettings();var o=e._readCredentials();if(!o.password&&!o.accessToken&&!o.refreshToken)throw new Error("Could not retrieve credentials for project "+e.name);if(!o.password&&o.accessToken&&!o.refreshToken)throw new Error("Project ("+e.name+") is using Oauth for authentication but no refresh token was found");e.packageXml=new b({project:e,path:c.join(e.path,"src","package.xml")}),e.packageXml.init().then(function(){return e.sfdcClient||(g.debug("Creating new sfdc client",e.settings,o),o.refreshToken?e.sfdcClient=new m({username:e.settings.username,accessToken:o.accessToken,refreshToken:o.refreshToken,instanceUrl:e.settings.instanceUrl,loginUrl:e.settings.loginUrl,orgType:e.settings.orgType}):e.sfdcClient=new m({username:e.settings.username,password:o.password,loginUrl:e.settings.loginUrl,orgType:e.settings.orgType}),e._listenForTokenUpdates()),e.sfdcClient.initialize()}).then(function(t){return e.metadataHelper=new f({sfdcClient:e.sfdcClient}),e.getLocalStore(),e.getOrgMetadataIndexWithSelections()}).then(function(){return e._refreshDescribeFromServer()}).then(function(){return e.sfdcClient.on("sfdcclient-new-log",function(t){t.sobject&&t.sobject.Id&&e.logService.downloadLog(t.sobject.Id).then(function(t){e.emit("new-log",t)})["catch"](function(e){g.debug("Could not download log: "+e.message)}).done()}),e.sfdcClient.startSystemStreamingListener()}).then(function(){e.requiresAuthentication=!1,t()})["catch"](function(t){g.error(t),u.isCredentialsError(t)&&(g.debug("project has expired access/refresh token, marking as invalid"),e.requiresAuthentication=!0),n(t)}).done()})},S.prototype._initNew=function(){var e=this;return new o(function(t,n){if(e.workspace)a.existsSync(e.workspace)||a.mkdirSync(e.workspace);else{var o,r=h.get("mm_workspace");g.debug("Workspace not specified, retrieving base workspace: "),g.debug(r),i.isArray(r)?o=r[0]:i.isString(r)&&(o=r),o&&!a.existsSync(o)&&a.mkdirSync(o),e.workspace=o,g.debug("workspace set to: "+e.workspace)}if(!e.workspace)throw new Error("Could not set workspace for new project");e.path=c.join(e.workspace,e.name),a.existsSync(e.path)?n(new Error("Directory already exists!")):(e.id=l.v1(),t(e.id))})},S.prototype._hasValidStructure=function(){return this.path?a.existsSync(c.join(this.path,"config",".settings")):this.workspace&&this.name?a.existsSync(c.join(this.workspace,this.name,"config",".settings")):a.existsSync(c.join(process.cwd(),"config",".settings"))},S.prototype.replaceLocalFiles=function(e,t){var n=this;return new o(function(o,r){var i=s(e);i.on("file",function(o){var r=c.basename(o);g.debug("refreshing file: "+o);var i=c.dirname(o),s=i.replace(e,c.join(n.workspace,n.name,"src"));a.existsSync(s)||a.mkdirpSync(s),t&&"package.xml"===r?(a.removeSync(c.join(s,r)),a.copySync(o,c.join(s,r))):"package.xml"!==r&&(a.removeSync(c.join(s,r)),a.copySync(o,c.join(s,r)))}),i.on("end",function(){a.existsSync(e)?a.removeAsync(e).then(function(){o()})["catch"](function(e){r(e)}):o()}),i.on("error",function(e){g.debug("Could not process retrieved metadata: "+e.message),r(e)})})},S.prototype.retrieveAndWriteToDisk=function(){var e=this;return new o(function(t,n){var o;a.existsSync(e.path)?n(new Error("Project with this name already exists in the specified workspace.")):(e["package"]||(e["package"]=["ApexClass","ApexComponent","ApexPage","ApexTrigger","StaticResource"]),e.sfdcClient.describe().then(function(t){return e.setDescribe(t)}).then(function(){return e.path=c.join(e.workspace,e.name),a.mkdirSync(e.path),a.mkdirSync(c.join(e.path,"config")),e.sfdcClient.retrieveUnpackaged(e["package"],!0,e.path)}).then(function(t){return o=t.fileProperties,a.existsSync(c.join(e.path,"unpackaged"))&&a.renameSync(c.join(e.path,"unpackaged"),c.join(e.path,"src")),e._initConfig()}).then(function(){return g.debug("initiating local store"),g.silly(o),e._writeLocalStore(o)}).then(function(){t()})["catch"](function(t){g.error("Could not retrieve and write project to file system: "+t.message),g.error(t.stack),a.existsSync(e.path)&&a.removeSync(e.path),n(t)}).done())})},S.prototype._initConfig=function(){var e=this;return new o(function(t,n){var r={projectName:e.name,username:e.sfdcClient.getUsername(),id:e.id,namespace:e.sfdcClient.getNamespace()||"",orgType:e.sfdcClient.getOrgType(),loginUrl:e.sfdcClient.getLoginUrl(),instanceUrl:e.sfdcClient.getInstanceUrl(),workspace:e.workspace,subscription:e.subscription||h.get("mm_default_subscription")};e.writeSettings(r),e._writeCredentials();var i=[e._writeDebug(),e._writeEditorSettings(),e._refreshDescribeFromServer(),e.indexLightning()];o.all(i).then(function(){t()})["catch"](function(e){g.error("Could not initiate project config directory -->"+e.message),n(e)}).done()})},S.prototype.refreshFromServer=function(){var e=this;return new o(function(t,n){g.debug("refreshing project from server...");var o,i=r.mkdirSync({prefix:"mm_"});e.packageXml=new b({project:e,path:c.join(e.path,"src","package.xml")}),e.packageXml.init().then(function(){return e.sfdcClient.retrieveUnpackaged(e.packageXml.subscription,!0,i)}).then(function(t){return o=t,u.emptyDirectoryRecursiveSync(c.join(e.path,"src")),e.replaceLocalFiles(c.join(i,"unpackaged"),!0)}).then(function(){return e._writeLocalStore(o.fileProperties)}).then(function(){return e.indexLightning()}).then(function(){u.removeEmptyDirectoriesRecursiveSync(c.join(e.path,"src")),t()})["catch"](function(e){g.error("Error refreshing project from server -->"+e.message),n(e)}).done()})},S.prototype.clean=function(){var e=this;return new o(function(t,n){e.refreshFromServer().then(function(){return e._refreshDescribeFromServer()}).then(function(){return e.indexMetadata()}).then(function(){t()})["catch"](function(e){g.error("Error cleaning project -->"+e.message),n(e)}).done()})},S.prototype.compile=function(){var e=this;return new o(function(t,n){var i=r.mkdirSync({prefix:"mm_"});a.copy(c.join(e.path,"src"),c.join(i,"unpackaged"),function(r){if(r)return n(r);var s;u.zipDirectory(c.join(i,"unpackaged"),i).then(function(){var t=a.createReadStream(c.join(i,"unpackaged.zip"));return e.sfdcClient.deploy(t,{rollbackOnError:!0,performRetrieve:!0})}).then(function(t){return g.debug("Compile result: "),g.debug(t),s=t,s.details.retrieveResult?e.updateLocalStore(s.details.retrieveResult.fileProperties):new o(function(e){e()})}).then(function(){t(s)})["catch"](function(e){n(e)}).done()})})},S.prototype.edit=function(e){var t=this;return new o(function(n,o){var i;g.debug("editing project, requested package is: ",e);var a=r.mkdirSync({prefix:"mm_"});t.sfdcClient.retrieveUnpackaged(e,!0,a).then(function(e){return t._writeLocalStore(e.fileProperties)}).then(function(){return u.emptyDirectoryRecursiveSync(c.join(t.path,"src")),t.replaceLocalFiles(c.join(a,"unpackaged"),!0)}).then(function(){return i=new b({project:t,path:c.join(t.path,"src","package.xml")}),i.init()}).then(function(){t.packageXml=i,u.removeEmptyDirectoriesRecursiveSync(c.join(t.path,"src")),n()})["catch"](function(e){o(e)}).done()})},S.prototype._readSettings=function(){try{return a.readJsonSync(c.join(this.path,"config",".settings"))}catch(e){throw g.error("Error reading settings -->",e),new Error("Could not read settings: "+e.message)}},S.prototype.writeSettings=function(e){try{for(var t in e)this.settings[t]=e[t];a.writeFileSync(c.join(this.path,"config",".settings"),JSON.stringify(this.settings,null,4))}catch(n){throw g.error("Could not write settings",n),new Error("Could not write settings",n)}},S.prototype.getLocalStore=function(){var e;try{e=a.readJsonSync(c.join(this.path,"config",".local_store"))}catch(t){if(!(t.message.indexOf("Unexpected end of input")>=0))throw t;e={}}return e},S.prototype.getDebugSettingsSync=function(){var e;try{e=a.readJsonSync(c.join(this.path,"config",".debug"))}catch(t){if(!(t.message.indexOf("Unexpected end of input")>=0))throw t;e={}}return e},S.prototype.setLightningIndex=function(e){var t=this;return new o(function(n,o){try{a.outputFileSync(c.join(t.path,"config",".lightning"),JSON.stringify(e,null,4)),t.lightningIndex=e,n()}catch(r){g.error("Could not write lightning index file -->"+r.message),o(r)}})},S.prototype.getLightningIndexSync=function(){var e;try{e=a.readJsonSync(c.join(this.path,"config",".lightning"))}catch(t){if(!(t.message.indexOf("Unexpected end of input")>=0))throw t;e=[]}return e},S.prototype.getLightningIndex=function(){var e=this;return new o(function(t,n){try{var o=a.readJsonSync(c.join(e.path,"config",".lightning"));return t(o)}catch(r){
g.debug("could not get index the first time"),g.debug(r),e.indexLightning().then(function(){g.debug("done indexing lightning, now go get it");var n=a.readJsonSync(c.join(e.path,"config",".lightning"));return t(n)})["catch"](function(e){g.error("Could not get lightning index -->"+e.message),n(e)})}})},S.prototype.getDescribe=function(){return this._describe},S.prototype.setDescribe=function(e){var t=this;return new o(function(n,o){var r=c.join(t.path,"config",".describe");a.existsSync(c.join(t.path,"config"))?a.outputFile(r,JSON.stringify(e,null,4),function(r){return r?o(r):(t._describe=e,void n())}):(t._describe=e,n())})},S.prototype._refreshDescribeFromServer=function(){var e=this;return new o(function(t,n){e.sfdcClient.describe().then(function(t){return e.setDescribe(t)}).then(function(){t()})["catch"](function(e){n(e)}).done()})},S.prototype.indexLightning=function(){var e=this;return g.debug("indexing lightning to config/.lightning"),new o(function(t,n){e.lightningService.getAll().then(function(t){return e.setLightningIndex(t)}).then(function(){return t()})["catch"](function(e){e.message.indexOf("sObject type 'AuraDefinition' is not supported")>=0||e.message.indexOf("requested resource does not exist")>=0?t():(g.error("Could not index lightning -->"+e.message),n(e))}).done()})},S.prototype.indexSymbols=function(e){var t=this;return new o(function(n,o){a.existsSync(c.join(t.path,"config",".symbols"))||a.mkdirpSync(c.join(t.path,"config",".symbols"));var r=e?t.symbolService.indexApexClass(e):t.symbolService.index();r.then(function(){g.debug("done indexing symbols!"),n()})["catch"](function(e){g.error("Could not index apex symbols: "+e.message),o(e)}).done()})},S.prototype.indexMetadata=function(){var e=this;return new o(function(t,n){e.indexService||(e.indexService=new v({project:e})),e.indexService.indexServerProperties(e.settings.subscription).then(function(o){a.outputFile(c.join(e.path,"config",".org_metadata"),JSON.stringify(o,null,4),function(e){e?n(e):t()})})["catch"](function(e){g.error("Could not index metadataHelper: "+e.message),n(e)}).done()})},S.prototype.getOrgMetadataIndex=function(){var e=this;return new o(function(t,n){a.readJson(c.join(e.path,"config",".org_metadata"),function(e,n){e?(g.debug("Could not return org metadata: "+e.message),t([])):t(n)})})},S.prototype.getOrgMetadataIndexWithSelections=function(e,t,n){var r=this;return new o(function(s,u){if(g.debug("getOrgMetadataIndexWithSelections, package location: ",n),a.existsSync(c.join(r.path,"config",".org_metadata")))try{a.readJson(c.join(r.path,"config",".org_metadata"),function(a,c){if(a)u(a);else{r.orgMetadata=c;var l,d;n?(d=new b({path:n}),l=d.init()):l=o.resolve(),l.then(function(){if(!t){t=[];var o=n?d:r.packageXml;i.forOwn(o.subscription,function(e,n){var o=r.metadataHelper.getTypeByXmlName(n);if(!o)return u(new Error("Unrecognized package.xml metadata type: "+n));if(i.has(o,"parentXmlName"))var a=r.metadataHelper.getTypeByXmlName(o.parentXmlName);if("*"===e){t.push(n);var s=i.find(c,{xmlName:n});i.has(s,"children")&&i.each(s.children,function(e){e.select=!0})}else i.each(e,function(e){if(o.inFolder)t.push([n,e.replace(/\//,".")].join("."));else if(a){var r=[a.xmlName,e.split(".")[0],o.tagName,e.split(".")[1]].join(".");t.push(r)}else if(i.has(o,"childXmlNames")){var s=i.find(c,{xmlName:n});if(s){var u=i.find(s.children,{id:[n,e].join(".")});i.has(u,"children")&&i.each(u.children,function(e){e.select=!0,i.has(e,"children")&&i.each(e.children,function(e){e.select=!0})}),t.push([n,e].join("."))}}else t.push([n,e].join("."))})})}r.indexService||(r.indexService=new v({project:r})),r.indexService.setChecked(c,t),r.indexService.ensureParentsAreCheckedIfNecessary(c),e&&r.indexService.setVisibility(c,e),s(c)})}})}catch(l){g.debug("Could not getOrgMetadataIndexWithSelections: "+l.message),s([])}else g.debug("org_metadata not found, returning empty array"),s([])})},S.prototype.hasIndexedMetadata=function(){return i.isArray(this.orgMetadata)&&this.orgMetadata.length>0},S.prototype.updateLocalStore=function(e){var t=this;return new o(function(n,r){o.resolve(e).then(function(e){i.isArray(e)||(e=[e]);try{var o=t.getLocalStore();i.each(e,function(e){e.attributes&&(e=y(e));var n;if(e.type?n=t.metadataHelper.getTypeByXmlName(e.type):e.attributes&&e.attributes.type?(n=t.metadataHelper.getTypeByXmlName(e.attributes.type),e.fullName=e.name,e.fileName=["unpackaged",n.directoryName,e.name+"."+n.suffix].join("/"),e.createdByName=e.createdBy.name,e.lastModifiedByName=e.lastModifiedBy.name,e.manageableState=e.namespacePrefix?"managed":"unmanaged",e.namespacePrefix=e.namespacePrefix,e.type=n.xmlName,delete e.createdBy,delete e.lastModifiedBy,delete e.attributes):n=t.metadataHelper.getTypeByPath(e.fileName.split(".")[1]),g.debug(n),n&&e.attributes){var r=e.name+"."+n.suffix,i=e;i.mmState="clean",o[r]=i}else if(n&&e.fullName.indexOf("package.xml")===-1){var r=e.fullName+"."+n.suffix,i=e;i.mmState="clean",o[r]=i}else e.fullName.indexOf("package.xml")===-1&&g.debug("Could not determine metadata type for: "+JSON.stringify(e))});var s=c.join(t.path,"config",".local_store");a.outputFile(s,JSON.stringify(o,null,4),function(e){e?(g.error("Could not write local store: "+e.message),r(e)):n()})}catch(u){g.error("Could not update local store -->"+u.message),r(u)}})})},S.prototype._writeLocalStore=function(e){var t=this;return new o(function(n,r){g.debug("writing to local store"),o.resolve(e).then(function(e){try{i.isArray(e)||(e=[e]),g.debug("writing local store..."),g.silly(e);var o={};i.each(e,function(e){t.metadataHelper||(t.metadataHelper=new f({sfdcClient:t.sfdcClient}));var n=t.metadataHelper.getTypeByPath(e.fileName);if(g.silly(n),void 0!==n&&e.fullName.indexOf("package.xml")===-1){var r=e.fullName+"."+n.suffix,i=e;i.mmState="clean",o[r]=i}else e.fullName.indexOf("package.xml")===-1&&g.warn("Could not determine metadata type for: "+JSON.stringify(e))});var s=c.join(t.path,"config",".local_store");a.outputFile(s,JSON.stringify(o,null,4),function(e){e?r(new Error("Could not write local store: "+e.message)):n()})}catch(u){g.error("Could not initiate local store",u),r(u)}})["catch"](function(e){g.error("fileproperties promise rejected",e),r(e)})})},S.prototype._updateDebug=function(e,t){var n=this;return new o(function(o,r){g.debug("updating debug setting ["+e+"]"),g.debug(t);var i;try{i=a.readJsonSync(c.join(n.path,"config",".debug"))}catch(s){r(new Error("Could not read project .debug file: "+s.message))}i[e]=t,g.debug("Updating project debug: "),g.debug(i);try{a.writeFileSync(c.join(n.path,"config",".debug"),JSON.stringify(i,null,4)),o()}catch(s){g.error("Could not write project .debug file -->"+s.message),r(s)}})},S.prototype._writeDebug=function(){var e=this;return new o(function(t,n){var o={users:[e.sfdcClient.conn.userInfo.user_id],logType:"USER_DEBUG",debugLevelName:"MAVENSMATE",levels:{Workflow:"INFO",Callout:"INFO",System:"DEBUG",Database:"INFO",ApexCode:"DEBUG",ApexProfiling:"INFO",Validation:"INFO",Visualforce:"DEBUG"},expiration:480},r=c.join(e.path,"config",".debug");a.outputFile(r,JSON.stringify(o,null,4),function(e){e?n(e):t()})})},S.prototype._writeEditorSettings=function(){var e=this;return new o(function(t,n){var o={folders:[{folder_exclude_patterns:["config/.symbols"],path:"."}],settings:{auto_complete_triggers:[{characters:".",selector:"source - comment"},{characters:":",selector:"text.html - comment"},{characters:"<",selector:"text.html - comment"},{characters:" ",selector:"text.html - comment"}]}},r=c.join(e.path,[e.name,"sublime-project"].join("."));a.outputFile(r,JSON.stringify(o,null,4),function(e){e?n(e):t()})})},S.prototype._listenForTokenUpdates=function(){var e=this;0===e.sfdcClient.listeners("token-refresh").length&&e.sfdcClient.on("token-refresh",function(){g.debug("handling sfdcClient:token-refresh");try{e._writeCredentials(!0)}catch(t){throw g.error("Could not store updated credentials",t),t}})},S.prototype.updateCredentials=function(e){var t=this;return g.debug("updating project creds",e),new o(function(n,r){var i=e.username||t.settings.username,a=e.password,c=e.accessToken,s=e.refreshToken,u=e.orgType||t.settings.environment||t.settings.orgType,l=e.loginUrl||t.settings.loginUrl,d=e.instanceUrl;i&&a?t.sfdcClient=new m({username:i,password:a,orgType:u,loginUrl:l,instanceUrl:d}):t.sfdcClient=new m({username:i,accessToken:c,refreshToken:s,orgType:u,loginUrl:l,instanceUrl:d}),t.sfdcClient.initialize().then(function(){return t._writeCredentials(!0),t.writeSettings({username:i,orgType:u,loginUrl:l,instanceUrl:d}),t._updateDebug("users",[t.sfdcClient.getUserId()])}).then(function(){return t.requiresAuthentication?(g.debug("project required authentication, running init again"),t._initExisting()):new o(function(e){e()})}).then(function(){t._listenForTokenUpdates(),n()})["catch"](function(e){g.error("Could not update credentials -->"+e.message),r(e)}).done()})},S.prototype._writeCredentials=function(e){var t=this;try{if(g.debug("_writeCredentials"),t.keychainService.useSystemKeychain()){g.debug("storing credentials in system keychain");var n=e?"replacePassword":"storePassword";t.sfdcClient.password?t.keychainService[n](t.id||t.settings.id,t.sfdcClient.password,"password"):(t.keychainService[n](t.id||t.settings.id,t.sfdcClient.accessToken,"accessToken"),t.keychainService[n](t.id||t.settings.id,t.sfdcClient.refreshToken,"refreshToken")),g.debug("removing local .credentials store if it exists"),a.existsSync(c.join(t.path,"config",".credentials"))&&a.removeSync(c.join(t.path,"config",".credentials"))}else g.debug("storing credentials in config/.credentials"),t.sfdcClient.password?a.writeFileSync(c.join(t.path,"config",".credentials"),JSON.stringify({password:t.sfdcClient.password},null,4)):a.writeFileSync(c.join(t.path,"config",".credentials"),JSON.stringify({accessToken:t.sfdcClient.accessToken,refreshToken:t.sfdcClient.refreshToken},null,4))}catch(o){throw g.error("Error writing credentials -->",o),new Error("Could not write credentials: "+o.message)}},S.prototype._readCredentials=function(){try{return a.existsSync(c.join(this.path,"config",".credentials"))?a.readJsonSync(c.join(this.path,"config",".credentials")):{accessToken:this.keychainService.getPassword(this.settings.id,"accessToken",!0),refreshToken:this.keychainService.getPassword(this.settings.id,"refreshToken",!0),password:this.keychainService.getPassword(this.settings.id,"password",!0)}}catch(e){throw g.error("Error reading credentials -->",e),new Error("Could not read credentials for project "+this.name+": "+e.message)}},e.exports=S},function(e,t){e.exports=require("fs")},function(e,t,n){"use strict";var o=n(1),r=n(11),i=n(4),a=n(7),c=function(e){this.project=e};c.prototype.createCheckpoint=function(e,t){var n=this;return new o(function(o,a){i.debug("creating checkpoint for filepath: "+e),i.debug(t);var c=new r.MavensMateFile({project:n.project,path:e});n.project.sfdcClient.conn.tooling.sobject("ApexExecutionOverlayAction").create({ActionScriptType:"None",ExecutableEntityId:c.id,IsDumpingHeap:!0,Iteration:1,Line:t,ScopeId:n.project.sfdcClient.getUserId()},function(e,t){e?a(e):o(t)})})},c.prototype.deleteCheckpointsForCurrentUser=function(){var e=this;return new o(function(t,n){i.debug("deleting checkpoints for current user"),e.project.sfdcClient.conn.tooling.query("Select Id From ApexExecutionOverlayAction Where ScopeId = '"+e.project.sfdcClient.getUserId()+"'",function(o,r){if(o)return n(o);if(r.size>0){var i=[];a.each(r.records,function(e){i.push(e.Id)}),e.project.sfdcClient.conn.tooling.sobject("ApexExecutionOverlayAction").destroy(i).then(function(e){return t(e)})["catch"](function(e){n(e)})}else t()})})},c.prototype.deleteCheckpoint=function(e,t){var n=this;return new o(function(o,a){i.debug("deleting checkpoint");var c=new r.MavensMateFile({project:n.project,path:e});n.project.sfdcClient.conn.tooling.query("Select Id From ApexExecutionOverlayAction Where ExecutableEntityId = '"+c.id+"' AND ScopeId = '"+n.project.sfdcClient.getUserId()+"' AND Line = "+t,function(e,t){return i.debug(e),i.debug(t),e?a(e):void(t.size>0?n.project.sfdcClient.conn.tooling.sobject("ApexExecutionOverlayAction").destroy(t.records[0].Id).then(function(e){return o(e)})["catch"](function(e){a(e)}):o())})})},c.prototype.listCheckpoints=function(e){var t=this;return new o(function(n,o){i.debug("listing checkpoints for filePath: "+e);var a=new r.MavensMateFile({project:t.project,path:e});t.project.sfdcClient.conn.tooling.query("Select Id From ApexExecutionOverlayAction Where ExecutableEntityId = '"+a.id+"' AND ScopeId = '"+t.project.sfdcClient.getUserId()+"'",function(e,t){e?o(e):n(t)})})},e.exports=c},function(e,t,n){"use strict";function o(e){u.applyProperties(this,e),this.project?(this.metadataHelper=new m({sfdcClient:this.project.sfdcClient}),this.sfdcClient=this.project.sfdcClient):this.sfdcClient&&(this.metadataHelper=new m({sfdcClient:this.sfdcClient}))}var r=n(7),i=n(1),a=n(19),c=n(8),s=n(6),u=n(3),l=n(98),d=n(4),p=n(147).parseString,m=n(15).MetadataHelper,f=n(20),h=n(11).MavensMateFile;o.prototype._indexChildren=function(e,t,n,o){var c=this;return new i(function(i,m){try{d.debug("_indexChildren -->"+n),d.debug(o);var f={};o&&o.length>0&&(f[n]=o),d.debug("child retrieve package is: "),d.debug(f);var h=a.mkdirSync({prefix:"mm_"});c.sfdcClient.retrieveUnpackaged(f,!0,h).then(function(o){var a=l(s.join(h,"unpackaged",t[n].directoryName));a.on("file",function(t){var o=s.basename(t),i=o.split(".")[0],a=u.getFileBody(t);d.silly(o),d.silly(i),d.silly(a);var l=r.find(e.children,{id:[n,i].join(".")});d.silly("indexedChildType -->"),d.silly(l),d.silly("\n\n"),p(a,function(e,t){r.forOwn(t[n],function(e,t){var o=r.find(c.metadataHelper.childTypes,{tagName:t});if(o){var a=[];r.isArray(e)||(e=[e]),r.each(e,function(e){var r;e.fullName?r=e.fullName[0]:e.actionName?r=e.actionName[0]:d.error("Unrecognized child metadata type ",o,e),r&&a.push({leaf:!0,checked:!1,level:4,text:r,title:r,isFolder:!1,id:[n,i,t,r].join("."),select:!1})}),r.find(l,{text:t})||l.children.push({checked:!1,level:3,id:[n,i,t].join("."),text:t,title:t,isFolder:!0,children:a,select:!1,cls:"folder"})}})})}),a.on("end",function(){i(e)}),a.on("error",function(e){d.error("Could not crawl retrieved metadata: "+e.message),m(e)})})["catch"](function(e){d.error("Could not index metadata type "+n+": "+e.message),d.error(e.stack),m(e)}).done()}catch(g){d.error("Could not index metadata type "+n+": "+g.message),m(g)}})},o.prototype._indexFolders=function(e,t,n){var o=this;return new i(function(t,a){var c=[];r.each(e.children,function(e){c.push(o.sfdcClient.listFolder(n,e.fullName))}),i.all(c).then(function(o){r.each(o,function(t){var o=Object.keys(t)[0],i=t[o],a=r.find(e.children,{text:o});r.each(i,function(e){a.children.push({leaf:!0,title:e.fullName.split("/")[1],checked:!1,text:e.fullName.split("/")[1],level:3,isFolder:!1,id:[n,e.fullName.split("/")[0],e.fullName.split("/")[1]].join("."),select:!1})})}),t(e)})["catch"](function(e){d.error("Could not finish indexing server properties: "+e.message),a(e)}).done()})},o.prototype._indexType=function(e,t){var n=this;return new i(function(o,i){d.debug("indexing type "),d.silly(e);var a,c,s,l={},p=[];r.forOwn(e,function(e,o){u.endsWith(o,"Folder")&&(o=n._transformFolderNameToBaseName(o)),d.silly("key: "+o),d.silly("items: "),d.silly(e),s=o,a=r.has(t[o],"childXmlNames"),c=t[o].inFolder;var i=t[o];l.id=o,l.type=i,l.title=o,l.xmlName=o,l.text=o,l.key=o,l.level=1,l.hasChildTypes=a,l.isFolder=!0,l.inFolder=c,l.cls="folder",l.select=!1,l.expanded=!1,r.each(e,function(e){d.silly("---->"),d.silly(e),e.fullName=e.fullName||new h({path:e.fileName}).name,e.leaf=!a&&!c,e.title=e.fullName,e.checked=!1,e.id=[o,e.fullName].join("."),e.text=e.fullName,e.cls=a||c?"folder":"",e.level=2,e.isFolder=a||c,e.children=[],e.select=!1,a&&p.push(e.fullName)}),e=r.sortBy(e,"title"),l.children=e});var m;a?m=n._indexChildren(l,t,s,p):c&&(m=n._indexFolders(l,t,s)),void 0!==m?m.then(function(e){o(e)})["catch"](function(e){d.error("Could not index children/folders for "+s+": "+e.message),i(e)}).done():o(l)})},o.prototype.indexServerProperties=function(e){var t=this;return new i(function(n,o){e||(e=c.get("mm_default_subscription")),d.debug("indexing typeXmlNames: "),d.debug(e);var a={},s=[];r.each(e,function(e){d.debug("adding type to map: "),d.debug(e);var n=t.metadataHelper.getTypeByXmlName(e);if(!n)throw new Error("Unknown metadata type: "+e);a[e]=n;var o,i=a[e].inFolder;if(o=i?t._transformFolderNameForListRequest(e):e,d.silly(f),r.has(f,e+"ListProvider")){var c=new f[e+"ListProvider"](t.sfdcClient);s.push(c.getList())}else s.push(t.sfdcClient.list(o))}),i.all(s).then(function(e){var n=[];return r.each(e,function(e){d.silly("indexing type promise: "),d.silly(e),d.silly(JSON.stringify(a)),n.push(t._indexType(e,a))}),i.all(n)}).then(function(e){n(e)})["catch"](function(e){d.error("An error occurred indexing server properties"),d.error(e.message),d.error(e.stack),o(e)})})},o.prototype._transformFolderNameForListRequest=function(e){var t=e+"Folder";return"EmailTemplateFolder"===t&&(t="EmailFolder"),t},o.prototype._transformFolderNameToBaseName=function(e){return"EmailFolder"===e?"EmailTemplate":e.replace("Folder","")},o.prototype.crawlDict=function(e,t,n,o){var i=this;t+=1;var a=0,c=0;return r.forOwn(e,function(e,t){"title"===t&&(r.isString(e)&&e.toLowerCase().indexOf(n)>=0?a=1:!r.isObject(e)&&!r.isArray(e)&&e.toLowerCase().indexOf(n)>=0&&(a=1))}),r.forOwn(e,function(e,o){i.crawl(e,t,n,a)>0&&(c=1),a=a>c?a:c}),e.visibility=a,0===a&&(e.cls="hidden",e.addClass="dynatree-hidden"),a},o.prototype.crawlArray=function(e,t,n,o){var i=this;t+=1;var a,c=[],s=0;r.each(e,function(e){r.isString(e)?a=e.toLowerCase().indexOf(n)>=0:r.isObject(e)?(a=i.crawl(e,t,n,o),e.index=s):a=e.toLowerCase().indexOf(n)>=0,0===a&&0===o?(c.push(e),e.cls="hidden",e.addClass="dynatree-hidden"):e.isFolder&&(e.expanded=!0),s+=1})},o.prototype.crawl=function(e,t,n,o){var i=this;if(r.isArray(e)){i.crawlArray(e,t,n,o);var a=!1;return r.each(e,function(e){if(r.has(e,"visibility")&&1===e.visibility)return a=!0,!1}),a}return r.isObject(e)?i.crawlDict(e,t,n,o):0},o.prototype.setVisibility=function(e,t){this.crawl(e,0,t.toLowerCase(),0)},o.prototype.ensureParentsAreCheckedIfNecessary=function(e){r.each(e,function(e){if(e.children&&r.isArray(e.children)){var t=0;r.each(e.children,function(e){e.select&&t++}),e.children.length===t&&e.children>0&&(e.checked=!0,e.select=!0)}})},o.prototype.setChecked=function(e,t,n,o){o||(o=""),t||(t=[]),n||(n=0);var i=this;r.isArray(e)?r.each(e,function(e){r.isObject(e)&&r.has(e,"id")&&t.indexOf(e.id)>=0&&(e.checked=!0,e.select=!0),i.setChecked(e,t,n+2)}):r.isObject(e)&&r.forOwn(e,function(e,o){i.setChecked(e,t,n+1,o)})},o.prototype.setThirdStateChecked=function(e,t,n,o){var i=this;if(o||(o=""),t||(t=[]),n||(n=0),r.isArray(e))r.each(e,function(e){return!r.isObject(e)&&void i.setThirdStateChecked(e,t,n+2)});else if(r.isObject(e)){if(r.has(e,"children")&&r.isArray(e.children)&&e.children.length>0){var a=e.children,c=a.length,s=0;r.each(a,function(e){r.has(e,"checked")&&e.checked&&(s+=1)}),c===s?e.checked=!0:s>0&&(e.cls="x-tree-checkbox-checked-disabled")}r.forOwn(e,function(e,o){i.setThirdStateChecked(e,t,n+1,o)})}},e.exports=o},function(e,t,n){"use strict";function o(e){e.tests=e.tests||e.classes||e.paths||[],c.applyProperties(this,e),this._initialize()}var r=n(1),i=n(7),a=n(6),c=n(3),s=n(10),u=n(4),l=n(21),d=n(8),p=n(28);o.prototype._initialize=function(){var e=this;e.apexClassOrTriggerIdToName={},e.testClassNames=[],i.each(this.tests,function(t){var n=i.isString(t)?t:t.testNameOrPath;if(n.indexOf(a.sep)!==-1){if(n.indexOf(e.project.path)===-1)throw new Error("Test does not exist in this project: "+n)}else{n.indexOf(".")===-1&&(n+=".cls");var o=a.join(e.project.path,"src","classes",n);if(o.indexOf(e.project.path)===-1||!s.existsSync(o))throw new Error("Test does not exist in this project: "+n)}e.testClassNames.push(n.indexOf(a.sep)!==-1?a.basename(n):n)})},o.prototype.getResultHtml=function(e){return e.project=this.project,p.renderFile("views/unit_test/result.html",e)},o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.project.getLocalStore();u.silly(o);var s=[],l=[];i.isString(e.tests[0])?(s=[],i.each(e.testClassNames,function(e){if(u.debug("adding test to job",e),!o[e])return n(new Error("Invalid project metadata cache. Run Index Metadata command to reset the cache."));var t=o[e].id;s.push(t),l.push(t)})):i.each(e.tests,function(e){if(u.debug("adding test to job",e),!o[a.basename(e.testNameOrPath)])return n(new Error("Invalid project metadata cache. Run Index Metadata command to reset the cache."));var t=o[a.basename(e.testNameOrPath)].id;s.push({classId:t,testMethods:e.methodNames}),l.push(t)}),u.debug("running the following tests: "),u.debug(s);var p,m,f=[],h=[],g={},y={};e.project.sfdcClient.runTests(s).then(function(t){p=t.classResults,m=t.methodResults,i.forOwn(e.project.getLocalStore(),function(t,n){c.endsWith(n,".cls")?(f.push(t.id),e.apexClassOrTriggerIdToName[t.id]=t.fullName):c.endsWith(n,".trigger")&&(h.push(t.id),e.apexClassOrTriggerIdToName[t.id]=t.fullName)});var n=[],o=[];return d.get("mm_download_categorized_test_logs")&&i.each(m.records,function(t){t.ApexLogId&&o.indexOf(t.ApexLogId)===-1&&(o.push(t.ApexLogId),n.push(e._downloadLog(t.ApexClass.Name,t.ApexLogId)))}),r.all(n)}).then(function(){i.each(p.records,function(e){var t=e.ApexClass.Name;y[t]=e,y[t].results=i.where(m.records,{ApexClassId:e.ApexClassId})}),e.skipCoverage?(u.info("skipping test coverage..."),t({testResults:y})):(u.info("getting test coverage..."),e.getCoverage(f,l).then(function(t){return g.classes=t,e.getCoverage(h,l)}).then(function(e){g.triggers=e,t({testResults:y,coverageResults:g})})["catch"](function(e){u.error("Failed to get coverage"),u.error(e),n(e)}).done())})["catch"](function(e){u.error("Could not run tests"),u.error(e),n(e)}).done()})},o.prototype.getOrgWideCoverage=function(){var e=this;return new r(function(t,n){var o="SELECT PercentCovered FROM ApexOrgWideCoverage";e.project.sfdcClient.conn.tooling.query(o,function(e,o){e?n(e):t(o.records[0].PercentCovered)})})},o.prototype.getCoverage=function(e,t){var n=this;return new r(function(o,a){function s(e){return new r(function(t,o){var r="SELECT "+p+" FROM "+l+" WHERE ApexClassOrTriggerId IN ("+c.joinForQuery(e)+")";d&&(r+=d),u.debug("coverage query: ",r),n.project.sfdcClient.conn.tooling.query(r,function(e,n){e?o(e):t(n)})})}var l="ApexCodeCoverage";void 0===t&&(l="ApexCodeCoverageAggregate");var d,p=["NumLinesCovered","NumLinesUncovered","Coverage","ApexClassOrTriggerId"].join(",");t&&t.length>0&&(d=" AND ApexTestClassId IN ("+c.joinForQuery(t)+")");var m=i.chunk(e,250),f=[];i.each(m,function(e){f.push(s(e))}),r.all(f).then(function(e){return n._aggregateCoverage(e)}).then(function(e){o(e)})["catch"](function(e){u.error("Could not get coverage: "+e.message),a(e)})})},o.prototype._downloadLog=function(e,t){var n=this;return new r(function(o,r){s.existsSync(a.join(n.project.path,"debug","tests",e))||s.mkdirpSync(a.join(n.project.path,"debug","tests",e));var i=n.project.sfdcClient.conn.tooling._baseUrl()+"/sobjects/ApexLog/"+t+"/Body";n.project.sfdcClient.conn.tooling.request(i,function(t,i){if(t)r(new Error("Could not download log: "+t.message));else{var c=[l().format("YYYY-MM-DD HH-mm-ss"),"log"].join("."),u=a.join(n.project.path,"debug","tests",e,c);s.outputFile(u,i,function(e){e?r(new Error("Could not write log file: "+e.message)):o()})}})})},o.prototype._aggregateCoverage=function(e){var t=this;return new r(function(n,o){try{var r={};i.each(e,function(e){i.each(e.records,function(e){u.silly("coverage result : -->"),u.silly(e);var n=t.apexClassOrTriggerIdToName[e.ApexClassOrTriggerId];if(u.silly(n),i.has(r,n)){var o=r[n];u.silly("have coverage result for ",n),u.silly("adding coverage"),o.coveredLines=i.union(o.coveredLines,e.Coverage.coveredLines),o.uncoveredLines=i.union(o.uncoveredLines,e.Coverage.uncoveredLines),u.silly(o)}else u.silly("adding coverage result for ",n),r[n]={},r[n].coveredLines=e.Coverage.coveredLines,r[n].uncoveredLines=e.Coverage.uncoveredLines,u.silly(r[n])})}),u.silly("coverage results: ",r),i.forOwn(r,function(e,t){e.uncoveredLines=i.difference(e.uncoveredLines,e.coveredLines),e.totalLines=e.coveredLines.length+e.uncoveredLines.length,0===e.totalLines?e.percentCovered=0:e.percentCovered=Math.round(parseFloat(e.coveredLines.length/e.totalLines*100))}),n(r)}catch(a){o(new Error("Could not aggregate coverage: "+a.message))}})},e.exports=o},function(e,t){e.exports=require("node-uuid")},function(e,t){e.exports={mm_workspace:{title:"Workspaces",description:"Array of local workspaces. These should be absolute, valid paths.",example:'*nix paths should include a leading slash. Windows paths should include the drive and escaped back slashes.<br/><br/>*nix Example: [ "/path/to/workspace", "/path/to/another/workspace" ]<br/>Windows Example: [ "C:\\\\some\\\\path", "C:\\\\another\\\\path" ]',type:"array","default":[],order:10},mm_api_version:{title:"Salesforce API Version",description:"The API version you would like to use when accessing the Salesforce APIs.",type:"string","default":"36.0",order:20},mm_compile_check_conflicts:{title:"Check conflicts before compile",description:"Set to true to check for conflicts when compiling Apex/Visualforce metadata.",type:"boolean","default":!0,order:35},mm_download_categorized_test_logs:{title:"Download categorized Apex unit test logs",description:"Set to true to download Apex unit test logs to your project's debug/<test-name>/ directory",type:"boolean","default":!1,order:36},mm_timeout:{title:"Timeout, in seconds",description:"Timeout (in seconds) for MavensMate commands.",type:"integer","default":600,order:40},mm_default_subscription:{title:"Default metadata subscription",description:"Array of metadata types that should be included in every new MavensMate project, e.g. ApexClass, ApexPage, CustomObject, StaticResource",type:"array","default":["ApexClass","ApexComponent","ApexPage","ApexTrigger","StaticResource"],order:50},mm_ignore_managed_metadata:{title:"Ignore managed metadata",description:"Set to true to prevent managed metadata from being downloaded to your MavensMate projects",type:"boolean","default":!0,order:160},mm_use_keyring:{title:"Use keyring",description:"Set to true if you would like MavensMate to use your machine's keychain support to store/retrieve Salesforce.com credentials. If set to false, MavensMate will store passwords in plain text in your project's config/.settings and config/.org_connections files.",type:"boolean","default":!0,order:60},mm_compile_with_tooling_api:{title:"Compile Apex/Visualforce metadata with Tooling API",description:"Set to true to use the tooling api to compile apex metadata (if you're experiencing compile issues, set this to false to use the metadata api)",type:"boolean","default":!0,order:30},mm_subl_location:{title:"Sublime Text location",description:"The full path of your Sublime Text executable (Sublime Text users only).",type:"object",order:11,"default":{windows:"C:\\Program Files\\Sublime Text 3\\sublime_text.exe",linux:"/usr/bin/subl",osx:"/Applications/Sublime Text.app/Contents/SharedSupport/bin/subl"}},mm_atom_exec_path:{title:"Atom executable location",description:"The full path to atom executable (Atom users only).",type:"object","default":{windows:"C:\\Program Files\\Atom\\Atom.exe",linux:"/usr/bin/atom",osx:"/usr/local/bin/atom"},order:150},mm_vscode_exec_path:{title:"Visual Studio Code executable location",description:'The full path to Visual Studio "code" executable (Visual Studio Code users only).',type:"object","default":{windows:"C:\\Program Files\\Code\\Code.exe",linux:"/usr/bin/code",osx:"/usr/local/bin/code"},order:150},mm_log_location:{title:"MavensMate logs location",description:"Full path to the location where you would like MavensMate to store its logs. When this and mm_log_level are set, MavensMate will write logs to this path with the file name mavensmate.log. Relevant logs should be included with any bug reports.",type:"string","default":"",order:70},mm_log_level:{title:"Plugin log level",description:"Possible values: INFO, WARN, DEBUG, VERBOSE, SILLY",type:"string","default":"DEBUG",order:80},mm_play_sounds:{title:"Play sounds",description:"Set to true if you would like MavensMate to play notification sounds on events like deployments, unit tests, etc.",type:"boolean","default":!0,order:90},mm_template_location:{title:"MavensMate templates location",description:'Possible values: remote or local. Set to "remote" when templates should be sourced from GitHub. Set to "local" if you have cloned MavensMate-Templates locally and wish to source templates from your local file system.',type:"string","default":"remote",order:130},mm_template_source:{title:"MavensMate template source",description:'If "mm_template_location" is set to "local", set this to the absolute location of the directory where you\'ve forked the MavensMate-Templates project.',example:'"/path/on/your/machine/to/templates"<br/>If "mm_template_location" is set to "remote", set to github location ("username/reponame/branchname"). Project structure must be in the format found here: https://github.com/joeferraro/MavensMate-Templates',type:"string","default":"joeferraro/MavensMate-Templates/master",order:140},mm_apex_file_extensions:{title:"Salesforce file extensions",description:'Array of file extensions that should be considered "Salesforce" file extensions.',type:"array","default":[".page",".component",".cls",".object",".trigger",".layout",".resource",".remoteSite",".labels",".app",".dashboard",".permissionset",".workflow",".email",".profile",".scf",".queue",".reportType",".report",".weblink",".tab",".letter",".role",".homePageComponent",".homePageLayout",".objectTranslation",".flow",".datacategorygroup",".snapshot",".site",".sharingRules",".settings",".callCenter",".community",".authProvider",".customApplicationComponent",".quickAction",".approvalProcess",".html"],order:170},mm_http_proxy:{title:"HTTP Proxy",description:"Set if you are behind a proxy (you can also set via export HTTP_PROXY, export HTTPS_PROXY). Example: http://10.10.1.10:3128 or http://user:pass@10.10.1.10:3128/",type:"string","default":"",order:190},mm_https_proxy:{title:"HTTPS Proxy",description:"Set if you are behind a proxy (you can also set via export HTTP_PROXY, export HTTPS_PROXY). Example: http://10.10.1.10:3128 or http://user:pass@10.10.1.10:3128/",type:"string","default":"",order:200},mm_purge_on_delete:{title:"Purge on delete",description:"Set to true to perform a hard delete when deleting metadata.",type:"boolean","default":!0,order:200},mm_legacy_compile:{title:"Use legacy compile method",description:"Set to true to perform a retrieve via the metadata API after Apex/VF compilation. Only set to true if you are having trouble compiling.",type:"boolean","default":!1,order:210}}},function(e,t,n){"use strict";var o=n(6),r=n(10),i=n(3),a=n(7),c=n(8),s=n(4),u=(n(22),function(e){i.applyProperties(this,e)});u.prototype.util=i,u.prototype.config=c,u.prototype.getSupportedEditors=function(){return this.supportedEditors},u.prototype.isMenuItemActive=function(e,t){if(a.isString(t))return 0===e.indexOf("/app/"+t);if(a.isArray(t)){for(var n in t)if(0===e.indexOf("/app/"+t[n]))return!0;return!1}return!1},u.prototype.getPhotoUrl=function(e){try{return e.sfdcClient.conn.userInfo.photos.thumbnail+"?oauth_token="+e.sfdcClient.accessToken}catch(t){return null}},u.prototype.getPathBaseName=function(e){return o.basename(e)},u.prototype.getRobotPath=function(){return this.getBaseUrl()+"/app/static/images/robots/"+(Math.floor(5*Math.random())+1).toString()+".png"},u.prototype.getRobotNoise=function(){var e=["blerg","bloop","beep boop boop","beep boop beep","morp","jonk","ping","zonk","xonx","morple","fwat","turple"],t=Math.floor(Math.random()*e.length)+0;return e[t]},u.prototype.listProjects=function(){var e=c.get("mm_workspace"),t=[];
return a.isString(e)&&""===e&&(e=[]),a.isArray(e)||(e=[e]),a.each(e,function(e){try{var n=i.listDirectories(e);a.each(n,function(e){var n=o.join(e,"config",".settings");if(r.existsSync(n)){var a=i.getFileBody(n,!0);t.push({id:a.id,path:e})}})}catch(c){s.error("Could not list projects: "+c.message)}}),t},u.prototype.getStaticResourcePath=function(){return this.getBaseUrl()+"/app/static"},u.prototype.getBaseUrl=function(){return"http://localhost:"+this.port},u.prototype.getDefaultSubscription=function(){return c.get("mm_default_subscription")},u.prototype.getWorkspaces=function(){var e=c.get("mm_workspace");return a.isArray(e)||(e=[e]),e},u.prototype.getMetadataObjects=function(e){return a.sortBy(e.getDescribe().metadataObjects,"xmlName")},u.prototype.doesClassOrTriggerExist=function(e,t,n){return"ApexClass"===n?r.existsSync(o.join(e.path),"src","classes",t+".cls"):"ApexTrigger"===n?r.existsSync(o.join(e.path),"src","triggers",t+".trigger"):void 0},u.prototype.getFileLines=function(e,t,n){return"ApexClass"===n?r.readFileSync(o.join(e.path,"src","classes",t+".cls"),"utf8").toString().split(/\r?\n/):"ApexTrigger"===n?r.readFileSync(o.join(e.path,"src","triggers",t+".trigger"),"utf8").toString().split(/\r?\n/):void 0},u.prototype.getCoverageCssClass=function(e){return e<=40?"error":e<75?"warning":"success"},u.prototype.htmlize=function(e){try{return e=e.replace(/&/g,"&amp;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/\n/g,"<br/>"),e=e.replace(/\t/g,"&nbsp;&nbsp;&nbsp;&nbsp;"),e=e.replace(/\s/g,"&nbsp;")}catch(t){return e}},u.prototype.getDeployMessageFileNameBaseName=function(e){return e.split("/").pop()},u.prototype.isFalse=function(e){return e===!1||"false"===e||0===e},u.prototype.isTrue=function(e){return e===!0||"true"===e||1===e},e.exports=u},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(5),a=n(2),c=n(91);a(o,i),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=new c(e.getProject());o.create(e.payload.name).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("new-apex-script [scriptName]").description("Creates a new apex script").action(function(t){t?e.commandExecutor.execute({name:this._name,body:{name:t}}):(console.error("Please specify a script name"),process.exit(1))})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(5),a=n(2),c=n(91),s=n(3);a(o,i),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=new c(e.getProject());o.execute(e.payload.paths).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("run-apex-script [scriptPath]").alias("execute-apex-script").description("Executes an apex script").action(function(t){t?e.commandExecutor.execute({name:this._name,body:{paths:s.getAbsolutePaths([t])}}):(console.error("Please specify a valid script path"),process.exit(1))})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(32);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new c(o);r.deleteCheckpoint(e.payload.path,e.payload.lineNumber).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("delete-checkpoint [filePath] [lineNumber]").description("Creates Apex checkpoint").action(function(t,n){e.commandExecutor.execute({name:this._name,body:{path:t,lineNumber:n}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(93);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new c(o);r.downloadLog(e.payload.logId).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("download-log [logId]").description("Downloads a log to your project's debug/logs directory").action(function(t){e.commandExecutor.execute({name:this._name,body:{logId:t}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(5),c=n(2);n(9);c(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.isUICommand()?(e.editorService.launchUI("apex/new",{pid:e.getProject().settings.id}),t("Success")):e.getProject().sfdcClient.executeApex(e.payload).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("execute-apex").option("--ui","Launches the Apex execute anonymous UI.").description("Execute Apex code anonymously").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(6),s=n(26);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=c.join(o.path,"debug");s.existsSync(r)?s.removeAsync(r).then(function(){t("Successfully flushed debug logs")})["catch"](function(e){n(e)}):t("No debug directory detected")})},t.command=o,t.addSubCommand=function(e){e.command("flush-logs").alias("delete-logs").description("Deletes all log files in a project").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(32);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new c(o);r.listCheckpoints(e.payload.path).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("new-checkpoint [filePath]").description("List Apex checkpoints for filepath").action(function(t){e.commandExecutor.execute({name:this._name,body:{path:t}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(32);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new c(o);r.createCheckpoint(e.payload.path,e.payload.lineNumber).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("new-checkpoint [filePath] [lineNumber]").description("Creates Apex checkpoint").action(function(t,n){e.commandExecutor.execute({name:this._name,body:{path:t,lineNumber:n}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(21);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=o.sfdcClient,i=o.getDebugSettingsSync(),a=c().add(i.expiration,"minutes");r.startLogging(i,a).then(function(){t("Started logging for debug users")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("start-logging").description("Starts logging Apex execution for all user ids listed in your project's config/.debug file").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);n(21);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=o.sfdcClient,i=o.getDebugSettingsSync();r.stopLogging(i.users).then(function(){t("Stopped logging for debug users")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("stop-logging").description("Stops logging Apex execution for all user ids listed in your project's config/.debug file").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(24)),a=n(2),c=n(5);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new i(o);r.remove(e.payload.id).then(function(){t("Successfully deleted org connection")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("delete-connection [connectionId]").description("Removes a new deployment connection").action(function(t){e.commandExecutor.execute({name:this._name,body:{id:t}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(18),c=n(2),s=n(5),u=n(4);n(9);c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(e.isUICommand())e.editorService.launchUI("deploy/new",{pid:e.getProject().settings.id}).then(function(){t("Success")})["catch"](function(e){n(e)});else{var o=e.payload;o.project=e.getProject(),u.debug("initiating deploy: ",o.targets,o["package"]);var r=new a(o),i=o.deployOptions||void 0;u.debug("deploying: "),u.debug("deployOptions: ",i),r.executeRemote(i).then(function(n){t(e.payload.ui?r.getResultHtml(o.targets,o.deployOptions,n):n)})["catch"](function(e){n(e)}).done()}})},t.command=o,t.addSubCommand=function(e){e.command("deploy").option("--ui","Launches the default UI for the selected command.").description("Deploys metadata to one or more remote Salesforce.com orgs").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(24)),a=n(2),c=n(5);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new i(o);r.listAll().then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("get-connections").alias("list-connections").description("Retrieves a list of deployment connections").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(24)),a=n(2),c=n(5);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new i(o);r.add(e.payload).then(function(){t("Org connection successfully created")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("new-connection [username] [password] [orgType]").description("Adds a new deployment connection").action(function(t,n,o){e.commandExecutor.execute({name:this._name,body:{username:t,password:n,orgType:o}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(24)),a=n(2),c=n(5);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new i(o);r.update(e.payload).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("update-connection [connectiondId] [username] [password] [orgType]").description("Updates a new deployment connection").action(function(t,n,o,r){e.commandExecutor.execute({name:this._name,body:{id:t,username:n,password:o,orgType:r}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(7),a=n(3),c=n(2),s=n(5),u=(n(9),n(16)),l=n(23),d=n(6),p=n(11).MavensMateFile;c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(!e.isUICommand()){var o,a,c=e.getProject(),s=new u(c),m=e.payload.apiName;return s.createBundle(m,e.payload.description).then(function(t){a=t.id;var n=[];return n.push(s.createApplication(a)),e.payload.createController&&n.push(s.createController(a)),e.payload.createHelper&&n.push(s.createHelper(a)),e.payload.createStyle&&n.push(s.createStyle(a)),e.payload.createDocumentation&&n.push(s.createDocumentation(a)),e.payload.createRenderer&&n.push(s.createRenderer(a)),r.all(n)}).then(function(e){var t=i.where(e,{success:!1});return t.length>0?void s.deleteBundle(a).then(function(){throw new Error(JSON.stringify(t))}):(o=new p({project:c,path:d.join(c.path,"src","aura",m)}),o.writeToDiskSync(),c.packageXml.subscribe(o),c.packageXml.writeFileSync())}).then(function(){var e=new l(c,[o.path]);return e.execute()}).then(function(){return c.indexLightning()}).then(function(){t("Lightning app created successfully")})["catch"](function(e){n(e)}).done()}e.editorService.launchUI("lightning/app/new",{pid:e.getProject().settings.id}).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("new-lightning-app").option("--ui","Launches the default UI for the selected command.").description("Creates new lightning application").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;a.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(7),a=n(3),c=n(2),s=n(5),u=(n(9),n(16)),l=n(23),d=n(6),p=n(11).MavensMateFile;c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(!e.isUICommand()){var o,a,c=e.getProject(),s=new u(c),m=e.payload.apiName;return s.createBundle(m,e.payload.description).then(function(t){a=t.id;var n=[];return n.push(s.createComponent(a)),e.payload.createController&&n.push(s.createController(a)),e.payload.createHelper&&n.push(s.createHelper(a)),e.payload.createStyle&&n.push(s.createStyle(a)),e.payload.createDocumentation&&n.push(s.createDocumentation(a)),e.payload.createRenderer&&n.push(s.createRenderer(a)),r.all(n)}).then(function(e){var t=i.where(e,{success:!1});return t.length>0?void s.deleteBundle(a).then(function(){throw new Error(JSON.stringify(t))}):(o=new p({project:c,path:d.join(c.path,"src","aura",m)}),o.writeToDiskSync(),c.packageXml.subscribe(o),c.packageXml.writeFileSync())}).then(function(){var e=new l(c,[o.path]);return e.execute()}).then(function(){return c.indexLightning()}).then(function(){t("Lightning component created successfully")})["catch"](function(e){n(e)}).done()}e.editorService.launchUI("lightning/component/new",{pid:e.getProject().settings.id}).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("new-lightning-component").option("--ui","Launches the default UI for the selected command.").description("Creates new lightning component").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;a.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(7),a=n(3),c=n(2),s=n(5),u=(n(9),n(16)),l=n(11).MavensMateFile,d=n(6),p=n(23);c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(!e.isUICommand()){var o,a,c=e.getProject(),s=new u(c),m=e.payload.apiName;return s.createBundle(m,e.payload.description).then(function(e){a=e.id;var t=[];return t.push(s.createEvent(a)),r.all(t)}).then(function(e){var t=i.where(e,{success:!1});return t.length>0?void s.deleteBundle(a).then(function(){throw new Error(JSON.stringify(t))}):(o=new l({project:c,path:d.join(c.path,"src","aura",m)}),o.writeToDiskSync(),c.packageXml.subscribe(o),c.packageXml.writeFileSync())}).then(function(){var e=new p(c,[o.path]);return e.execute()}).then(function(){return c.indexLightning()}).then(function(){t("Lightning event created successfully")})["catch"](function(e){n(e)}).done()}e.editorService.launchUI("lightning/event/new",{pid:e.getProject().settings.id}).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("new-lightning-event").option("--ui","Launches the default UI for the selected command.").description("Creates new lightning event").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;a.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(7),a=n(3),c=n(2),s=n(5),u=(n(9),n(16)),l=n(11).MavensMateFile,d=n(6),p=n(23);c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(!e.isUICommand()){var o,a,c=e.getProject(),s=new u(c),m=e.payload.apiName;return s.createBundle(m,e.payload.description).then(function(e){a=e.id;var t=[];return t.push(s.createInterface(a)),r.all(t)}).then(function(e){var t=i.where(e,{success:!1});return t.length>0?void s.deleteBundle(a).then(function(){throw new Error(JSON.stringify(t))}):(o=new l({project:c,path:d.join(c.path,"src","aura",m)}),o.writeToDiskSync(),c.packageXml.subscribe(o),c.packageXml.writeFileSync())}).then(function(){var e=new p(c,[o.path]);return e.execute()}).then(function(){return c.indexLightning()}).then(function(){t("Lightning interface created successfully")})["catch"](function(e){n(e)}).done()}e.editorService.launchUI("lightning/interface/new",{pid:e.getProject().settings.id}).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("new-lightning-interface").option("--ui","Launches the default UI for the selected command.").description("Creates new lightning interface").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;a.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(107);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new s(o,e.payload.paths,e.payload.force);r.execute().then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("compile-metadata [path]").alias("compile").description("Compiles metadata").action(function(t){if(t)e.commandExecutor.execute({name:this._name,body:{paths:i.getAbsolutePaths([t])}});else{var n=this;i.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(108),u=n(11);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),i=e.payload;i.project=o;var a,c=new s(o,i.paths);c.execute().then(function(e){if(a=e,e.success){var t=u.createFileInstances(i.paths);return o.packageXml.unsubscribe(t),o.packageXml.writeFile()}return new r(function(e){e()})}).then(function(){t(a)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("delete-metadata [path]").alias("delete").description("Deletes metadata from the salesforce.com server").action(function(t){if(t)e.commandExecutor.execute({name:this._name,body:{paths:i.getAbsolutePaths([t])}});else{var n=this;i.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(11),c=(n(18),n(2)),s=n(5),u=(n(9),n(6)),l=n(20).Package,d=n(19),p=n(10),m=n(4);c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(e.isUICommand())e.editorService.launchUI("metadata/"+e.payload.args.type+"/new",{pid:e.getProject().settings.id,type:e.payload.args.type}).then(function(){t("Success")})["catch"](function(e){n({message:"Could not open new metadata UI",error:e})});else{var o,r=e.getProject(),i=new a.MavensMateFile({project:r});if(i.setTypeByXmlName(e.payload.metadataTypeXmlName),i.template=e.payload.template,i.templateValues=e.payload.templateValues,i.apexTriggerObjectName=e.payload.templateValues.object_name||e.payload.templateValues.objectName,i.name=e.payload.templateValues.api_name||e.payload.templateValues.apiName,!i.name)return n(new Error("You must provide an API name"));i.setAbstractPath();var c=d.mkdirSync({prefix:"mm_"}),s=u.join(c,"unpackaged");p.mkdirsSync(s),r.sfdcClient.createApexMetadata(i).then(function(e){return o=new l({subscription:a.createPackageSubscription([i])}),o.init()}).then(function(){return r.sfdcClient.retrieveUnpackaged(o.subscription,!0,c)}).then(function(e){return r.updateLocalStore(e.fileProperties)}).then(function(){return r.replaceLocalFiles(s)}).then(function(){return r.packageXml.subscribe(i),r.packageXml.writeFile()}).then(function(){m.debug("attempting to open metadata ...");var n=u.join(r.path,"src",i.type.directoryName,[i.name,i.type.suffix].join("."));return m.debug(n),m.debug(e.editorService.editor),e.editorService&&e.editorService.editor?e.editorService.open(n):t("New metadata successfully created")}).then(function(){t("New metadata successfully created")})["catch"](function(e){n(e)}).done()}})},t.command=o,t.addSubCommand=function(e){e.command("new-metadata").option("--ui","Launches the default UI for the selected command.").option("-t, --type [type]","Type of metadata to create (ApexClass, ApexPage, ApexTrigger, ApexComponent, etc.").description("Creates new metadata based on supplied template and params").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0,type:this.type}}});else{var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(7),u=(n(9),n(11).MavensMateFile),l=n(11).types,d=n(4);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.payload.paths,i=e.getProject(),a=i.sfdcClient.getInstanceUrl()+"/secur/frontdoor.jsp?sid="+i.sfdcClient.getAccessToken()+"&retURL=",c=[],p={};s.each(o,function(t){var n=new u({project:i,path:t}),o="";if("ApexPage"===n.type.xmlName&&e.payload.preview)o="/apex/"+n.name;else if(n.isLightningType&&e.payload.preview){var r;r=n.classification===l.LIGHTNING_BUNDLE_ITEM?n.folderBaseName:n.name,o="/"+i.sfdcClient.getNamespace()+"/"+r+".app"}else o="CustomObject"===n.type.xmlName?"/p/setup/layout/LayoutFieldList?type="+n.name+"%23CustomFieldRelatedList_target":"/"+n.id;d.debug("url generated : "+a+o),e.payload.callThrough?c.push(e.editorService.openUrl(a+o)):p[n.basename]=a+o}),e.payload.callThrough?r.all(c).then(function(){t("Success")})["catch"](function(e){n(e)}):t(p)})},t.command=o,t.addSubCommand=function(e){e.command("open-metadata [path]").description("Opens metadata in the browser").action(function(t){if(t)e.commandExecutor.execute({name:this._name,body:{paths:i.getAbsolutePaths([t])}});else{var n=this;i.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(6),a=n(3),c=n(2),s=n(5),u=n(23),l=(n(9),n(4));c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o,a=e.getProject(),c=e.payload.paths;if(1!==c.length||c[0]!==a.path&&c[0]!==i.join(a.path,"src")){l.debug("refreshing paths from server ...");var s=new u(a,c);o=s.execute()}else l.debug("refreshing project from server ..."),o=a.refreshFromServer();o.then(function(n){return l.debug("refresh command result: "),l.debug(n),e.editorService&&"sublime"===e.editorService.editor?void e.editorService.runCommand("refresh_folder_list").then(function(){t()})["catch"](function(e){l.error(e),t()}):r.resolve()}).then(function(){t("Metadata successfully refreshed")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("refresh-metadata [path]").alias("refresh").description("Refreshes metadata from the salesforce.com server").action(function(t){if(t)e.commandExecutor.execute({name:this._name,body:{paths:a.getAbsolutePaths([t])}});else{var n=this;a.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(110);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new s(o,e.payload.path);r.execute().then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("sync-with-server [path]").description("Syncs the local path with the server").action(function(t){if(t)e.commandExecutor.execute({name:this._name,body:{path:i.getAbsolutePaths([t])[0]}});else{var n=this;i.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject();o.sfdcClient.executeSoql(e.payload.soql).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("execute-soql [soql]").description("Executes soql query").action(function(t){e.commandExecutor.execute({name:this._name,body:{soql:t}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(8);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){t({value:c.get(e.payload.key)})})},t.command=o,t.addSubCommand=function(e){e.command("get-setting [key]").description("Returns the setting value for the given key").action(function(t){e.commandExecutor.execute({name:this._name,body:{key:t}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(6),i=n(1),a=(n(3),n(2)),c=n(5);a(o,c),o.prototype.execute=function(){var e=this;return new i(function(t,n){var o=e.getProject(),i=r.basename(e.payload.className,".cls");o.indexSymbols(i).then(function(){t("Symbols successfully indexed for "+e.payload.className)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("index-apex-class [className]").description("Indexes Apex class's symbols").action(function(t){e.commandExecutor.execute({name:this._name,body:{className:t}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject();o.indexSymbols().then(function(){t("Symbols successfully indexed")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("index-apex").alias("index-symbols").description("Indexes project's Apex symbols").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(17),u=n(33),l=(n(7),n(4));a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){l.debug("payload",e.payload);var o=new s({accessToken:e.payload.accessToken,instanceUrl:e.payload.instanceUrl,"transient":!0});o.initialize().then(function(){var t=new u({sfdcClient:o});return t.indexServerProperties(e.payload.metadataTypes)}).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("list-metadata [typeXmlName").description("Lists metadata for given type").action(function(t){if(t)e.commandExecutor.execute({name:this._name,body:{metadataTypes:[t]}});else{var n=this;i.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(5)),a=n(2);n(9),n(4);a(o,i),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject()?{pid:e.getProject().settings.id}:void 0;e.editorService.launchUI("settings",o).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("open-settings").description("Launches the settings ui").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=(n(9),n(4));i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=o.sfdcClient.getInstanceUrl()+"/secur/frontdoor.jsp?sid="+o.sfdcClient.getAccessToken()+"&retURL=/setup/forcecomHomepage.apexp?setupid=ForceCom";c.debug("attempting to open salesforce org. setupUrl is",r),e.editorService.openUrl(r).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("open-sfdc").description("Opens salesforce developer home page in the browser").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(5)),a=n(2);n(9),n(4);a(o,i),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject()?{pid:e.getProject().settings.id}:void 0;e.editorService.launchUI("home",o).then(function(){t("Success")})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("open-ui").description("Launches the default ui").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(17),u=(n(33),n(8)),l=n(7);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=new s(e.payload);o.initialize().then(function(){var e={sid:o.conn.accessToken,urls:o.conn.userInfo.urls,instanceUrl:o.conn.instanceUrl,username:o.conn.userInfo.username,metadataTypes:l.sortBy(o.describeCache.metadataObjects,"xmlName")};"mavensmate cli"===process.title?(u.set("mm_cli_salesforce_session_id",e.sid),u.set("mm_cli_salesforce_instance_url",e.instanceUrl),u.save(function(o){o?n(o):t(e)})):t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("session [username] [password] [orgType]").alias("get-active-session").alias("login").option("--verbose","Returns server urls and describe information").description("Creates new salesforce.com session, returns session id").action(function(t,n,o){if(t&&n)e.commandExecutor.execute({name:this._name,body:{username:t,password:n,orgType:o||"developer"}});else{var r=this;i.getPayload().then(function(t){e.commandExecutor.execute({name:r._name,body:t,editor:r.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=(n(9),n(5)),c=n(4);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.getProject().clean().then(function(){
return e.editorService&&"sublime"===e.editorService.editor?void e.editorService.runCommand("refresh_folder_list").then(function(){t()})["catch"](function(e){c.error(e),t()}):r.resolve()}).then(function(){t("Project cleaned successfully")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("clean-project").alias("clean").description("Retrieves metadata from server based on project package.xml file, resets session").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject();o.compile().then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("compile-project").description("Compiles project based on package.xml").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(5),c=n(2),s=(n(9),n(4));c(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.isUICommand()?e.editorService.launchUI("project/"+e.getProject().settings.id+"/edit",{pid:e.getProject().settings.id}).then(function(){t("Success")})["catch"](function(e){n(error)}):e.getProject().edit(e.payload["package"]).then(function(){return e.editorService&&"sublime"===e.editorService.editor?void e.editorService.runCommand("refresh_folder_list").then(function(){t()})["catch"](function(e){s.error(e),t()}):r.resolve()}).then(function(){t("Project updated successfully!")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("edit-project").alias("edit").option("--ui","Launches the default UI for the selected command.").description("Edits an existing project").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.getProject().getOrgMetadataIndexWithSelections(null,null,e.payload.packageXmlPath).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("get-metadata-index-for-package").description("Gets metadata index for a given package location").action(function(){var t=this;util.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.getProject().getOrgMetadataIndexWithSelections().then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("get-metadata-index").description("Returns indexed metadata").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject();o.indexMetadata().then(function(){t("Metadata successfully indexed")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("index-metadata").description("Indexes project's metadata").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(37),a=n(5),c=n(2);n(4);c(o,a),o.prototype.execute=function(){return new r(function(e,t){try{var n=new i;e(n.listProjects())}catch(o){t(o)}})},t.command=o,t.addSubCommand=function(e){e.command("list-projects").description("List projects in all workspaces").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(30),c=n(5),s=n(17),u=n(2),l=n(4);n(9);u(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(e.isUICommand())e.editorService.launchUI("project/existing/new",{origin:e.payload.args.origin}).then(function(){t("Success")})["catch"](function(e){n(e)});else{var o,r=new s(e.payload);r.initialize().then(function(){return o=new a(e.payload),o.sfdcClient=r,o.initialize(!0,!0)}).then(function(){return l.debug("New project written to disk ..."),l.debug("attempting to open in editor"),e.editorService&&e.editorService.editor?e.editorService.open(o.path):t({message:"Project created successfully",id:o.id})}).then(function(){return t({message:"Project created successfully",id:o.id})})["catch"](function(e){l.debug("Could not create project: "),l.debug(e.stack),n(e)}).done()}})},t.command=o,t.addSubCommand=function(e){e.command("new-project-from-existing-directory").option("--ui","Launches the default UI for the selected command.").option("-d, --directory [directory]","Directory to create new mavensmate project from").description("Creates a new MavensMate project from an existing directory").action(function(){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0,directory:this.directory}}});else{var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(7),n(3)),a=(n(99),n(30)),c=n(5),s=n(17),u=n(2),l=n(4);n(9),n(8);u(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(e.isUICommand())e.editorService.launchUI("project/new").then(function(){t("Success")})["catch"](function(e){n(e)});else{if(!e.payload.name)return n(new Error("Please specify project name"));var o,r=new s(e.payload);r.initialize().then(function(){return o=new a(e.payload),o.sfdcClient=r,o.initialize(!0)}).then(function(){return l.debug("Initiated new project, prepping to write to disk"),o.retrieveAndWriteToDisk()}).then(function(){return e.editorService&&e.editorService.editor?e.editorService.open(o.path):t({message:"Project created successfully",id:o.id})}).then(function(){t({message:"Project created successfully",id:o.id})})["catch"](function(e){l.debug("Could not create project: "),l.debug(e.stack),n(e)}).done()}})},t.command=o,t.addSubCommand=function(e){e.command("new-project").option("--ui","Launches the default UI for the selected command.").description("Creates a new Salesforce1 project").action(function(){if(this.ui)l.debug(e.commandExecutor),e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})}})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=(n(3),n(5)),a=n(2);n(9),n(4);a(o,i),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.editorService.launchUI("project/"+e.getProject().settings.id+"/auth",{pid:e.getProject().settings.id}).then(function(){t("Please authenticate with Salesforce")})["catch"](function(e){n(error)})})},t.command=o,t.addSubCommand=function(e){e.command("oauth-project").description("Displays oauth UI for project").action(function(){e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(6),a=n(10),c=(n(3),n(5)),s=n(2);n(9),n(4);s(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){if(!e.editorService||!e.editorService.editor)return n(new Error('Please specify an editor either via "MavensMate-Editor-Agent" HTTP header, editor POST body, or -e/--editor command line flag'));var o=e.getProject().path;if("sublime"===e.editorService.editor){var r=i.join(o,e.getProject().name+".sublime-project");a.existsSync(r)&&(o=r)}e.editorService.open(o).then(function(){t("Opened project in "+e.editorService.editor)})["catch"](function(e){n(e)})})},t.command=o,t.addSubCommand=function(e){e.command("open-project").alias("open").description("Open a project in the editor").action(function(){e.commandExecutor.execute({name:this._name})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.getProject().getOrgMetadataIndexWithSelections(e.payload.keyword,e.payload.ids).then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("search-metadata-index").description("Searches metadata index").action(function(){var t=this;util.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5);i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject();o.updateCredentials(e.payload).then(function(){t("Credentials updated successfully!")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("update-creds [username] [password] [orgType] [loginUrl]").description("Update project's salesfore.com credentials").action(function(t,n,o,r){var i={username:t,password:n,orgType:o,loginUrl:r};e.commandExecutor.execute({name:this._name,body:i})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){try{var o=e.getProject();o.writeSettings({subscription:e.payload.subscription}),t("Subscription updated successfully!")}catch(r){n(r)}})},t.command=o,t.addSubCommand=function(e){e.command("update-subscription").description("Updates project metadata subscription").action(function(){var t=this;i.getPayload().then(function(n){e.commandExecutor.execute({name:t._name,body:n,editor:t.parent.editor})})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(94),c=n(2),s=n(5);c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new a(o);r.deploy(e.payload.paths).then(function(){t("Resource bundle successfully deployed")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("deploy-resource-bundle [bundlePath]").description("Deploys a resource bundle to the server, e.g. mavensmate deploy-resource-bundle path/to/resource/bundle ").action(function(t){t?e.commandExecutor.execute({name:this._name,body:{paths:i.getAbsolutePaths([t])}}):(console.error("Please specify a valid bundle path"),process.exit(1))})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(94),c=n(2),s=n(5);c(o,s),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o=e.getProject(),r=new a(o);r.create(e.payload.paths).then(function(){t("Resource bundle(s) successfully created")})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("new-resource-bundle [staticResourcePath]").description("Creates a resource bundle from a static resource, e.g. mavensmate new-resource-bundle path/to/static/resource").action(function(t){e.commandExecutor.execute({name:this._name,body:{paths:i.getAbsolutePaths([t])}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(2),a=n(5),c=n(34),s=n(11).MavensMateFile;i(o,a),o.prototype.execute=function(){var e=this;return new r(function(t,n){var o,r=new c({project:e.getProject()});if(e.payload.global)o=r.getOrgWideCoverage();else{var i=new s({project:e.getProject(),path:e.payload.paths[0]});r.apexClassOrTriggerIdToName[i.id]=i.basename,o=r.getCoverage([i.id])}o.then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("get-coverage [apexClassOrTriggerPath]").option("-g, --global","Org-wide coverage").description("Gets coverage for a specified class").action(function(t){this.global?e.commandExecutor.execute({name:this._name,body:{global:!0}}):e.commandExecutor.execute({name:this._name,body:{paths:[t]}})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(1),i=n(3),a=n(2),c=n(5),s=n(34);n(9);a(o,c),o.prototype.execute=function(){var e=this;return new r(function(t,n){e.payload.project=e.getProject();var o=new s(e.payload);o.execute().then(function(e){t(e)})["catch"](function(e){n(e)}).done()})},t.command=o,t.addSubCommand=function(e){e.command("run-test-method [testNameOrPath] [testMethodName]").alias("test").description("Runs an Apex unit test method").action(function(t,n){var o=this;if(t&&n){var r={tests:[{testNameOrPath:t,methodNames:[n]}]};e.commandExecutor.execute({name:o._name,body:r,editor:o.parent.editor})}else i.getPayload().then(function(t){e.commandExecutor.execute({name:o._name,body:t,editor:o.parent.editor})})})}},function(e,t,n){"use strict";function o(){o.super_.call(this,Array.prototype.slice.call(arguments,0))}var r=n(7),i=n(1),a=n(3),c=n(2),s=n(5),u=n(34);n(9);c(o,s),o.prototype.execute=function(){var e=this;return new i(function(t,n){if(e.isUICommand()){var o={pid:e.getProject().settings.id};e.payload&&e.payload.classes&&r.isArray(e.payload.classes)&&(o.className=[e.payload.classes[0]]),e.editorService.launchUI("test/new",o).then(function(){t("Success")})["catch"](function(e){n(e)})}else{e.payload.project=e.getProject();var i=new u(e.payload);i.execute().then(function(n){t(e.payload.html?i.getResultHtml(n):n)})["catch"](function(e){n(e)}).done()}})},t.command=o,t.addSubCommand=function(e){e.command("run-tests [testPath]").alias("test").option("--ui","Launches the Apex test runner UI.").description("Runs Apex unit tests").action(function(t){if(this.ui)e.commandExecutor.execute({name:this._name,body:{args:{ui:!0}},editor:this.parent.editor});else{var n=this;if(t){var o={tests:[t]};e.commandExecutor.execute({name:n._name,body:o,editor:n.parent.editor})}else a.getPayload().then(function(t){e.commandExecutor.execute({name:n._name,body:t,editor:n.parent.editor})})}})}},function(e,t,n){"use strict";var o=n(1),r=n(10),i=n(6),a=n(3),c=n(7),s=function(e){if(!e)throw new Error("ApexScriptService requires a valid project instance");this.project=e};s.prototype.create=function(e){var t=this;return new o(function(n,o){try{var a=i.join(t.project.path,"apex-scripts");r.ensureDirSync(a),r.outputFileSync(i.join(a,[e,"cls"].join(".")),""),n("Apex script created successfully")}catch(c){o(c)}})},s.prototype.execute=function(e){var t=this;return c.isArray(e)||(e=[e]),new o(function(n,r){var s=[];c.each(e,function(e){var n=a.getFileBody(e),o={body:n};s.push(t.project.sfdcClient.executeApex(o))}),o.all(s).then(function(t){var o={};c.each(e,function(e,n){o[i.basename(e)]=t[n]}),n(o)})["catch"](function(e){r(e)}).done()})},e.exports=s},function(e,t,n){"use strict";var o=!0;try{var r=n(139)}catch(i){o=!1}var a=n(8),c=(n(27),n(4)),s=function(){};s.prototype.useSystemKeychain=function(){return a.get("mm_use_keyring")&&o},s.prototype.isSystemKeychainSupported=function(){return o},s.prototype.storePassword=function(e,t,n){if(c.debug("Storing password of type",n,"for",e),this.useSystemKeychain()){var o=r.addPassword("MavensMate-"+n,e,t);if(!o)throw new Error("Could not store "+n+" for "+e);return o}throw new Error("Attempt to store password failed: system keychain service not supported")},s.prototype.replacePassword=function(e,t,n){if(c.debug("Replacing password of type",n,"for",e),this.useSystemKeychain()){var o=r.replacePassword("MavensMate-"+n,e,t);if(!o)throw new Error("Could not replace "+n+" for "+e);return o}throw new Error("Attempt to replace password in keychain failed: system keychain service not supported")},s.prototype.getPassword=function(e,t,n){if(c.debug("Retrieving password of type",t,"for",e),this.useSystemKeychain()){var o=r.getPassword("MavensMate-"+t,e);if(!o&&!n)throw new Error("Could not get "+t+" for "+e);return o}throw new Error("Attempt to get password from keychain failed: system keychain service not supported")},e.exports=s},function(e,t,n){"use strict";var o=n(7),r=n(1),i=n(10),a=n(6),c=n(21),s=n(25),u=n(2),l=n(4),d=function(e){this.project=e};u(d,s.EventEmitter),d.prototype.downloadLog=function(e){var t=this;return new r(function(n,o){i.existsSync(a.join(t.project.path,"debug","logs"))||i.mkdirpSync(a.join(t.project.path,"debug","logs"));var r=t.project.sfdcClient.conn.tooling._baseUrl()+"/sobjects/ApexLog/"+e+"/Body";t.project.sfdcClient.conn.tooling.request(r,function(e,r){if(e)o(new Error("Could not download log: "+e.message));else{var s=[c().format("YYYY-MM-DD HH-mm-ss"),"log"].join("."),u=a.join(t.project.path,"debug","logs",s);i.outputFile(u,r,function(e){e?o(new Error("Could not write log file: "+e.message)):(t.emit("mavensmate-log-downloaded",u),n(u))})}})})},d.prototype.getLogs=function(){var e=this;return new r(function(t,n){try{var r=a.join(e.project.path,"debug","logs"),c=[];i.readdir(r,function(e,n){o.each(n,function(e){c.push(a.join(r,e))}),t(c)})}catch(s){n(s)}})},d.prototype.getLog=function(e){return new r(function(t,n){try{if(!i.existsSync(e))return n(new Error("Log file not found"));i.readFile(e,"utf8",function(e,o){if(e)n(e);else{var r=o.toString().split(/\r?\n/);l.debug("doneeee"),t(r)}})}catch(o){n(o)}})},d.prototype.filter=function(e,t){return new r(function(n,r){try{if(!i.existsSync(e))return r(new Error("Log file not found"));var a=[],c=i.readFileSync(e,"utf8").toString().split(/(?=^\d{2}:\d{2}:\d{2}\.\d+ \(\d+\)\|)/gm),s=new RegExp(t,"i");o.each(c,function(e){s.test(e)&&a.push(e)}),n(a)}catch(u){r(u)}})},e.exports=d},function(e,t,n){"use strict";var o=n(7),r=n(26),i=n(6),a=n(1),c=n(11),s=n(3),u=n(4),l=n(18),d=function(e){this.project=e};d.prototype.create=function(e){var t=this;return new a(function(n,s){u.debug(e);var l=[],d=[];o.each(e,function(e){u.debug(e);var n=new c.MavensMateFile({project:t.project,path:e});if(!n.existsOnFileSystem)throw new Error("Could not find static resource path");if("StaticResource"!==n.type.xmlName)throw new Error("File is not a static resource");l.push(n);var o=i.join(t.project.path,"resource-bundles",[n.name,"resource"].join("."));if(r.existsSync(o))throw new Error("Resource bundle path already exists.");r.ensureDirSync(o),d.push(t._write(n.path,o))}),a.all(d).then(function(){n()})["catch"](function(e){s(new Error("Could not create resource bundle(s): "+e.message))}).done()})},d.prototype._write=function(e,t){return new a(function(n,o){var i=r.createReadStream(e);s.writeStream(i,t).then(function(){n(t)})["catch"](function(t){o(new Error("Could not write bundle stream for "+e+": "+t.message))}).done()})},d.prototype.deploy=function(e){var t=this;return new a(function(n,r){u.debug("deploying resource bundle paths: ",e);var s=[],d=[];o.each(e,function(e){var n=i.join(t.project.path,"src","staticresources",i.basename(e));u.debug("static resource path is: "+n),d.push(new c.MavensMateFile({project:t.project,path:n})),s.push(t._zip(e,n))});var p=c.createPackageSubscription(d,t.project.packageXml);a.all(s).then(function(){u.debug("directories zipped, prepping for deployment");var e=new l({project:t.project});e.compileWithMetadataApi(d,p).then(function(e){n(e)})["catch"](function(e){r(e)}).done()})["catch"](function(e){r(e)}).done()})},d.prototype._zip=function(e,t){return new a(function(n,o){r.existsSync(t)&&r.removeAsync(t).then(function(){var n=i.basename(e);return u.debug("zipping "+e+", TO: "+i.dirname(t)),s.zipDirectory(e,i.dirname(t),"","resource",n.split(".")[0])}).then(function(){n()})["catch"](function(e){o(e)})})},e.exports=d},function(e,t,n){(function(t){"use strict";function o(){}var r=n(1),i=n(6),a=n(3),c=n(100),s=n(8),u=n(4);o.prototype.getTemplatesForType=function(e){var t=this;return new r(function(n,o){t._getPackage().then(function(t){n(t[e])})["catch"](function(t){o(new Error("Could not retrieve templates for type: "+e+", "+t.message))}).done()})},o.prototype.getTemplateBody=function(e,n){return new r(function(o,r){var l=n.file_name?template.file_name:n,d=s.get("mm_template_source");void 0!==d&&""!==d||(d="joeferraro/MavensMate-Templates/master");var p=s.get("mm_template_location");void 0!==p&&""!==p||(p="remote"),u.debug("templateSource",d),u.debug("templateLocation",p);var m;try{"remote"===p?c("https://raw.githubusercontent.com/"+d+"/"+e+"/"+l,function(t,n,r){m=t||200!==n.statusCode?a.getFileBody(i.join(d,e,l)):r,o(m)}):"local"===p?(m=a.getFileBody(i.join(d,e,l)),o(m)):(m=a.getFileBody(i.join(t,"templates","github",e,l)),o(m))}catch(f){u.error("Could not retrieve template body",f),m=a.getFileBody(i.join(t,"templates","github",e,l)),o(m)}})},o.prototype._getPackage=function(){return new r(function(e,n){try{var o=s.get("mm_template_source");o||(o="joeferraro/MavensMate-Templates/master");var r=s.get("mm_template_location");r||(r="remote");var u;"remote"===r?c("https://raw.githubusercontent.com/"+o+"/package.json",function(n,o,r){u=n||200!==o.statusCode?a.getFileBody(i.join(t,"templates","github","package.json"),!0):JSON.parse(r),e(u)}):"local"===r?(u=JSON.parse(a.getFileBody(i.join(o,"package.json"))),e(u)):(u=a.getFileBody(i.join(t,"templates","github","package.json"),!0),e(u))}catch(l){n(new Error("Could not obtain template package: "+l.message))}})},e.exports=o}).call(t,"/")},function(e,t){e.exports=function(e){return e?e.replace(/[_-]+(\w)/g,function(e){return e[1].toUpperCase()}):""}},function(e,t){e.exports=require("child_process")},function(e,t){e.exports=require("findit")},function(e,t){e.exports=require("merge")},function(e,t){e.exports=require("request")},function(e,t){e.exports=require("which")},function(e,t,n){"use strict";function o(e,t){var n=this;if(!u.isDev()){this.window=e;var o=i.getVersion(),r=t.get("mm_beta_channel",!1)?"beta":"stable";a.addListener("update-available",function(e){console.log("A new update is available"),l("An update is available from channel: "+r)}),a.addListener("update-downloaded",function(e,t,o,i,a){u.isMac()&&l("Update from channel "+r+" is ready to install on quit: "+a),n._notify(o)}),a.addListener("error",function(e){console.log(e),l("Error updating from channel "+r+": "+e.message)}),a.addListener("checking-for-update",function(e){console.log("checking-for-update in channel: "+r),l("Checking for update in channel: "+r)}),a.addListener("update-not-available",function(){console.log("update-not-available for channel: "+r),l("Update not available for channel: "+r),"beta"===r&&(console.log("updater checking stable channel"),l("updater checking stable channel"),r="stable",a.setFeedURL("https://"+d+"/update/channel/"+r+"/"+s.platform()+"_"+s.arch()+"/"+o),a.checkForUpdates())}),c.on("quit-and-install",function(){a.quitAndInstall()}),a.setFeedURL("https://"+d+"/update/channel/"+r+"/"+s.platform()+"_"+s.arch()+"/"+o),a.checkForUpdates()}}var r=n(14),i=r.app,a=r.autoUpdater,c=r.ipcMain,s=n(27),u=n(103),l=n(141),d="mavensmate-app-auto-updater.herokuapp.com";o.prototype._notify=function(e){u.isLinux()||u.isWindows()?this.window.webContents.send("update-available",e,"download"):u.isMac()&&this.window.webContents.send("update-available",e,"quit")},e.exports=o},function(e,t,n){"use strict";var o=n(14),r=n(27),i=e.exports={};i.isDev=function(){return o.app.getAppPath().includes("/node_modules/electron-prebuilt/")},i.isWindows=function(){return"win32"===r.platform()},i.isLinux=function(){return"linux"===r.platform()},i.isMac=function(){return"darwin"===r.platform()}},function(e,t,n){(function(t){"use strict";var o,r,i=n(7),a=n(6),c=n(28),s=n(12),u=n(135),l=n(8),d=n(105)(),p=n(9),m=n(37),f=n(13),h=n(3);e.exports.start=function(e){return new Promise(function(g,y){e=e||{},(!l.get("mm_workspace")||i.isArray(l.get("mm_workspace"))&&0===l.get("mm_workspace").length)&&(l.set("mm_workspace",[h.getDefaultWorkspaceSetting()]),l.save()),o=s(),o.use(u.urlencoded({extended:!0})),o.use(u.json({limit:"100mb"})),o.use(n(113)),o.use(n(115)),o.use(n(114)),o.use(n(116)),o.use(n(117));var v=new m({port:e.port,supportedEditors:(new p).supportedEditors});c.setDefaults({runInVm:!0,locals:{mavensmate:{ui:v}},loader:c.loaders.fs(a.join(a.dirname(t),"app"))}),o.engine("html",c.renderFile),o.set("swig",c),o.set("view engine","html"),o.set("views",a.join(t,"views")),o.set("view cache",!1),o.set("helper",v),o.use("/app/static",s["static"](a.join(h.getAppRoot(),"app","public"))),o.use(n(124)),o.set("commandExecutor",n(29)(e.openWindowFn)),o.set("openWindowFn",e.openWindowFn),o.set("requestStore",f),o.set("projects",[]),o.set("mode",e.mode),r=o.listen(e.port,function(){process.env.MAVENSMATE_SERVER_PORT=e.port,process.env.MAVENSMATE_CONTEXT="server",o.set("io",n(144)(r)),g({app:o,server:r})}),r.on("error",function(e){d.error(e),y(e)})})},e.exports.stop=function(){return new Promise(function(e,t){r.close(function(){delete process.env.MAVENSMATE_SERVER_PORT,delete process.env.MAVENSMATE_CONTEXT,e()})})}}).call(t,"/")},function(e,t,n){"use strict";e.exports=function(e){e=e||{};var t=n(31),o=n(6),r=n(4),i=n(8);try{r.remove(r.transports.Console)}catch(a){}var c;if(c=i.get("mm_log_level")?i.get("mm_log_level").toLowerCase():"info",(!e.program||e.program&&e.program.verbose)&&(r.cli(),r.add(r.transports.Console,{level:c,exitOnError:!1,prettyPrint:!0,colorize:!0})),t.existsSync(i.get("mm_log_location")))try{r.add(r.transports.File,{filename:o.join(i.get("mm_log_location"),"mavensmate.log"),level:c,json:!1})}catch(a){if(a.message.indexOf("Transport already attached")===-1)throw a}return r.info("MavensMate log level: "+c),r}},function(e,t,n){var o=t,r=n(1),i=n(104);o.CommandExecutor=n(29),o.Project=n(30),o.SalesforceClient=n(17),o.startServer=function(e){return new r(function(t,o){e=e||{};try{var r=e.port||"56248";e.verbose||!1;i.start({port:r,verbose:e.verbose,openWindowFn:e.openWindowFn,mode:e.mode}).then(function(e){console.log("MavensMate server running on port: "+r),e.config=n(8),e.logger=n(4),t(e)})["catch"](function(e){console.error("Could not run MavensMate server",e),o(e)})}catch(a){console.error("MavensMate server failed to start: "+a.message),o(a)}})},o.stopServer=function(e){i.stop()}},function(e,t,n){"use strict";var o=n(1),r=n(7),i=n(4),a=n(19),c=n(8),s=n(16),u=n(15).MetadataHelper,l=n(18),d=n(10),p=n(11),c=n(8),m=n(21),f=n(20).Package,h=function(e,t,n){if(!e||!t)throw new Error("CompileDelegate requires a valid project instance and an array of paths to compile.");this.project=e,this.paths=t,this.force=n,this.metadataHelper=new u({sfdcClient:this.project.sfdcClient})};h.prototype.execute=function(){var e=this;return new o(function(t,n){e._performCompile().then(function(n){t(e._flattenResults(n))})["catch"](function(e){n(e)})})},h.prototype._flattenResults=function(e){var t={checkOnly:!1,completedDate:"",createdBy:"",createdByName:"",createdDate:"",details:{componentSuccesses:[],runTestResult:{numFailures:"0",numTestsRun:"0",totalTime:"0.0"},componentFailures:[]},done:!1,id:"",ignoreWarnings:!1,lastModifiedDate:"",numberComponentErrors:0,numberComponentsDeployed:0,numberComponentsTotal:0,numberTestErrors:0,numberTestsCompleted:0,numberTestsTotal:0,rollbackOnError:!1,runTestsEnabled:"false",startDate:"",status:"",success:!0};return i.debug("flattening results: "),r.each(e,function(e){i.debug("compile result:"),i.debug(e),r.has(e,"runTestsEnabled")?t=e:r.has(e,"hasConflict")&&!e.success?(t.details.conflicts=e.conflicts,t.status="Conflict",t.success=!1,t.done=!0):r.isArray(e)&&(t.details.componentFailures||(t.details.componentFailures=[]),r.each(e,function(e){r.has(e,"State")&&("Completed"===e.State?(t.numberComponentsDeployed++,t.details.componentSuccesses.push(e)):(t.numberComponentErrors++,t.details.componentFailures.push(e),t.success=!1))}))}),i.debug("compile results: "),i.debug(JSON.stringify(t)),t},h.prototype._performCompile=function(){var e=this;return new o(function(t,n){if(0===e.paths.length)return t();i.debug("compiling paths: "),i.debug(e.paths);var r=c.get("mm_compile_with_tooling_api"),a=p.createFileInstances(e.paths,e.project),s=p.getLightningBundleItemFiles(a),u=p.getToolingFiles(a,!r),l=p.getMetadataApiFiles(a,r),d=p.createPackageSubscription(a,e.project.packageXml,r),m=[];l.length>0&&m.push(e._compileGenericMetadata(l,d)),u.length>0&&(c.get("mm_legacy_compile")?m.push(e._compileToolingFilesLegacy(u)):m.push(e._compileToolingFiles(u))),s.length>0&&m.push(e._compileLightningBundleItemFiles(s)),o.all(m).then(function(e){t(e)})["catch"](function(e){n(e)})})},h.prototype._compileToolingFilesLegacy=function(e){var t=this;return new o(function(n,o){i.debug("compiling via tooling api, using legacy method (metadata api retrieve upon successul compilation)");var a=[];r.each(e,function(e){e.isDirectory?a=a.concat(e.localMembers):a.push(e)});var c,s;t._checkConflicts(a).then(function(e){return e.hasConflict?n(e):void t.project.sfdcClient.compileWithToolingApi(a,t.project).then(function(e){return i.debug("compile via tooling api result: "),i.debug(e),c=e,s=new f({subscription:p.createPackageSubscription(a)}),s.init()}).then(function(){return t.project.sfdcClient.retrieveUnpackaged(s.subscription)}).then(function(e){return t.project.updateLocalStore(e.fileProperties)}).then(function(){n(c)})["catch"](function(e){o(e)}).done()})["catch"](function(e){o(e)}).done()})},h.prototype._compileToolingFiles=function(e){var t=this;return new o(function(n,o){i.debug("compiling via tooling api");var a=[];r.each(e,function(e){e.isDirectory?a=a.concat(e.localMembers):a.push(e)});var c;t._checkConflicts(a).then(function(r){return r.hasConflict?n(r):void t.project.sfdcClient.compileWithToolingApi(a,t.project).then(function(n){return i.debug("compile via tooling api result: "),i.debug(n),c=n,t.project.sfdcClient.getServerProperties(e)}).then(function(e){return i.silly(e),t.project.updateLocalStore(e)}).then(function(){n(c)})["catch"](function(e){o(e)}).done()})["catch"](function(e){o(e)}).done()})},h.prototype._compileGenericMetadata=function(e,t){var n=this;return new o(function(o,a){i.debug("compiling via metadata api"),i.debug(t);var c=[];r.each(e,function(e){e.isDirectory?c=c.concat(e.localMembers):c.push(e)}),n._checkConflicts(c).then(function(e){if(e.hasConflict)return o(e);var r=new l({project:n.project});r.compileWithMetadataApi(c,t).then(function(e){i.debug("compile via metadata api result: "),i.debug(e),o(e)})["catch"](function(e){a(e)}).done()})["catch"](function(e){a(e)}).done()})},h.prototype._compileLightningBundleItemFiles=function(e){var t=this;return new o(function(n,o){var r=new s(t.project);r.update(e).then(function(e){i.debug("compile lightning result: "),i.debug(e),n(e)})["catch"](function(e){o(e)}).done()})},h.prototype._checkConflicts=function(e){var t=this;return new o(function(n,s){try{if(!c.get("mm_compile_check_conflicts")||t.force)return n({hasConflict:!1});i.debug("checking for conflicts");var u={hasConflict:!1},l={},p=[];if(r.each(e,function(e){e.isToolingType&&p.push(e.serverCopy)}),0===p.length)return n({hasConflict:!1});o.all(p).then(function(o){return r.each(e,function(e,n){if(!e.localStoreEntry)return s(new Error("No local index found for "+e.name+'. This can happen if you fetch your project from a remote git repository. Please ensure your project subscription includes the metadata type: "'+e.type.xmlName+'", then run the "Clean Project" command to update your local index of metadata.'));
var r=m(e.localStoreEntry.lastModifiedDate),c=m(o[n].LastModifiedDate);if(c.isAfter(r)){i.debug("conflict detected between: "),i.debug(e.localStoreEntry),i.debug(o[n]);var u=a.openSync({prefix:"mm_",suffix:" [SERVER COPY]."+t.metadataHelper.getTypeByXmlName(e.localStoreEntry.type).suffix});d.writeSync(u.fd,o[n].Body),o[n].tempPath=u.path,l[e.basename]={local:e.localStoreEntry,remote:o[n]}}}),Object.keys(l).length>0&&(u.hasConflict=!0,u.success=!1,u.conflicts=l),i.debug("conflict check result:"),i.debug(u),n(u)})["catch"](function(e){i.error("error checking conflicts",e),s(e)})}catch(f){i.error("Could not check conflicts: "),i.error(f),s(f)}})},e.exports=h},function(e,t,n){"use strict";var o=n(1),r=n(7),i=n(4),a=n(16),c=n(18),s=n(10),u=n(3),l=n(6),d=n(15).MetadataHelper,p=n(11),m=n(8),f=function(e,t){if(!e||!t)throw new Error("DeleteDelegate requires a valid project instance and an array of paths to delete.");this.project=e,this.paths=t,this.metadataHelper=new d({sfdcClient:this.project.sfdcClient})};f.prototype.execute=function(){var e,t=this;return new o(function(n,o){r.each(t.paths,function(e){if(!s.existsSync(e))return o(new Error("Invalid delete request. Path does not exist: "+e))}),t._performDelete().then(function(n){return e=n,t._deleteEmptyProjectDirectories()}).then(function(){n(e)})["catch"](function(e){o(e)})})},f.prototype._deleteEmptyProjectDirectories=function(){var e=this;return new o(function(t,n){try{s.readdirSync(l.join(e.project.path,"src")).filter(function(t){s.statSync(l.join(e.project.path,"src",t)).isDirectory()&&u.isDirectoryEmptySync(l.join(e.project.path,"src",t))&&s.removeSync(l.join(e.project.path,"src",t))}),t()}catch(o){n(o)}})},f.prototype._performDelete=function(){var e=this;return new o(function(t,n){if(0===e.paths.length)return t();var o=p.createFileInstances(e.paths),a=p.getLightningBundleItemFiles(o),s=p.createPackageSubscription(o,e.project.packageXml),u={},l={purgeOnDelete:m.get("mm_purge_on_delete")||!1},d=new c({project:e.project});d.stageDelete(s).then(function(e){return d.executeStream(e,l)}).then(function(t){return u=t,i.debug("Deletion result via metadata API: "+JSON.stringify(u)),u.success&&"Succeeded"===u.status&&(i.debug("deleting paths locally"),r.each(o,function(e){i.debug("deleting: "+e.path),e.deleteLocally()})),u.details.componentSuccesses||(u.details.componentSuccesses=[]),u.details.componentFailures||(u.details.componentFailures=[]),e._deleteLightningBundleItemFiles(a)}).then(function(e){e&&(r.each(e,function(e){e.success?(u.numberComponentsDeployed++,u.componentSuccesses.push(e)):(u.numberComponentErrors++,u.componentFailures.push(e)),u.numberComponentsTotal++}),r.find(e,{success:!1})||(r.each(a,function(e){e.deleteLocally()}),"Succeeded"===e.status&&e.success&&(e.status="Failed",e.success=!1))),i.debug(JSON.stringify(u)),t(u)})["catch"](function(e){n(e)}).done()})},f.prototype._deleteLightningBundleItemFiles=function(e){var t=this;return new o(function(n,o){if(0===e.length)return n();i.debug("deleting lightning components"),i.debug(e[0].path);var r=new a(t.project);r.deleteBundleItems(e).then(function(e){i.debug("delete result: "),i.debug(e),n(e)})["catch"](function(e){o(e)}).done()})},e.exports=f},function(e,t,n){"use strict";var o=n(1),r=n(7),i=n(4),a=n(3),c=n(10),s=n(6),u=function(e){this.project=e};u.prototype.index=function(){var e=this;return new o(function(t,n){e._getApexClassNames().then(function(t){var n=[],c=a.chunkArray(t,10);return i.debug(c),r.each(c,function(t){n.push(e._getSymbolsForClassNames(t))}),o.all(n)}).then(function(t){i.debug(e.classMap);var n=[];return r.each(t,function(t){r.each(t.records,function(t){n.push(e._writeSymbolTable(t))})}),o.all(n)}).then(function(){t()})["catch"](function(e){n(new Error("Could not index Apex Symbols: "+e.message))}).done()})},u.prototype.indexApexClass=function(e){var t=this;return new o(function(n,o){t._getSymbolsForClassNames([e]).then(function(e){return t._writeSymbolTable(e.records[0])}).then(function(){n()})["catch"](function(e){i.error("Could not index Apex Symbols: "+e.message),o(e)}).done()})},u.prototype._writeSymbolTable=function(e){var t=this;return new o(function(n,o){c.outputFile(s.join(t.project.path,"config",".symbols",e.Name+".json"),JSON.stringify(e.SymbolTable,null,4),function(e){e?o(e):n()})})},u.prototype._getSymbolsForClassNames=function(e){var t=this;return new o(function(n,o){i.debug("_getSymbolsForClassNames:"),i.debug(e);var r=["NamespacePrefix","SymbolTable","Name"],c="SELECT "+r.join(",")+" FROM ApexClass WHERE NAME IN ("+a.joinForQuery(e)+")";t.project.sfdcClient.conn.tooling.query(c,function(e,t){e?o(new Error("error retrieving symbols: "+e.message)):n(t)})})},u.prototype._getApexClassNames=function(){var e=this;return new o(function(t,n){e.project.sfdcClient.list("ApexClass").then(function(e){var n=[];r.each(e.ApexClass,function(e){n.push(e.fullName)}),t(n)})["catch"](function(e){n(new Error("Could not get class names: "+e.message))}).done()})},e.exports=u},function(e,t,n){"use strict";var o=n(1),r=n(4),i=n(19),a=n(15).MetadataHelper,c=n(10),s=n(21),u=n(11),l=function(e,t,n){if(!e||!t)throw new Error("SyncDelegate requires a valid project instance and a path path to sync.");this.project=e,this.path=t,this.force=n,this.metadataHelper=new a({sfdcClient:this.project.sfdcClient})};l.prototype.execute=function(){var e=this;return new o(function(t,n){try{r.debug("syncing with the sevrer");var o=u.createFileInstances([e.path],e.project)[0];o.serverCopy.then(function(a){if(!o.localStoreEntry)return n(new Error("No local index found for "+o.name+'. This can happen if you fetch your project from a remote git repository. Please ensure your project subscription includes the metadata type: "'+o.type.xmlName+'", then run the "Clean Project" command to update your local index of metadata.'));r.debug("local copy:"),r.debug(o.localStoreEntry),r.debug("remote copy:"),r.debug(a);var u=s(o.localStoreEntry.lastModifiedDate),l=s(a.LastModifiedDate);if(l.isAfter(u)){r.debug("conflict detected between: "),r.debug(o.localStoreEntry),r.debug(a);var d=i.openSync({prefix:"mm_",suffix:" [SERVER COPY]."+e.metadataHelper.getTypeByXmlName(o.localStoreEntry.type).suffix});c.writeSync(d.fd,a.Body),a.tempPath=d.path;var p={local:o.localStoreEntry,remote:a};return t(p)}return t("Local metadata is in sync with server")})["catch"](function(e){n(e)})}catch(a){r.error("Could not sync with server: "),r.error(a),n(a)}})},e.exports=l},function(e,t){e.exports=function(e){return e.charAt(0).toUpperCase()+e.slice(1)}},function(e,t,n){var o,r,i;o=n(7),r=function(e){return e.replace(/(?:^\w|[A-Z]|\b\w|\s+)/g,function(e,t){return 0===+e?"":0==t?e.toLowerCase():e.toUpperCase()})},i=function(e){var t,n,a;if(a=e,o.isArray(e))for(a=[],t=0;t<e.length;)a.push(i(e[t])),++t;else if(o.isObject(e)){a={};for(n in e)a[r(n)]=i(e[n])}return a},e.exports=i},function(e,t){e.exports=function(e,t,n){t.header("Access-Control-Allow-Origin","*"),t.header("Access-Control-Allow-Methods","GET,POST,PATCH,PUT,DELETE,OPTIONS"),t.header("Access-Control-Allow-Headers",["Content-Type","X-Requested-With","MavensMate-Editor-Agent"]),n()}},function(e,t){e.exports=function(e,t,n){return e.url.indexOf("/app/static")>=0?n():(e.editor=e.query.editor||e.body.editor||e.get("mavensmate-editor-agent"),e.pid=e.query.pid||e.body.pid||e.get("mavensmate-pid"),t.locals.editor=e.editor,void n())}},function(e,t,n){var o=n(4),r=n(7);e.exports=function(e,t,n){e.url.indexOf("/app/static")===-1?o.debug("Processing request "+e.method+" for URL: "+e.url):o.silly("Processing request "+e.method+" for URL: "+e.url),"POST"===e.method&&e.body?o.debug("post body",e.body):"GET"===e.method&&e.query&&!r.isEmpty(e.query)&&o.debug("query params",e.query),n()}},function(e,t,n){function o(e,t){return new Promise(function(n,o){var i=r(t);if(!i)return o(new Error("MavensMate could not find project with the id: "+t+". This is likely because you are trying to open a project that does not reside in a valid mm_workspace. Please go to MavensMate Desktop global settings and ensure this project is located in a valid mm_workspace."));a.info("adding project by id ----> ",t),a.info("path: ",i);var s=new c({path:i});s.initialize(!1).then(function(t){e.get("projects").push(s),n(t)})["catch"](function(t){u.isCredentialsError(t)?(a.warn("Project requiring re-auth added to client"),e.get("projects").push(s),n()):(a.error("Error initializing project: "+t.message+" -> "+t.stack),o(t))}).done()})}function r(e){a.debug("_findProjectPathById"),a.debug(e);var t,n=s.get("mm_workspace");return i.isArray(n)||(n=[n]),a.silly(n),i.each(n,function(n){a.silly(n);var o=u.listDirectories(n);a.silly(o),i.each(o,function(n){var o=l.join(n,"config",".settings");if(d.existsSync(o)){var r=u.getFileBody(o,!0);if(r.id===e)return t=n,!1}})}),t}var i=n(7),a=n(4),c=n(30),s=n(8),u=n(3),l=n(6),d=n(10);e.exports=function(e,t,n){if(e.url.indexOf("/app/static")>=0)return n();if(e.pid){var r=u.getProjectById(e.app,e.pid);r?r.requiresAuthentication?(e.project=r,e.url.indexOf("/app/")>=0&&e.url.indexOf("/auth")===-1&&e.url.indexOf("/settings")===-1?t.redirect("/app/project/"+e.pid+"/auth?pid="+e.pid):(e.url.indexOf("/execute")>=0||e.url.indexOf("/status")>=0)&&"oauth-project"!==e.query.command?(a.error("requested route/resource requires re-authentication, sending 500"),t.status(500).send("Could not complete the requested operation. Project requires re-authentication.")):n()):(a.debug("found project in cache",r.name),e.project=r,t.locals.project=r,n()):(a.debug("Attempting to attach project to request",e.pid),o(e.app,e.pid).then(function(){r=u.getProjectById(e.app,e.pid),e.project=r,t.locals.project=r,r.requiresAuthentication?(a.info("Project added to client, but it requires authentication, redirecting to auth endpoint"),e.url.indexOf("/app/")>=0&&e.url.indexOf("/auth")===-1&&e.url.indexOf("/settings")===-1?t.redirect("/app/project/"+e.pid+"/auth?pid="+e.pid):(e.url.indexOf("/execute")>=0||e.url.indexOf("/status")>=0)&&"oauth-project"!==e.query.command?(a.error("requested route/resource requires re-authentication, sending 500"),t.status(500).send("Could not complete the requested operation. Project requires re-authentication.")):n()):n()})["catch"](function(e){a.error("Failed to add project to client",e),t.status(500).send("Error initializing project: "+e.message)}))}else n()}},function(e,t,n){var o=(n(6),n(4),n(3)),r={project:{iconClassName:"slds-icon-standard-folder",iconName:"folder"},metadata:{iconClassName:"slds-icon-standard-document",iconName:"document"},lightning:{iconClassName:"slds-icon-standard-connected-apps",iconName:"connected_apps"},connections:{iconClassName:"slds-icon-standard-environment-hub",iconName:"environment_hub"},deploy:{iconClassName:"slds-icon-standard-environment-hub",iconName:"environment_hub"},auth:{iconClassName:"slds-icon-standard-avatar",iconName:"avatar"},test:{iconClassName:"slds-icon-standard-dashboard",iconName:"dashboard"},settings:{iconClassName:"slds-icon-standard-quotes",iconName:"settings",sprite:"utility-sprite"},logs:{iconClassName:"slds-icon-standard-record",iconName:"record"},apex:{iconClassName:"slds-icon-standard-custom",iconName:"custom"},home:{iconClassName:"slds-icon-standard-home",iconName:"home"}};e.exports=function(e,t,n){e.app.get("swig");if(o.startsWith(e.url,"/app/")&&!o.startsWith(e.url,"/app/static")){"desktop"===e.app.get("mode")&&(t.locals.isDesktop=!0),t.locals.url=e.url;var i=/\/app\/([^\W]*)/,a=e.url.match(i);if(a){var c=a[1];r[c]&&(t.locals.sldsIconClassName=r[c].iconClassName,t.locals.sldsIconName=r[c].iconName,t.locals.sldsSprite=r[c].sprite||"standard-sprite")}}n()}},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=n(13);n(4);r.get("/new",function(e,t){if(e.project){var n=e.app.get("commandExecutor");n.execute({name:"start-logging",project:e.project,editor:e.editor}).then(function(){t.render("execute_apex/index.html",{title:"Execute Apex"})})["catch"](function(e){t.render("error",{error:"Error: "+e.message})})}else t.render("error",{error:"Error: No project attached to this request."})}),r.post("/",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"execute-apex",body:e.body,editor:e.editor}),r=i.add(o);return t.send({status:"pending",id:r})}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=(n(2),n(4)),a=n(22),c=(n(6),n(3));r.get("/new",function(e,t){var n;e.project?n=e.project:e.query.pid&&(n=c.getProjectById(e.app,e.query.pid)),t.render("auth/index.html",{project:n,title:e.query.title,callback:e.query.callback,param1:e.query.param1,isForced:"1"===e.query.forced})}),r.get("/callback",function(e,t){t.render("auth/callback.html",{title:"Redirecting..."})}),r.post("/",function(e,t){var n=e.body.orgType,o=e.body.instanceUrl;o||(o="sandbox"===n?"https://test.salesforce.com/":"https://login.salesforce.com/");var r={client_id:process.env.SFDC_OAUTH_CLIENT_ID||"3MVG9uudbyLbNPZP7kLgoRiWVRqiN8gFcKwdAlztVnjgbj9shSk1vMXJNmV7W0ciFbeYiaP9D4tLfBBD06l_7",redirect_uri:process.env.SFDC_OAUTH_CALLBACK_URL||"https://localhost:56248/sfdc/auth/callback",response_type:process.env.SFDC_OAUTH_RESPONSE_TYPE||"token",display:"popup"};e.body.username&&(r.login_hint=e.body.username);var c={};e.body.callback&&(c.callback=e.body.callback),e.body.pid&&(c.pid=e.body.pid),e.body.param1&&(c.param1=e.body.param1),r.state=JSON.stringify(c);var s=o+"/services/oauth2/authorize?"+a.stringify(r);i.debug("oauth url is: ",s),t.redirect(s)}),r.post("/finish",function(e,t){i.debug("finishing oauth dance: ",e.body.url);var n=a.parse(e.body.url.split("#")[1]),o=JSON.parse(n.state),r=o.callback+"?"+a.stringify(n);i.debug("redirecting to callback",r),t.redirect(r)}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=n(4),a=(n(13),n(18),n(22)),c=n(3);r.get("/new",function(e,t){var n=e.app.get("commandExecutor");n.execute({project:e.project,name:"get-connections",editor:e.editor}).then(function(e){t.render("connections/index.html",{connections:e,title:"Deployment Connections"})})["catch"](function(e){i.error(e),t.render("error",{error:"Error: "+e.message})})}),r.get("/",function(e,t){var n=e.app.get("commandExecutor");n.execute({project:e.project,name:"get-connections",editor:e.editor}).then(function(e){t.send(e)})["catch"](function(e){t.status(500).send({error:e.message})})}),r.post("/",function(e,t){var n=e.app.get("commandExecutor");n.execute({project:e.project,name:"new-connection",body:e.body,editor:e.editor}).then(function(e){t.send(e)})["catch"](function(e){t.status(500).send({error:e.message})})}),r.post("/auth",function(e,t){var n={title:"New Deployment Connection",callback:"/app/connections/auth/finish",param1:e.body.name,pid:e.body.pid};t.redirect("/app/auth/new?"+a.stringify(n))}),r.get("/auth/finish",function(e,t){var n=e.app.get("commandExecutor");i.debug("finishing auth in org connections: ",e.query);var o=JSON.parse(e.query.state);i.debug("state!",o);var r=o.pid,a=c.getProjectById(e.app,r);n.execute({project:a,name:"new-connection",body:{name:o.param1,accessToken:e.query.access_token,instanceUrl:e.query.instance_url,refreshToken:e.query.refresh_token}}).then(function(e){t.redirect("/app/connections/new?pid="+r)})["catch"](function(e){t.status(500).send({error:e.message})})}),r["delete"]("/:id",function(e,t){var n=e.app.get("commandExecutor");n.execute({project:e.project,name:"delete-connection",body:e.body,editor:e.editor}).then(function(e){t.send(e)})["catch"](function(e){t.status(500).send({error:e.message})})}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=n(13),a=n(4),c=n(18);n(22);r.get("/new",function(e,t){if(e.project){var n=e.app.get("commandExecutor"),o=new c({project:e.project});n.execute({project:e.project,name:"get-connections",editor:e.editor}).then(function(n){t.render("deploy/index.html",{connections:n,namedDeployments:o.getNamedDeployments(),hasIndexedMetadata:e.project.hasIndexedMetadata(),title:"Deploy"})})["catch"](function(e){a.error(e),t.status(500).send({error:e.message})})}else t.render("error",{error:"Error: No project attached to this request."})}),r.post("/",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"deploy",body:e.body,editor:e.editor}),r=i.add(o);return t.send({status:"pending",id:r})}),e.exports=r},function(e,t,n){"use strict";function o(e,t){var n=e.app.get("commandExecutor"),o=e.body.command||e.query.command,r=n.execute({project:e.project,name:o,body:e.body,editor:e.editor,openWindowFn:e.app.get("openWindowFn")});if("1"===e.query.async){var i=e.app.get("requestStore"),a=i.add(r);return t.send({status:"pending",id:a})}r.then(function(e){return t.send(e)})["catch"](function(e){return t.send(e)})}var r=n(12),i=r.Router();n(4),n(13);i.options("/",function(e,t){return t.sendStatus(200)}),i.post("/",o),i.get("/",o),i.get("/:id",function(e,t){var n,o=e.app.get("requestStore");return n=e.params.id,o.isRequestComplete(n)?void t.send(o.getResultForId(n)):t.send({status:"pending",id:n})}),e.exports=i},function(e,t,n){"use strict";var o=n(12),r=o.Router();r.get("/",function(e,t){e.project?t.redirect("/app/project/"+e.project.settings.id+"?pid="+e.project.settings.id):t.render("home/index.html",{title:"MavensMate Home"})}),e.exports=r},function(e,t,n){var o=n(12),r=o.Router();r.get("/sfdc/auth/callback",function(e,t){t.redirect("/app/auth/callback")}),r.get("/",function(e,t){t.redirect("/app/home")}),r.use("/execute",n(122)),r.use("/status",n(130)),r.use("/app/auth",n(119)),r.use("/app/apex",n(118)),r.use("/app/connections",n(120)),r.use("/app/deploy",n(121)),r.use("/app/home",n(123)),r.use("/app/lightning",n(125)),r.use("/app/logs",n(126)),r.use("/app/metadata",n(127)),r.use("/app/project",n(128)),r.use("/app/settings",n(129)),r.use("/app/test",n(131)),r.get("*",function(e,t){var n=e.xhr;n?t.send("URL not found: "+e.url,404):t.render("404.html",{title:"404: Page not found"})}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=n(13);r.get("/app/new",function(e,t){e.project?t.render("lightning/new.html",{title:"Create Lightning App",lightningType:"app"}):t.render("error",{error:"Error: No project attached to this request."})}),r.get("/component/new",function(e,t){e.project?t.render("lightning/new.html",{title:"Create Lightning Component",lightningType:"component"}):t.render("error",{error:"Error: No project attached to this request."})}),r.get("/event/new",function(e,t){e.project?t.render("lightning/new.html",{title:"Create Lightning Event",lightningType:"event"}):t.render("error",{error:"Error: No project attached to this request."})}),r.get("/interface/new",function(e,t){e.project?t.render("lightning/new.html",{title:"Create Lightning Interface",lightningType:"interface"}):t.render("error",{error:"Error: No project attached to this request."})}),r.post("/app",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"new-lightning-app",body:e.body,editor:e.editor}),r=i.add(o);return t.send({status:"pending",id:r})}),r.post("/component",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"new-lightning-component",body:e.body,editor:e.editor}),r=i.add(o);return t.send({status:"pending",id:r})}),r.post("/event",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"new-lightning-event",body:e.body,editor:e.editor}),r=i.add(o);return t.send({status:"pending",id:r})}),r.post("/interface",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"new-lightning-interface",body:e.body,editor:e.editor}),r=i.add(o);return t.send({status:"pending",id:r})}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=(n(13),n(6));n(4);r.get("/",function(e,t){var n=e.app.get("io");e.project?(n.on("connection",function(t){e.project.on("new-log",function(e){t.emit("new-log",{location:e,locationBasename:i.basename(e)})})}),e.project.logService.getLogs().then(function(e){t.render("logs/index.html",{title:"Debug Logs",logs:e})})):t.render("error",{error:"Error: No project attached to this request."})}),r.get("/:location",function(e,t){var n=e.params.location;e.project.logService.getLog(i.join(e.project.path,"debug","logs",n)).then(function(n){var o=e.app.get("swig").renderFile("views/logs/log.html",{lines:n});t.status(200).send(o)})["catch"](function(e){t.status(500).send("Error: "+e.message)})}),r.post("/:location",function(e,t){var n=e.params.location,o=e.query.keyword;e.project.logService.filter(i.join(e.project.path,"debug","logs",n),o).then(function(n){var o=e.app.get("swig").renderFile("views/logs/log.html",{lines:n});t.status(200).send(o)})["catch"](function(e){t.status(500).send("Error: "+e.message)})}),e.exports=r},function(e,t,n){"use strict";function o(e){return new a(function(t,n){var o=new u;o.getTemplatesForType(e).then(function(e){t(e)})["catch"](function(e){n(new Error("Could not retrieve templates: "+e.message))}).done()})}var r=n(12),i=r.Router(),a=n(1),c=n(13),s=n(4),u=n(95);i.get("/:type/new",function(e,t){e.project?o(e.params.type).then(function(n){s.debug(n);var o={templates:n,metadataType:e.params.type,title:"New "+e.params.type};t.render("metadata/new.html",o)})["catch"](function(e){s.error(e),t.render("metadata/new.html",{title:"New Metadata"})}).done():t.render("error",{error:"Error: No project attached to this request."})}),i.get("/:type/templates/:fileName",function(e,t){var n=new u;n.getTemplateBody(e.params.type,e.params.fileName).then(function(e){t.send(e)})["catch"](function(e){t.status(500).send("Error: "+e.message)}).done()}),i.post("/",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"new-metadata",body:e.body,editor:e.editor}),r=c.add(o);return t.send({status:"pending",id:r})}),e.exports=i},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=n(4),a=n(22),c=n(13),s=n(3),u=n(10);r.get("/new",function(e,t){var n={title:"New Project",callback:"/app/project/auth/finish","new":"1"};t.redirect("/app/auth/new?"+a.stringify(n))}),r.get("/existing/new",function(e,t){if(e.query.origin){var n={title:"Create MavensMate Project ("+e.query.origin+")",callback:"/app/project/auth/finish",param1:e.query.origin};t.redirect("/app/auth/new?"+a.stringify(n))}else t.status(500).send('Error: You must provide an existing path via the "origin" query param')}),r.get("/auth/finish",function(e,t){var n=e.app.get("commandExecutor");i.debug("finishing auth in project: ",e.query);var o=JSON.parse(e.query.state);i.debug("state!",o);var r=o.pid;if(r){var a=s.getProjectById(e.app,r);a.updateCredentials({accessToken:e.query.access_token,instanceUrl:e.query.instance_url,refreshToken:e.query.refresh_token}).then(function(e){t.redirect("/app/project/"+r+"/edit?pid="+r+"&update=1")})["catch"](function(e){i.error(e),t.send(500)})}else{var c=o.param1&&u.existsSync(o.param1)?"Create MavensMate Project ("+o.param1+")":"New Project";n.execute({name:"session",body:{accessToken:e.query.access_token,instanceUrl:e.query.instance_url,refreshToken:e.query.refresh_token}}).then(function(n){t.render("project/new.html",{title:c,accessToken:e.query.access_token,instanceUrl:e.query.instance_url,refreshToken:e.query.refresh_token,session:n,origin:o.param1})})["catch"](function(e){i.error("Could not initiate session",e)})}}),r.post("/",function(e,t){i.debug("received request to create new project: "),i.debug(e.body);var n=e.app.get("commandExecutor"),o=n.execute({name:"new-project",body:e.body,editor:e.editor}),r=c.add(o);return t.send({status:"pending",id:r})}),r.post("/existing",function(e,t){i.debug("received request to create new project frome existing directory: "),i.debug(e.body);var n=e.app.get("commandExecutor"),o=n.execute({name:"new-project-from-existing-directory",body:e.body,editor:e.editor}),r=c.add(o);return t.send({status:"pending",id:r})}),r.get("/:id",function(e,t){t.render("project/home.html",{title:"Project Launchpad",isNewProject:"1"===e.query["new"]})}),r.get("/:id/auth",function(e,t){var n={title:"Update Project Credentials",callback:"/app/project/auth/finish",pid:e.project.settings.id,forced:e.project.requiresAuthentication?"1":"0"};t.redirect("/app/auth/new?"+a.stringify(n))}),r.get("/:id/edit",function(e,t){e.project?t.render("project/edit.html",{title:"Edit Project",isUpdate:"1"===e.query.update}):t.render("error",{error:"Error: No project attached to this request."})}),r.post("/:id",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"edit-project",body:e.body,editor:e.editor}),r=c.add(o);return t.send({status:"pending",id:r})}),r.post("/:id/subscription",function(e,t){var n=e.app.get("commandExecutor");n.execute({project:e.project,name:"update-subscription",body:e.body,editor:e.editor}).then(function(e){t.send(e)})["catch"](function(e){t.status(500).send({error:e.message})})}),r.post("/:id/index",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"index-metadata",body:e.body,editor:e.editor}),r=c.add(o);return t.send({status:"pending",id:r})}),r.get("/:id/index",function(e,t){i.warn(e.query);var n=e.query&&e.query.pkg&&"package.xml"!==e.query.pkg?"get-metadata-index-for-package":"get-metadata-index",o=e.app.get("commandExecutor");o.execute({project:e.project,name:n,body:{packageXmlPath:e.query.pkg},editor:e.editor}).then(function(e){t.send(e)})["catch"](function(e){t.send(e)})}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router(),i=(n(31),n(3),n(6),n(4)),a=n(8),c=n(36);r.get("/",function(e,t){var n;try{n=a.load()}catch(o){i.error("Could not load user settings",o),n=c}var r={userSettings:n,defaultSettings:c,title:"Global Settings"};t.render("settings/index.html",r)}),r.post("/",function(e,t){try{var n=c[e.body.settingKey],o=e.body.settingValue;if("integer"===n.type)o=parseInt(o);else if("object"===n.type||"array"===n.type)o=JSON.parse(o);else if("string"===n.type&&'"'===o[0]&&'"'===o[o.length-1])return t.status(500).send({error:"Failed to update "+e.body.settingKey+": Invalid string setting value. You should not wrap your string setting value in quotes."});a.set(e.body.settingKey,o),a.save(function(n){n?t.status(500).send({error:"Failed to update "+e.body.settingKey+": "+n.message}):t.send(JSON.stringify({success:!0}))})}catch(r){t.status(500).send({error:"Failed to update "+e.body.settingKey+": "+r.message})}}),e.exports=r},function(e,t,n){"use strict";var o=n(12),r=o.Router();n(4),n(13);r.options("/",function(e,t){return t.sendStatus(200)}),r.get("/",function(e,t){var n,o=e.app.get("requestStore");return n=e.query.id,o.isRequestComplete(n)?void t.send(o.getResultForId(n)):t.send({status:"pending",id:n})}),e.exports=r},function(e,t,n){"use strict";function o(e){var t=[],n=s.join(e.path,"src","classes"),o=new RegExp(/@istest/i),r=new RegExp(/testmethod/i);return a.existsSync(n)&&a.readdirSync(n).forEach(function(e){var i=s.basename(e).split("."),a=i[0],u=c.getFileBody(s.join(n,e));(o.test(u)||r.test(u))&&t.push(a)}),t}var r=n(12),i=r.Router(),a=n(31),c=n(3),s=n(6),u=n(13);n(4);i.get("/new",function(e,t){e.project?t.render("unit_test/index.html",{testClasses:o(e.project),title:"Unit Test",className:e.query.className}):t.render("error",{error:"Error: No project attached to this request."})}),i.post("/",function(e,t){var n=e.app.get("commandExecutor"),o=n.execute({project:e.project,name:"run-tests",body:e.body,editor:e.editor}),r=u.add(o);return t.send({status:"pending",id:r})}),i.post("/coverage",function(e,t){var n=e.app.get("swig"),o={apexClassOrTriggerName:e.body.apexClassOrTriggerName,type:e.body.type,uncoveredLines:e.body.uncoveredLines,project:e.project},r=n.renderFile("views/unit_test/cov.html",o);return t.send({result:r})}),e.exports=i},function(e,t,n){function o(e){return n(r(e))}function r(e){return i[e]||function(){throw new Error("Cannot find module '"+e+"'.")}()}var i={"./apex-script/new-apex-script":38,"./apex-script/new-apex-script.js":38,"./apex-script/run-apex-script":39,"./apex-script/run-apex-script.js":39,"./debug/delete-checkpoint":40,"./debug/delete-checkpoint.js":40,"./debug/download-log":41,"./debug/download-log.js":41,"./debug/execute-apex":42,"./debug/execute-apex.js":42,"./debug/flush-logs":43,"./debug/flush-logs.js":43,"./debug/list-checkpoints":44,"./debug/list-checkpoints.js":44,"./debug/new-checkpoint":45,"./debug/new-checkpoint.js":45,"./debug/start-logging":46,"./debug/start-logging.js":46,"./debug/stop-logging":47,"./debug/stop-logging.js":47,"./deploy/delete-connection":48,"./deploy/delete-connection.js":48,"./deploy/deploy":49,"./deploy/deploy.js":49,"./deploy/get-connections":50,"./deploy/get-connections.js":50,"./deploy/new-connection":51,"./deploy/new-connection.js":51,"./deploy/update-connection":52,"./deploy/update-connection.js":52,"./index":29,"./index.js":29,"./lightning/new-lightning-app":53,"./lightning/new-lightning-app.js":53,"./lightning/new-lightning-component":54,"./lightning/new-lightning-component.js":54,"./lightning/new-lightning-event":55,"./lightning/new-lightning-event.js":55,"./lightning/new-lightning-interface":56,"./lightning/new-lightning-interface.js":56,"./metadata/compile-metadata":57,"./metadata/compile-metadata.js":57,"./metadata/delete-metadata":58,"./metadata/delete-metadata.js":58,"./metadata/new-metadata":59,"./metadata/new-metadata.js":59,"./metadata/open-metadata":60,"./metadata/open-metadata.js":60,"./metadata/refresh-metadata":61,"./metadata/refresh-metadata.js":61,"./metadata/sync-with-server":62,"./metadata/sync-with-server.js":62,"./misc/execute-soql":63,"./misc/execute-soql.js":63,"./misc/get-setting":64,"./misc/get-setting.js":64,"./misc/index-apex":66,"./misc/index-apex-class":65,"./misc/index-apex-class.js":65,"./misc/index-apex.js":66,"./misc/list-metadata":67,"./misc/list-metadata.js":67,"./misc/open-settings":68,"./misc/open-settings.js":68,"./misc/open-sfdc":69,"./misc/open-sfdc.js":69,"./misc/open-ui":70,"./misc/open-ui.js":70,"./misc/session":71,"./misc/session.js":71,"./project/clean-project":72,"./project/clean-project.js":72,"./project/compile-project":73,"./project/compile-project.js":73,"./project/edit-project":74,"./project/edit-project.js":74,"./project/get-metadata-index":76,"./project/get-metadata-index-for-package":75,"./project/get-metadata-index-for-package.js":75,"./project/get-metadata-index.js":76,"./project/index-metadata":77,"./project/index-metadata.js":77,"./project/list-projects":78,"./project/list-projects.js":78,"./project/new-project":80,"./project/new-project-from-existing-directory":79,"./project/new-project-from-existing-directory.js":79,"./project/new-project.js":80,"./project/oauth-project":81,"./project/oauth-project.js":81,"./project/open-project":82,"./project/open-project.js":82,"./project/search-metadata-index":83,"./project/search-metadata-index.js":83,"./project/update-creds":84,"./project/update-creds.js":84,"./project/update-subscription":85,"./project/update-subscription.js":85,"./resource-bundle/deploy-resource-bundle":86,"./resource-bundle/deploy-resource-bundle.js":86,"./resource-bundle/new-resource-bundle":87,"./resource-bundle/new-resource-bundle.js":87,"./unit-test/get-coverage":88,"./unit-test/get-coverage.js":88,"./unit-test/run-test-method":89,"./unit-test/run-test-method.js":89,"./unit-test/run-tests":90,"./unit-test/run-tests.js":90};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=132},function(e,t){e.exports=require("archiver")},function(e,t){e.exports=require("auto-launch")},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("electron-squirrel-startup")},function(e,t){e.exports=require("fstream")},function(e,t){e.exports=require("jsforce")},function(e,t){e.exports=require("keytar")},function(e,t){e.exports=require("nconf")},function(e,t){e.exports=require("nslog")},function(e,t){e.exports=require("open")},function(e,t){e.exports=require("sax")},function(e,t){e.exports=require("socket.io")},function(e,t){e.exports=require("stream")},function(e,t){e.exports=require("strip-json-comments");
},function(e,t){e.exports=require("xml2js")},function(e,t){e.exports=require("xmldoc")}]);
//# sourceMappingURL=app.bundle.js.map